
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
    Fickle Bits
  </title>
  <meta name="author" content="Ben Scheirman">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://benscheirman.com/blog/page/30/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/ficklebits" rel="alternate" title="Fickle Bits" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-210379-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">Fickle Bits</a></h1>
  
    <h2>You're doing it wrong.</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/ficklebits" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:benscheirman.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="http://appsites.heroku.com/giggletouch">Giggle Touch for
    iOS</a></li>
  <li><a href="/blog/archives">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/12/firebug-1-0-beta-released/">Firebug 1.0 Beta Released</a></h1>
    
    
      <p class="meta">




<time datetime="2006-12-08 00:00:00 -0600" pubdate  updated >Dec 8<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>The very handy Firebug javascript debugger for Firefox has just released a major update.&nbsp; Click <a title="http://www.getfirebug.com" href="http://www.getfirebug.com/" target="_blank">here</a> to get it.</p>


<p>If you aren&rsquo;t using Firebug, you&rsquo;re missing out.&nbsp; It is hands-down <strong>the best javascript debugger out there</strong>.</p>


<p>It can intercept and log all XMLHttpRequests, you can set breakpoints, inspect and modify the DOM, execute javascript on the fly with the console, and a lot more.&nbsp; New features allow you to tweak and visualize CSS metrics (with rulers), and monitor network activity.</p>


<p>Seriously, what are you waiting for?&nbsp; <a title="firebug" href="http://www.getfirebug.com/" target="_blank">Go get it</a>.</p>


<p><img class="header" src="http://getfirebug.com/header.png" width="500" / /></p>

</div>
  <footer>
    <a rel="full-article" href="/2006/12/firebug-1-0-beta-released/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/11/agile-houston-finally/">Agile Houston - Finally!</a></h1>
    
    
      <p class="meta">




<time datetime="2006-11-13 00:00:00 -0600" pubdate  updated >Nov 13<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I was very excited to hear the creation of the first Houston Agility User Group, <a href="http://groups.google.com/group/agilehouston">Agile Houston</a>.</p>


<p>If you are interested in Agile practices and methodologies and live in the Houston area, I encourage you to join the group and attend the first meeting!</p>


<p>Currently I expect the first meeting to occur sometime in January, so as soon as I find out a definite date, I&rsquo;ll post it here.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/11/agile-houston-finally/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/11/a-journey-with-domain-driven-design-and-nhibernate-part-7/">A Journey With Domain Driven Design (and NHibernate) - Part 7</a></h1>
    
    
      <p class="meta">




<time datetime="2006-11-13 00:00:00 -0600" pubdate  updated >Nov 13<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>After a very long spell of inactivity, we&rsquo;re back for Part 7 of the series!</p>


<p>Last time we left off with a decent domain model, a database, and the beginnings of NHibernate.</p>


<p>Since the last article, the NHibernate team has produced the ever-so-fantastic v1.2.0 beta 1.&nbsp; This release supports numerous new exciting features.&nbsp; Topping the list of cool new features is:&nbsp; <strong>native support for .NET Generics</strong>!&nbsp; <strong>Native SQL 2005</strong> is also supported.&nbsp; Another feature was just enabled that will really help bridge the gap for those folks who will clutch to stored procedures forever:&nbsp; <strong>Stored Procedure / Custom Query Support</strong>.</p>


<p>I&rsquo;ll start today by slapping in this version of NHibernate and do a little bit of housekeeping.&nbsp; With this new version of NHibernate, I no longer have a need for NHibernate.Generics (and thus I will remove it).&nbsp; Some people might still use it, as it has the nice side-effect of automatically managing bi-directional relationships (which we&rsquo;ll visit later), however I&rsquo;m going to show this manually in this series.</p>


<p>I&rsquo;ve changed my EntityList&lt;T&gt; / EntityRef&lt;T&gt; / EntitySet&lt;T&gt; to normal generic collections, and NHibernate will use them automatically.&nbsp; <em>These classes do provide you with an extra&nbsp;nifty feature (explained later), but it&rsquo;s important to understand what it does under the hood, so I will implement the functionality the manual way, and later I&rsquo;ll reference these classes to show how you might still want to use them.</em></p>


<p>So&nbsp;I&rsquo;ve remove the old dll of NHibernate and I&nbsp;referenced in the new one.&nbsp; I also updated my nhibernate schema file in Visual Studio so that I get the updated intellisense.&nbsp; I compile, nothing is broken,&nbsp;and we&rsquo;re ready to test!&nbsp; The beauty of having our unit tests is that we have much more confidence that we know exactly what to fix, and we also know the instant that we are done fixing any breaking changes.&nbsp; Our application returns to a known state of behavior very quickly.</p>


<p>Since I&rsquo;ve made persistence level changes (<em>the new NHibernate dll) </em>as well as domain model changes (<em>replacing NHibernate.Generics.Entity*&lt;T&gt; with standard .NET generic lists) </em>I need to run both test assemblies.</p>


<p>&nbsp;Here are the immediate results of the tests:</p>


<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>TestCase 'Flux88.Videocracy.Persistence.Tests.PersonTester.TestCanListPeople' failed: NHibernate.InvalidProxyTypeException : Type 'Flux88.Videocracy.DomainModel.Person' cannot be specified as proxy: method get_Id should be virtual   c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Proxy\ProxyTypeValidator.cs(28,0): at NHibernate.Proxy.ProxyTypeValidator.Error(Type type, String reason)   c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Proxy\ProxyTypeValidator.cs(76,0): at NHibernate.Proxy.ProxyTypeValidator.CheckMethodIsVirtual(Type type, MethodInfo method)    c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Proxy\ProxyTypeValidator.cs(63,0): at NHibernate.Proxy.ProxyTypeValidator.CheckEveryPublicMemberIsVirtual(Type type)    c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Proxy\ProxyTypeValidator.cs(22,0): at NHibernate.Proxy.ProxyTypeValidator.ValidateType(Type type)   c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Cfg\Configuration.cs(915,0): at NHibernate.Cfg.Configuration.ValidateProxyInterface(PersistentClass persistentClass)    c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Cfg\Configuration.cs(891,0): at NHibernate.Cfg.Configuration.Validate() c:\net\nhibernate-1.2.0.Beta1\nhibernate\src\NHibernate\Cfg\Configuration.cs(1035,0): at NHibernate.Cfg.Configuration.BuildSessionFactory() c:\sandbox\Videocracy\Flux88.Videocracy.Persistence\SessionSource.cs(55,0): at Flux88.Videocracy.Persistence.SessionSource.Initialize() c:\sandbox\Videocracy\Flux88.Videocracy.Persistence\SessionSource.cs(81,0): at Flux88.Videocracy.Persistence.SessionSource.GetSession() c:\sandbox\Videocracy\Flux88.Videocracy.Persistence.Tests\PersonTester.cs(27,0): at Flux88.Videocracy.Persistence.Tests.PersonTester.TestCanListPeople()</div></code></pre></td></tr></table></div></figure></div>


<p>We have a few failing tests, however they all relate to the same problem.&nbsp; NHibernate 1.2.0 beta 1 now sets <em>everything to lazy-load</em> <em>by default.&nbsp; </em>This means that our objects must be able to be inherited so that&nbsp;NHibernate can inject proxy subclasses of our&nbsp;objects (the consumer doesn&rsquo;t know or care that&nbsp;this happens).&nbsp; To do this&nbsp;all of the methods and properties need to be <strong>virtual</strong>.&nbsp;&nbsp;&nbsp;This is a large change, and it&rsquo;s not something I entirely agree with, but it&rsquo;s very easy to turn off.&nbsp;&nbsp; (It pays to read the release notes of these 3rd party products!)&nbsp; We&rsquo;ll discuss how to effectively lazy-load a bit further on.</p>


<p>In our mapping file, we can specify <strong>default-lazy=&rdquo;false&rdquo;</strong> to override this behavior.&nbsp; At a later time we may investigate and find that the class will benefit from lazy loading and we&rsquo;ll revert it, but until then I&rsquo;ll just make all the classes <em>default-lazy=&rdquo;false&rdquo;</em>.</p>


<p>Here&rsquo;s the change:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;?</span><span style="COLOR: maroon">xml</span><span style="COLOR: blue"> </span><span style="COLOR: red">version</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">1.0</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">encoding</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">utf-8</SPAN>&#8221;<span style="COLOR: blue"> ?&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;</span><span style="COLOR: maroon">hibernate-mapping</span><span style="COLOR: blue"> </span><span style="COLOR: red">xmlns</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">urn:nhibernate-mapping-2.0</SPAN>&#8221;<span style="COLOR: blue"> </span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="COLOR: red">namespace</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Flux88.Videocracy.DomainModel</SPAN>&#8221;<span style="COLOR: blue"> </span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="COLOR: red">assembly</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Flux88.Videocracy.DomainModel</SPAN>&#8221;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><strong><span style="COLOR: red">default-lazy</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">false</SPAN>&#8221;</strong></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &lt;</span><span style="COLOR: maroon">class</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Person</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">table</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">People</SPAN>&#8221;<span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&nbsp;&nbsp; &nbsp;&hellip;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &lt;/</span><span style="COLOR: maroon">class</span><span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&lt;/</span><span style="COLOR: maroon">hibernate-mapping</span><span style="COLOR: blue">&gt;</span></p></div>


<p>Once that change is in place, all 5 of my persistence tests are passing.&nbsp;&nbsp; I have 6 failing tests in my domain model, mostly due
to my careless replacement of the EntityRef stuff with standard .NET collections.&nbsp;&nbsp;The tests expose my oversights and once I fix them I&rsquo;m back on track.</p>


<p>Ok, now where were we?&nbsp; (It&rsquo;s been a while, so I open NUnit and see that we&nbsp;have Save/List/Load for a Person object, but nothing else).&nbsp;We introduced some simple mapping concepts, and this time we&rsquo;ll dig in a bit deeper.</p>


<p>How does NHibernate deal with associations?&nbsp; Lets start with Account.&nbsp; Account has a collection of Customer objects that represent its members.&nbsp; In standard database terms, Account is a one-to-many with Customer.&nbsp; How do we map this kind of relationship with NHibernate?</p>


<p>There are a few choices when looking at the documentation for NHibernate.&nbsp; To understand them you must understand the semantics of each kind of list.&nbsp; Ask yourself these questions:</p>


<ul><li>is it one-to-one?&nbsp; many-to-one?&nbsp; many-to-many?</li><li>does order matter?</li><li>is it bidirectional?</li></ul>


<p>From the <a title="NHibernate FAQ" href="http://www.hibernate.org/359.html" target="_blank">NHibernate FAQ</a>, we find this informative nugget, that explains the collections available to us (and their .NET counterparts):</p>


<ul><li>The <tt>&lt;list&gt;</tt> <span style="COLOR: rgb(204,0,0)">map</span>s directly to an IList.</li><li>The <tt>&lt;<span style="COLOR: rgb(204,0,0)">map</span>&gt;</tt> <span style="COLOR: rgb(204,0,0)">map</span>s directly to an IDictionary.</li><li>The <tt>&lt;bag&gt;</tt> <span style="COLOR: rgb(204,0,0)">map</span>s to an IList. A <tt>&lt;bag&gt;</tt> does not completely comply with the <tt>IList</tt> interface because the <tt>Add()</tt> method is not guaranteed to return the correct index. An object can be added to a <tt>&lt;bag&gt;</tt> without initializing the <tt>IList</tt>. Make sure to either hide the <tt>IList</tt> from the consumers of your API or make it well documented.</li><li>The <tt>&lt;<span style="COLOR: rgb(204,0,0)">set</span>&gt;</tt> <span style="COLOR: rgb(204,0,0)">map</span>s to an <tt>Iesi.Collections.I<span style="COLOR: rgb(204,0,0)">Set</span></tt>. That interface is part of the <tt>Iesi.Collections</tt> assembly distributed with <span style="COLOR: rgb(204,0,0)">NHibernate</span>.</li></ul>


<p>Our Account -&gt; Customer relationship is <em>one-to-many</em>.&nbsp; I could choose to allow one customer to have many accounts, but I don&rsquo;t see any real use for that yet.&nbsp; Order does not matter either.&nbsp; I could have 4 members on an account, and it doesn&rsquo;t really matter what order they are given to my in a list.&nbsp; </p>


<p>We also have to consider what each end of the association looks like.&nbsp; Right now I&rsquo;m looking at it from the perspective of <em>Account</em>, where <em>Account </em>has many <em>Customers</em> (members).&nbsp; On the customer object, the customer only has one Account, so this isn&rsquo;t a bidirectional association.&nbsp; (We&rsquo;ll see an example of this later).&nbsp; Techically our collection maps to an ISet, but I&rsquo;d rather not depend on the Iesi.Collections.dll, so I&rsquo;m going to map it to a list (the only drawback is that the list will allow the same member twice, so I&rsquo;ll just get around this in our model manually).</p>


<p>Here&rsquo;s how we&rsquo;ll deal with that:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;summary&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> Adds a member to this account</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;/summary&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;param name=&#8221;customer&#8221;&gt;&lt;/param&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> AddMember(<span style="COLOR: teal">Customer</span> customer)</p><p style="MARGIN: 0px">{</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: green">//ignore multiple adds for the same customer.</span></p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">if</span>(_members.Contains(customer)) <span style="COLOR: blue">return</span>;</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; _members.Add(customer);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: green">//make sure that our association is handled on both sides</span></p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; customer.Account = <span style="COLOR: blue">this</span>;</p><p style="MARGIN: 0px">}</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;summary&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> Removes a member from this account.</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;/summary&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: gray">///</span><span style="COLOR: green"> </span><span style="COLOR: gray">&lt;param name=&#8221;customer&#8221;&gt;&lt;/param&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> RemoveMember(<span style="COLOR: teal">Customer</span> customer)</p><p style="MARGIN: 0px">{</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: green">//ignore the call if the customer isn&#8217;t a member of this account</span></p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">if</span> (!_members.Contains(customer)) <span style="COLOR: blue">return</span>;</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; _members.Remove(customer);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: green">//make sure that our association is handled on both sides</span></p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; customer.Account = <span style="COLOR: blue">null</span>;</p><p style="MARGIN: 0px">}</p></div>


<!--EndFragment-->


<p><em>&nbsp;The rest of the class is self-explanatory, so I won&rsquo;t include it here.&nbsp; You&rsquo;ll&nbsp; be able to download the project at the end of today&rsquo;s article, however.</em></p>


<p>Next up is the mapping.&nbsp; Let&rsquo;s take another look at the table structure for reference:</p>


<p><img src="/images/CropperCapture%5B4%5D_small.jpg" alt="CropperCapture[4]"  border="0"  /></p>


<p><em>This is slightly different than what was in the last archive.&nbsp; Instead of an account having a single primary customer, any customer can be the &lsquo;Owner&rsquo; of his/her account.&nbsp; I chose to keep the association simple for this demo.&nbsp; I also wanted to allow multiple &lsquo;Owners&rsquo; for a single account.&nbsp; I&rsquo;ve updated the tests to reflect this change.</em></p>


<p>Here you see that many customers belong to exactly one account.&nbsp;&nbsp;&nbsp; This is a one-to-many relationship from Account to Customer.</p>


<p>If we stop and think about the domain for a minute, we can&nbsp;determine that the Customer will be identified first (by his/her ID or Account #) and that needs to be able to pull up the account.&nbsp; I&rsquo;d also like to keep this relationship bidirectional.&nbsp; That means that I need to map the relationship on both classes so that we can do this:</p>


<p><strong>customer.Account &hellip;.&nbsp;&nbsp; </strong></p>


<p>or this:</p>


<p><strong>for each Customer c in _account.Members&nbsp;{ &hellip;&nbsp;}</strong></p>


<p>Here is the relevant mapping for Customer:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&lt;!&#8211;</span
><span style="COLOR: green"> CUSTOMER&nbsp; </span><span style="COLOR: blue">&#8211;&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&lt;</span><span style="COLOR: maroon">joined-subclass</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Customer</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">table</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Customers</SPAN>&#8221;<span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &lt;</span><span style="COLOR: maroon">key</span><span style="COLOR: blue"> </span><span style="COLOR: red">column</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">PersonId</SPAN>&#8221;<span style="COLOR: blue"> /&gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &lt;!&#8211;</span><span style="COLOR: green"> todo:&nbsp; map this to an enumeration </span><span style="COLOR: blue">&#8211;&gt;</span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp; &lt;</span><span style="COLOR: maroon">property</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">RentalRestriction</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">type</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Int32</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">column</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">rentalRestrictionId</SPAN>&#8221;<span style="COLOR: blue"> /&gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><strong><span style="COLOR: blue">&nbsp; &lt;</span><span style="COLOR: maroon">many-to-one</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Account</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">class</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Account</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">column</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">accountId</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">cascade</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">save-update</SPAN>&#8221;<span style="COLOR: blue"> /&gt; </span></strong></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&lt;/</span><span style="COLOR: maroon">joined-subclass</span><span style="COLOR: blue">&gt;<br /><br /></span></p></div>


<p><!--EndFragment-->This tells NHibernate that this is the *many* end of a one-to-many association.&nbsp; We tell it the property name, type, foreign key column name, and our cascade strategy.&nbsp; This basically means, whenever we save or update our Customer, cascade the save/update to the Account as well.&nbsp; You can also specify to cascade deletes as well if you need to.</p>


<p>The Account mapping looks like this:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&lt;</span><span style="COLOR: maroon">class</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Account</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">table</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Accounts</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">where</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Active=1</SPAN>&#8221;<span style="COLOR: blue">&gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue"></span></p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&nbsp;&nbsp; &lt;!&#8211;</span><span style="COLOR: green"> &#8230; </span><span style="COLOR: blue">&#8211;&gt;</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&nbsp;</span><span style="COLOR: blue">&nbsp; <strong>&lt;</strong></span><strong><span style="COLOR: maroon">bag</span><span style="COLOR: blue"> </span><span style="COLOR: red">name</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Members</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">access</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">nosetter.camelcase-underscore</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">lazy</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">true</SPAN>&#8221;</strong><strong><span style="COLOR: blue">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="COLOR: red">cascade</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">save-update</SPAN>&#8221;<span style="COLOR: blue"> </span><span style="COLOR: red">inverse</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">true</SPAN>&#8221;<span style="COLOR: blue">&gt;</span></strong></p><p style="MARGIN: 0px"><strong><span style="COLOR: blue">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!&#8211;</span><span style="COLOR: green"> this key refers to the Account key in the Customer table </span><span style="COLOR: blue">&#8211;&gt;</span></strong></p><p style="MARGIN: 0px"><strong><span style="COLOR: blue">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &lt;</span><span style="COLOR: maroon">key</span><span style="COLOR: blue"> </span><span style="COLOR: red">column</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">accountId</SPAN>&#8221;<span style="COLOR: blue"> /&gt;</span></strong></p><p style="MARGIN: 0px"><strong><span style="COLOR: blue">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &lt;</span><span style="COLOR: maroon">one-to-many</span><span style="COLOR: blue"> </span><span style="COLOR: red">class</span><span style="COLOR: blue">=</span>&#8221;<SPAN style="color: blue">Customer</SPAN>&#8221;<span style="COLOR: blue"> /&gt;&nbsp; &nbsp; &nbsp; </span></strong></p><p style="MARGIN: 0px"><strong><span style="COLOR: blue">&nbsp; &nbsp; &lt;/</span><span style="COLOR: maroon">bag</span><span style="COLOR: blue">&gt;</span></strong></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">&nbsp;&lt;/</span><span style="COLOR: maroon">class</span><span style="COLOR: blue">&gt;</span></p></div>


<p><!--EndFragment--></p>


<p>This section tells NHibernate to map this association as a bag.&nbsp; Lazy=true means that the collection will only actually be retrieved from the database once it is accessed.&nbsp; NHibernate does this by silently replacing our IList with a proxy that knows about the session and how to hydrate the collection.&nbsp; This is 100% transparent to our consumers, so make sure you are using this in appropriate places.&nbsp; Lazy=false will force NHibernate to pre-load the entire association (and it&rsquo;s associations(and it&rsquo;s associations(&hellip;. you get the point&hellip;))).&nbsp;</p>


<p>To test that this association worked, I wrote a simple test:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px">&nbsp;[<span style="COLOR: teal">Test</span>]</p><p style="MARGIN: 0px">&nbsp;<span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> CanSaveCustomerAndAccount()</p><p style="MARGIN: 0px">&nbsp;{</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: teal">Customer</span> c = <span style="COLOR: teal">TestHelper</span>.GetTestCustomer();</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: teal">Account</span> a = <span style="COLOR: blue">new</span> <span style="COLOR: teal">Account</span>();</p><p style="MARGIN: 0px">&nbsp; &nbsp; a.AddMember(c);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: blue">using</span> (<span style="COLOR: teal">ISession</span> session = <span style="COLOR: teal">SessionSource</span>.Current.GetSession())</p><p style="MARGIN: 0px">&nbsp; &nbsp; {</p><p s
tyle="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: blue">using</span> (<span style="COLOR: teal">ITransaction</span> tx = session.BeginTransaction())</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; {</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; session.SaveOrUpdate(c);</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; session.Flush();</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; session.Evict(c); <span style="COLOR: green">//make sure we don&#8217;t get an object from the cache</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: teal">Assert</span>.AreNotEqual(0, c.Id, <span style="COLOR: maroon">&#8220;Customer didn&#8217;t get an Id after save&#8221;</span>);</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: teal">Assert</span>.AreNotEqual(0, a.Id, <span style="COLOR: maroon">&#8220;Account didn&#8217;t get an Id after save&#8221;</span>);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: teal">Customer</span> customerFromDb = session.Get&lt;<span style="COLOR: teal">Customer</span>&gt;(c.Id);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: teal">Assert</span>.AreNotSame(c, customerFromDb, <span style="COLOR: maroon">&#8220;Got same instance of customer!&#8221;</span>);</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="COLOR: teal">Assert</span>.AreEqual(a, customerFromDb.Account, <span style="COLOR: maroon">&#8220;Account didn&#8217;t get saved&#8221;</span>);</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tx.Rollback();</p><p style="MARGIN: 0px">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="MARGIN: 0px">&nbsp; &nbsp; }</p><p style="MARGIN: 0px">&nbsp;}</p></div>


<p>This test is passing and we have our first association mapped!</p>


<p>I think this is a good stopping point.&nbsp;&nbsp; We have migrated our version of NHibernate and our tests forced us to fix any outstanding issues before continuing.&nbsp; We also identified our first association, mapped it, and tested it.</p>


<p>From here on out I will step up the pace and start glossing over the details a bit and focus on getting working product done using this domain model.&nbsp; As I begin writing some UI components I will come across some&nbsp;features I have not developed, which may require more mapping changes and tests.&nbsp;&nbsp;In order to finish this series sometime this year I&rsquo;ll be speeding up a bit.&nbsp; I will still continue to post the source so that you may follow along.&nbsp; If you have comments or questions, feel free to comment.</p>


<p>Here is the latest source:</p>


<p><a href="http://www.flux88.com/uploads/Videocracy_07.zip">File Attachment: Videocracy_07.zip (44 KB)</a></p>

</div>
  <footer>
    <a rel="full-article" href="/2006/11/a-journey-with-domain-driven-design-and-nhibernate-part-7/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/10/tulsatechfest-2006-was-a-blast/">TulsaTechFest 2006 Was a Blast</a></h1>
    
    
      <p class="meta">




<time datetime="2006-10-18 00:00:00 -0500" pubdate  updated >Oct 18<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I attended TulsaTechFest 2006 this past weekend and I had a fantastic time.&nbsp; I was able to meet a number of interesting people and learned quite a bit.</p>


<p>I attended&hellip;</p>


<ul><li><strong><em>NUnit Extensibility with <a title="Tim Rayburn's blog" href="http://www.timrayburn.net/" target="_blank">Tim Rayburn</a><br /></em></strong>Tim is an incredibly passionate guy.&nbsp; He didn&rsquo;t have quite enough time to fully cover his presentation, though I did learn from it.&nbsp; He ended up spending about 15 minutes of it just pimping CodeRush. <img src="/images/smile1___________________.gif"   /><br /></li><li><strong><em>IoC / DI with <a title="Dru Sellers' blog" href="http://geekswithblogs.net/dsellers/" target="_blank">Dru Sellers</a><br /></em></strong>Inversion of Control / Dependency Injection has been an interest of mine for some time now, but it&rsquo;s a tad difficult to wrap your head around how it actually works.&nbsp; In theory I understood it, but with Dru&rsquo;s explanation I am now fully onboard with it and will definitely start utilizing it in my projects at home to get better at it.&nbsp; Dru was very excited about it and it showed.&nbsp; His talk was very casual and informative.<br /></li><li><strong><em>POCOS In Action with <a title="Dru Seller's blog" href="http://geekswithblogs.net/dsellers/" target="_blank">Dru Sellers</a><br /></em></strong>POCOs, or Plain Old CLR Objects, is a concept adopted from Java (you guessed it: POJOs) which is basically a move away from Entity Java Beans.&nbsp; The gist of it is that we&rsquo;d like to focus on simple objects that express our domain model and business rules <strong>and nothing else.</strong>&nbsp; No infrastructure mixed in with our logic.&nbsp; No persistence related concerns embedded in our objects.&nbsp; This talk was very high level and actually blended with IoC and NHibernate, so I wish I would have attended another talk.&nbsp; Dru did a great job explaining the POCO mentality and I know he made a great impact on my buddy Tom, a Java developer.<br /></li><li><em><strong>NHibernate with <a title="Dru Sellers' blog" href="http://geekswithblogs.net/dsellers/" target="_blank">Dru Sellers</a> </strong>(see a pattern?)<br /></em>I attended this talk mainly to show the flag, as I knew it would be more of an introductory overview.&nbsp; The audience seemed genuinely interested in the subject and Dru explained it well.&nbsp; I also contributed my&nbsp;two cents&nbsp;and I hope I wasn&rsquo;t intruding <img src="http://www.flux88.com/uploads/smile1.gif" />.<br /></li><li><strong><em>The Science of Great UI with Mark Miller<br /></em></strong>UI Design is a big interest of mine, but the fact that Mark Miller was presenting sealed the deal on this talk.&nbsp; Mark is crazy, and if you haven&rsquo;t listened to him on <a title="Mondays (podcast)" href="http://mondays.pwop.com/" target="_blank">Mondays</a> or <a title="Millahseconds (podcast)" href="http://millahseconds.com/" target="_blank">Millahseconds</a>, you really should.&nbsp; He&rsquo;s insanely hilarious and I thoroughly enjoyed his presentation.&nbsp; My favorite part of this presentation was when Mark shoved his kid off of his lap to take a picture of a &ldquo;horribly conceived modal dialog box ever&rdquo; in a Lego game he was playing with his kids.&nbsp; I can totally see him doing that.<br /></li><li><strong><em>Component-based Architectures with Mark Miller<br /></em></strong>This talk was about to get <em>very</em> interesting when Mark ran out of time.&nbsp; Some of us were a bit confused on where he was going, and we talked to him about it afterwards and he was eager to hear the feedback.&nbsp; Basically he argued that in order to gain the best competitive advantage, we as developers should focus on implementing new features faster, (features and time being two out of 4&ndash;5 aspects of a product that we control) and to do that we have to understand how difficult it is for new developers to just get work done.&nbsp; He argued that the less visible structure that your code has, the easier it is to add new features.&nbsp; Mark is a fan of building components (yes, like the ones you drag onto a component surface in visual studio).&nbsp; If you aren&rsquo;t clicking with this yet, and I fully understand why, then you should go try to create a plug-in with Visual Studio and see if you can get a simple one completed.&nbsp; Then go try it with the free&nbsp;<a title="DXCore (free VS Plugin tool)" href="http://devexpress.com/Products/NET/IDETools/DXCore/" target="_blank">DXCore</a> and see if you aren&rsquo;t blown away at its simplicity.</li></ul>


<p>I also won a book, <a title="Amazon link" href="http://www.amazon.com/Professional-Ajax-Programmer-Nicholas-Zakas/dp/0471777781/sr=8-1/qid=1161229311/ref=pd_bbs_sr_1/002-6616954-0199241?ie=UTF8" target="_blank">Professional Ajax</a> (WROX) which is now 8th on my reading list.</p>


<p>After the event I met up with <a title="Tim Gifford's blog" href="http://blogs.giffordconsulting.com/" target="_blank">Tim Gifford</a> and <a title="Javier Lozano's blog" href="http://lozanotek.com/" target="_blank">Javier Lozano</a>, and we went to an Irish pub and later mosied on down to Arnie&rsquo;s to where Microsoft was buying drinks!&nbsp; I met up with Shaun Walker (from DNN fame)&nbsp;there and I made sure to give him a hard time about his picture. <img src="http://www.flux88.com/uploads/smile1.gif" />&nbsp; Sorry Shaun, no hard feelings!&nbsp; (He&rsquo;s really a cool guy).&nbsp; At the bar we enjoyed some tech conversation and jager bombs (ouch) and had a good time.</p>


<p>I can&rsquo;t wait to go again next year.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/10/tulsatechfest-2006-was-a-blast/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/10/tulsa-tech-fest/">Tulsa Tech Fest</a></h1>
    
    
      <p class="meta">




<time datetime="2006-10-08 00:00:00 -0500" pubdate  updated >Oct 8<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ll be attending <a title="TulsaTechFest website" href="http://tulsatechfest.com/" target="_blank">Tulsa Tech Fest</a> this weekend.</p>


<p>I&rsquo;m excited to see quite a few people speak, including:</p>


<ul><li>Markus Egger</li><li>Mark Miller</li><li>Carl Franklin</li><li>Dru Sellers</li><li>Bill Vaughn</li></ul>


<p>However I was saddened to hear that <a title="JP Boodhoo's blog" href="http://www.jpboodhoo.com/blog" target="_blank">Jean-Paul Boodhoo</a> will not be speaking anymore.&nbsp; I was mostly excited about his sessions on Continuous Integration and Mock-Objects.&nbsp; Ah well, I&rsquo;ll catch him next time around.</p>


<p>I haven&rsquo;t finalized my schedule yet, but I&rsquo;m looking forward to some of the Agile sessions, some Ajax, some WPF, and general architecture.&nbsp; I&rsquo;ll post my schedule later on, if anyone wants to meet up.</p>


<p>Is anything going on after the event?</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/10/tulsa-tech-fest/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/10/compiled-vs-dynamic-laguages-and-the-code-feedback-loop/">Compiled vs Dynamic Laguages and the Code Feedback Loop</a></h1>
    
    
      <p class="meta">




<time datetime="2006-10-06 00:00:00 -0500" pubdate  updated >Oct 6<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>So I bit the bullet and installed Ruby on Rails.&nbsp; I&rsquo;ve been reading a lot about Ruby (mainly blogs) and decided that it&rsquo;s about&nbsp;time to learn another language.&nbsp; The Pragmatic Programmers believe that you should dedicate some time to learn a new language every year.</p>


<p>My first impressions are probably pretty common.&nbsp; Ruby is not easy to jump into.&nbsp; They have a lot of great information on the internet, but I found that things didn&rsquo;t go as smoothly as I had hoped.&nbsp; This is probably due to the fact that there are major changes between each version of ruby/rails, and there are old&nbsp;tutorials directed at older versions of Ruby or Rails.</p>


<p>The second hinderance I found was that, with Ruby (among other dynamic languages), you don&rsquo;t get any intellisense.&nbsp; Being brought up with Visual Studio made me spoiled, I suppose.&nbsp; The fact is, with any dynamic language, such as Ruby, Python, or Javascript&hellip;&nbsp; Intellisense is difficult to provide.&nbsp; <em>Type information often isn&rsquo;t available until runtime.</em></p>


<p>This really annoyed me at first, and I was quick to dismiss dynamic languages.&nbsp; </p>


<p>Intellisense really makes your learning experience much easier.&nbsp; When I started in .NET, I had a few books, but mainly I just used Intellisense to navigate my way around the framework.&nbsp; If you didn&rsquo;t know how to send email with .NET, you could easily just type <strong>System.Web.Mail. </strong>and you&rsquo;d see the relevant classes involved.&nbsp; Intellisense is an extremely effective discoverability tool.&nbsp;&nbsp; </p>


<p>Now that I am an experienced .NET developer, I know all of these things by heart.&nbsp; There&rsquo;s not much stopping me from writing my programs in Notepad2.&nbsp; I don&rsquo;t rely as heavily on Intellisense like I did before.&nbsp; I still use Visual Studio, though, because having your compiler and debugger integrated with your editor is almost a necessity.</p>


<p>This isn&rsquo;t the case with dynamic languages.&nbsp; You write a program (often times in a single file with FAR fewer lines of code) and you run it.&nbsp; That&rsquo;s it.&nbsp; There&rsquo;s no compilation or startup time.&nbsp; You get your results right there.&nbsp; If you mispell a type or call a method on the wrong class of course you&rsquo;ll get an error.&nbsp; But you find this out&nbsp;<strong>sooner that your C# / Java program will compile</strong>.&nbsp; If you can write 5 lines of code and push a button to see if it worked&hellip;&nbsp; without waiting for a compiler or debugger, then your code-feedback-loop is MUCH tighter.&nbsp; Agile principles thrive on having small feedback loops.&nbsp; This is (in my opinion) the single largest reason why Agile is so effective.</p>


<p>The compiler is becoming less and less popular these days because it cannot protect your program from logic flaws.&nbsp; It&rsquo;s becoming much like the spell-check feature of word processors.&nbsp; They can tell you that you mispelled the word&nbsp;<strike>definate</strike> definite, but a sentence like this one will pass spell-check just fine:&nbsp; <strong>We will meat at the movie theater.</strong>&nbsp; A compiler can only take you so far.&nbsp; To verify your program works, you have to compile it, run it, navigate to the section, and test it.&nbsp; In a dynamic language, half of these steps are removed, leaving you with a much tighter code-feedback-loop.</p>


<p>We all love intellisense (and I will welcome it for Ruby with open-arms), but don&rsquo;t let that stop you from writing your next small program in a language like Python or Ruby.&nbsp; It will give you another tool in your developer toolbox and make you a better programmer in *any* language.</p>


<p><em></em>&nbsp;</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/10/compiled-vs-dynamic-laguages-and-the-code-feedback-loop/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/09/im-not-dead/">I&#8217;m Not Dead</a></h1>
    
    
      <p class="meta">




<time datetime="2006-09-27 00:00:00 -0500" pubdate  updated >Sep 27<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m just posting this to let my readers know that I am not dead <img src="/images/smile1________________.gif"   /></p>


<p>I&rsquo;ve been eager to finish the articles on <a title="A Journey with Domain Driven Design and NHibernate - Part 1" href="http://www.flux88.com/2006/07/05/A+Journey+With+NHibernate++Part+1.aspx">Domain Driven Design and NHibernate</a>, however work has been very busy lately, combined with kids soccer, volleyball, cub scounts, and other activities&hellip;.there&rsquo;s not enough time in a day!</p>


<p>Ahh, and I&rsquo;d also like to personally thank <a title="Aaron Murrell's blog" href="http://blogs.sarkhouston.com/amurrell" target="_blank">Aaron Murrell</a> and <a title="Ayende Rahien's blog" href="http://www.ayende.com/blog" target="_blank">Ayende Rahien</a> for their hugely appreciated assistance in overcoming some very obscure issues.&nbsp; Thanks guys!</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/09/im-not-dead/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/09/reason-462-why-i-dont-like-vb-net/">Reason #462 Why I Don&#8217;t Like VB.NET</a></h1>
    
    
      <p class="meta">




<time datetime="2006-09-05 00:00:00 -0500" pubdate  updated >Sep 5<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p><strong>Reason #462 Why I don&#8217;t like VB.NET:</strong> </p>


<p>VB.NET attributes cannot have variable&nbsp;arguments.&nbsp; What do I mean? </p>


<p>The following code does <strong>NOT</strong> work in VB.NET:</p>


<div style="FONT-SIZE: 9pt; BACKGROUND: white; COLOR: black; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: blue">Public</span> <span style="COLOR: blue">Class</span> MyCustomAttribute</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: blue">Inherits</span> Attribute</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: blue">Public</span> <span style="COLOR: blue">Sub</span> <span style="COLOR: blue">New</span>(<span style="COLOR: blue">ByVal</span> <span style="COLOR: blue">ParamArray</span> vals() <span style="COLOR: blue">As</span> <span style="COLOR: blue">String</span>)</p><p style="MARGIN: 0px">&nbsp; &nbsp; <span style="COLOR: blue">End</span> <span style="COLOR: blue">Sub</span></p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px"><span style="COLOR: blue">End</span> <span style="COLOR: blue">Class</span></p></div>


<p>It compiles, but when you try to use this attribute on a member you&rsquo;ll get an error:&nbsp; &ldquo;<em>Attribute constructor argument is a 1-dimension array of string which is not Integral, float, etc&hellip;..&rdquo;</em></p>


<p>In C# this works perfectly fine.&nbsp; Why is this?</p>


<p>To provide a workaround for this issue I just accept a single pipe-delimited string and .Split it on the pipe to get my array.&nbsp; A tad on the ugly side, but it works.</p>


<p><strong>Now playing:</strong> <a href="http://phobos.apple.com/WebObjects/MZSearch.woa/wa/advancedSearchResults?artistTerm=Third Eye Open">Third Eye Open</a> - <a href="http://phobos.apple.com/WebObjects/MZSearch.woa/wa/advancedSearchResults?songTerm=Intolerance&amp;artistTerm=Third Eye Open">Intolerance</a></p>

</div>
  <footer>
    <a rel="full-article" href="/2006/09/reason-462-why-i-dont-like-vb-net/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/09/a-journey-with-domain-driven-design-and-nhibernate-part-6/">A Journey With Domain Driven Design (and NHibernate) - Part 6</a></h1>
    
    
      <p class="meta">




<time datetime="2006-09-01 00:00:00 -0500" pubdate  updated >Sep 1<span>st</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>Welcome back!&nbsp; In <a title="part 5" href="http://www.flux88.com/2006/08/24/A+Journey+With+Domain+Driven+Design+And+NHibernate++Part+5.aspx">Part 5</a>&nbsp;we finished off with a table structure and the beginnings of NHibernate.&nbsp; We’ll dive in deeper with NHibernate and mapping in this article.</p>


<p><em>(part 1 was <a title="Digg.com" href="http://digg.com/programming/A_Journey_with_nHibernate" target="_blank">Dugg</a>, which was quite&nbsp;exciting to me!&nbsp; It has also increased the traffic around here a little bit!&nbsp; If you’re enjoying the series, why not <a title="digg" href="http://digg.com/programming/A_Journey_with_nHibernate" target="_blank">Digg it some more</a>?)</em></p>


<p>Currently we can initialize our SessionFactory which reads the configuration file and loads our domain model assembly.&nbsp; This step is where NHibernate will parse our mapping files (once we add them).</p>


<p>So let’s take a step&nbsp;back and ask the question that’s probably on your minds already:&nbsp;how do we get our classes mapped to the database using NHibernate?&nbsp; We have to provide a mapping file.&nbsp; An NHibernate mapping file is an xml file that specifies how your object fields and properties map to database columns.&nbsp; There are a few ways you can load mapping files into NHibernate, but the easiest I have found is to add them as part of your domain model class library as <em>embedded resources (details below).&nbsp;</em>&nbsp; I emphasize embedded resources because if you just add the XML files without specifying they will not be recognized automatically by our SessionFactory initialization.</p>


<div style="margin: 5px; padding: 5px; float: right; width: 200px; background-color: aliceblue;"><em>A number of people have asked me to display more source code, and in this article you’ll see the domain model in more detail.&nbsp; At the end of this article I will post the code that we’ve created so far.</em> </div>


<p>If you are a little scared about writing these mapping files and would rather use a tool to generate it for you that is certainly possible.&nbsp; Ayende Rahien’s <a title="NHibernate Query Analyzer @ Ayende Rahien" href="http://www.ayende.com/projects/nhibernate-query-analyzer.aspx" target="_blank">NHibernate Query Analyzer</a> can help with this.&nbsp; I have found, however, that in order to fully understand how to effectively map your objects, you should write the mapping by hand.&nbsp; Don’t fret, there is hope with the manual method.&nbsp; The hope?&nbsp; <strong>Intellisense.&nbsp; </strong>To get nhibernate mapping intellisense in Visual Studio 2005 you can copy the schema file (<strong>nhibernate-mapping-2.0.xsd</strong>) to <strong>C:\Program Files\Microsoft Visual Studio 8\Xml\Schemas.</strong></p>


<p>Now that we have intellisense for our mapping files, we can start creating our mappings.&nbsp; I choose to have a single mapping file per class, so that they don’t get too cluttered.&nbsp; There is nothing to stop you from defining your entire object model in a single mapping file, but I avoid this approach.</p>


<p><a href="http://www.flux88.com/uploads/CropperCapture%5B26%5D.Jpg"><img src="/images/CropperCapture%5B26%5D_thumb_.jpg" alt="CropperCapture[26]"  vspace="5" /></a>Starting off with the Person class, we create add a new XML file to our domain model project called <strong>Person.hbm.xml</strong>.&nbsp; NHibernate will search our assembly for embedded resources named *.hbm.xml.&nbsp; If this is mispelled or the file is not marked as an embedded resource the mapping will not be found and NHibernate won’t recognize the object.</p>


<p>&nbsp;<img src="/images/CropperCapture%5B28%5D_thumb_.jpg" alt="CropperCapture[28]"  vspace="5" /> <br clear="left">In these screen shots you can see that I have added the mapping file next to my objects and I right-clicked and selected properties.&nbsp; Then under the properties pane I clicked on <strong>Build Action</strong> and changed the value from <em>Compile </em>to <em>Embedded Resource.<a href="http://www.flux88.com/uploads/CropperCapture%5B27%5D.Jpg"><img src="/images/CropperCapture%5B27%5D_thumb_.jpg" alt="CropperCapture[27]"  vspace="5" /></a></em></p>


<br clear="left"><p>&nbsp;</p><p>Let’s take a side-by-side look at our Person class with our People database table.&nbsp; This will be&nbsp; a simple mapping because the class contains no complex associations with other classes.</p><p><img src="/images/side_2Dby_2Dside_20compare3_.jpg" alt="Side-by-side compare3"  vspace="5" /></p><p>Here you can see that we simple relate each property in our class to a column in the table.&nbsp; Address, in this example, is called&nbsp;a <em>component.</em>&nbsp; What this means is that Address&nbsp;has no table of its own;&nbsp; all of the address properties are mapped to the containing object’s table.&nbsp; We say that <em>Address is a <strong>component </strong>of Person.</em>&nbsp; I chose to represent it this way in the object model to delineate the model and separate concerns.&nbsp; It is a common occurrence for the database, however, to not employ unnecessary joins for simple associations such as this one (for performance reasons).</p><p>We start by opening our (now blank) Person.hbm.xml file.&nbsp; In order to tell Visual Studio that we want intellisense for this file, we have to create the document element (the root) called <strong>&lt;hibernate-mapping&gt;</strong>.&nbsp; We tell it which schema to use, and then intellisense kicks in.&nbsp; Also in this root element the assembly and namespace are defined.&nbsp; This saves us from typing it every time in the mapping file.&nbsp; For example, within this mapping file, <em>Person</em> will refer to the strongly typed <em>Flux88.Videocracy.DomainModel.Person, Flux88.DomainModel.Person </em>(see?&nbsp; less typing!).</p><p><em>*note:&nbsp; I have changed the Phone number properties to be plain-jane strings instead of the Phone Number class that you may have seen earlier.&nbsp; While this is a good addition, it complicates the mapping a tad too much right at first, so I removed it in favor of a simple mapping for now.</em></p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;"><span style="color: blue;">&lt;?</span><span style="color: maroon;">xml</span><span style="color: blue;"> </span><span style="color: red;">version</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">1.0</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">encoding</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">utf-8</span>&#8221;<span style="color: blue;"> ?&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: maroon;">hibernate-mapping</span><span style="color: blue;"> </span><span style="color: red;">xmlns</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">urn:nhibernate-mapping-2.0</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">assembly</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.DomainModel</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: red;">namespace</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.DomainModel</span>&#8221;<span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&lt;/</span><span style="color: maroon;">hi


<p>bernate-mapping</span><span style="color: blue;">&gt;</span></p></div><!--EndFragment--><p>The next element in this mapping will be our class:</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;"><span style="color: blue;">&lt;?</span><span style="color: maroon;">xml</span><span style="color: blue;"> </span><span style="color: red;">version</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">1.0</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">encoding</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">utf-8</span>&#8221;<span style="color: blue;"> ?&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: maroon;">hibernate-mapping</span><span style="color: blue;"> </span><span style="color: red;">xmlns</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">urn:nhibernate-mapping-2.0</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">namespace</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.DomainModel</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">assembly</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.DomainModel</span>&#8221;<span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&nbsp; <strong>&lt;</strong></span><strong><span style="color: maroon;">class</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Person</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">table</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">People</span>&#8221;<span style="color: blue;">&gt;</span></strong></p><p style="margin: 0px;"><strong>&nbsp;</strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">id</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Id</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">access</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">nosetter.camelcase-underscore</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">PersonId</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Int32</span>&#8221;<span style="color: blue;">&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">generator</span><span style="color: blue;"> </span><span style="color: red;">class</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">identity</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;/</span><span style="color: maroon;">id</span><span style="color: blue;">&gt;</span></strong></p><p style="margin: 0px;"><strong>&nbsp;</strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &lt;/</span><span style="color: maroon;">class</span><span style="color: blue;">&gt;</span></strong></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&lt;/</span><span style="color: maroon;">hibernate-mapping</span><span style="color: blue;">&gt;</span></p></div><!--EndFragment--><p>I have emboldened the new text.&nbsp; The name property here tells NHibernate that we are mapping our Person class, from the assembly/namespace defined above.&nbsp; The table attribute tells NHibernate which table this class maps to.&nbsp; There are a few other advanced attributes that we may define, but these will suffice for this mapping.&nbsp; </p><p>The first child of our &lt;class&gt; element is the &lt;id&gt; element.&nbsp; This tells NHibernate what our primary key is.&nbsp; You can specify a single field or multiple fields (composite-id) and define their type as well.&nbsp; Here you see that the&nbsp;name attribute refers to our&nbsp;<em>Id</em> property of the Person class.&nbsp; We do not want consumers of our objects to be able to set arbitrary values in the primary key, so this is a read only property.&nbsp; As such it does not have a setter, but NHibernate needs to know how it will set the&nbsp;value (otherwise how could it get there?).&nbsp; We give NHibernate a hint by specifying a predefined access strategy in the <strong>access</strong> attribute.&nbsp; <em>nosetter.camelcase-underscore </em>is the access strategy that we will employ.&nbsp; (This means that since our property is named <strong>Id</strong>, the private field must be named <strong><em>id</strong>).&nbsp; There are other access strategies so if you prefer naming such as <strong>m_id</strong> you can deal with that as well.&nbsp; We specify the type of our Id property (specifically Ant, which is an NHibernate Type that matches our int).</p><p>The last thing you’ll notice is that &lt;id&gt; has a &lt;generator&gt; child element.&nbsp; This tells NHibernate that we are using MS SQL Identity as our primary key generator.&nbsp; NHibernate also understands Oracle sequence, hilo, guids and other primary key generators.&nbsp; (I was happy to learn there is also a neat generator class for guid.comb, which is a sort of “ordered” guid <a title="guid.comb article by Jimmy Nilsson" href="http://www.informit.com/articles/article.asp?p=25862&amp;seqNum=7&amp;rl=1" target="_blank">conceived by Jimmy Nilsson</a>&nbsp;– if you are using Guids as primary keys, you should consider this.)</p><p>One of the reasons for specifying a generated primary key like this is so that NHibernate easily knows whether or not your object is a brand new object that needs to be <strong>inserted</strong> or a previously fetched object that might by <strong>updated</strong>&nbsp;or <strong>deleted</strong>.&nbsp; Using a guid, identity, hilo, or sequence we get the benefit of just calling <em>Session.SaveOrUpdate(myObject)</em> and NHibernate knows whether to generate an insert or update behind-the-scenes.</p><p>Here’s the rest of the Person class mapping file:</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;"><span style="color: blue;">&lt;?</span><span style="color: maroon;">xml</span><span style="color: blue;"> </span><span style="color: red;">version</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">1.0</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">encoding</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">utf-8</span>&#8221;<span style="color: blue;"> ?&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">&lt;</span><span style="color: maroon;">hibernate-mapping</span><span style="color: blue;"> </span><span style="color: red;">xmlns</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">urn:nhibernate-mapping-2.0</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">namespace</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.D
omainModel</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">assembly</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Flux88.Videocracy.DomainModel</span>&#8221;<span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &lt;</span><span style="color: maroon;">class</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Person</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">table</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">People</span>&#8221;<span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">id</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Id</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">access</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">nosetter.camelcase-underscore</span>&#8221;<span style="color: blue;"> </span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">PersonId</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Int32</span>&#8221;<span style="color: blue;">&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">generator</span><span style="color: blue;"> </span><span style="color: red;">class</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">identity</span>&#8221;<span style="color: blue;"> /&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; &lt;/</span><span style="color: maroon;">id</span><span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &nbsp; <strong>&lt;</strong></span><strong><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">FirstName</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">100</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">firstName</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; </span><span style="color: red;">not-null</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">true</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">LastName</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">100</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">lastName</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; </span><span style="color: red;">not-null</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">true</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">HomePhone</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">50</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">primaryPhone</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; </span><span style="color: red;">not-null</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">true</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">AltPhone</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">50</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">altPhone</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">DateOfBirth</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">DateTime</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">dateOfBirth</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; </span><span style="color: red;">not-null</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">true</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong>&nbsp;</strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;</span><span style="color: maroon;">component</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Address</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">class</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Address</span>&#8221;<span style="color: blue;">&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Line1</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">100</span>&#8221;<span style="co
lor: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">addressLine1</span>&#8221;<span style="color: blue;"> </span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: red;">not-null</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">true</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Line2</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">100</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">addressLine2</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">City</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">100</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">city</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">State</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">50</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">state</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &nbsp; &lt;</span><span style="color: maroon;">property</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">Zip</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">type</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">String</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">length</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">50</span>&#8221;<span style="color: blue;"> </span><span style="color: red;">column</span><span style="color: blue;">=</span>&#8221;<span style="color: blue;">zip</span>&#8221;<span style="color: blue;"> /&gt;</span></strong></p><p style="margin: 0px;"><strong><span style="color: blue;">&nbsp; &nbsp; &lt;/</span><span style="color: maroon;">component</span><span style="color: blue;">&gt; </span></strong></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&nbsp; &lt;/</span><span style="color: maroon;">class</span><span style="color: blue;">&gt;</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">&lt;/</span><span style="color: maroon;">hibernate-mapping</span><span style="color: blue;">&gt;</span></p></div><!--EndFragment--><p>Here you can see that the properties are defined, along with their type (and length for strings) as well as their database column name.&nbsp; The Address component is nested within this mapping and defined with the &lt;component&gt; element.</p><p>With me so far?</p><p>So basically that’s it.&nbsp; We have a Person object and it is completely persistable.&nbsp; You tell NHibernate how to persist your object and you get all of the CRUD operations for free.&nbsp; You can create a new Person, fill out some properties, and then call Session.SaveOrUpdate(person) to save the person.&nbsp; Or you can call Session.Load(typeof(Person), personId) to fetch an existing person from the database.&nbsp; You can also query for Person objects, but we’ll get into that later.&nbsp; The point is, with NHibernate we are avoiding writing the mundane task of repetitive SQL commands and stored procedures.</p><p>Let’s prove that this works with tests.</p><p>&nbsp;The simplest way of seeing if our mapping is working or not is to actually hit the database.&nbsp; The simplest way to do this is to do a List operation, (basically SELECT * FROM table).&nbsp; If NHibernate doesn’t recognize your type the test will fail.&nbsp; If your mapping doesn’t map to valid columns or class properties, the test will fail.&nbsp; It’s slightly larger in scope than the Unit Tests, but this is actually an integration test, so it’s okay to test a broader scope.</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">TestFixture</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: teal;">PersonTester</span></p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">int</span> GetPersonCount()</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: teal;">Convert</span>.ToInt32(</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">DatabaseHelper</span>.ExecuteQuery(<span style="color: maroon;">&#8220;SELECT COUNT(<em>) FROM People&#8221;</span>));</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">void</span> TestCanListPeople()</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">using</span> (NHibernate.<span style="color: teal;">ISession</span> session = <span style="color: teal;">SessionSource</span>.Current.GetSession())</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">IList</span> people = session.CreateCriteria(<span style="color: blue;">typeof</span>(<span style="color: teal;">Person</span>)).List();</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal;">Assert</span>.IsNotNull(people, <span style="color: maroon;">&#8220;Person list should not be null.&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal;">Assert</span>.AreEqual(GetPersonCount(), people.Count, </p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;nbs
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: maroon;">&#8220;Person list didn&#8217;t have the right number of elements&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style="margin: 0px;">}</p></div><p>This tests gets a list of all of the Person records in the database (currently&nbsp;zero, but that won’t matter).&nbsp; It compares the count of this list to a SELECT COUNT(</em>) FROM People, using a helper class.&nbsp; One thing to note is that I am making this test scale with the database.&nbsp; It should always return the correct number of people.</p><p>I run the test and….</p><p><img src="/images/CropperCapture%5B33%5D_small1_.jpg" alt="CropperCapture[33]"  vspace="5" /></p><p>What?&nbsp; Our new test passed, but why did <em>CanInitializeSessionSource</em> fail?&nbsp; Upon a quick inspection, I realize that I have broken a core rule of unit testing:&nbsp; <em>Each test should run independently of other tests.</em>&nbsp; The order of test execution should not affect the outcome of the test.&nbsp; This code:</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanInitializeSessionSource()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.IsFalse(<span style="color: teal;">SessionSource</span>.Current.IsInitialized);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: teal;">SessionSource</span>.Current.Initialize();</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.IsTrue(<span style="color: teal;">SessionSource</span>.Current.IsInitialized);</p><p style="margin: 0px;">}</p></div><p>…is assuming that the current Session Source is not initialized.&nbsp; If another test that uses the SessionSource executes before us (like what happened above) then this Assertion fails.&nbsp; What we have to do is set our pre-condition explicitly:</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanInitializeSessionSource()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">//make sure we start in a known state</span></p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">SessionSource</span>.Current.Close();</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsFalse(<span style="color: teal;">SessionSource</span>.Current.IsInitialized);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">SessionSource</span>.Current.Initialize();</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsTrue(<span style="color: teal;">SessionSource</span>.Current.IsInitialized);</p><p style="margin: 0px;">}</p></div><p style="margin: 0px;"><font face="Georgia" size="2">This test fails because the .Close() method doesn’t exist yet.&nbsp; Here is the implementation that passes the test:</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;"><span style="color: green;">//SessionSource.cs</span></p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></p><p style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> Closes the current session factory.&nbsp; The next call</span></p><p style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> to initialize or GetSession will re-initialize the SessionSource</span></p><p style="margin: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> Close()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">if</span> (</em>factory == <span style="color: blue;">null</span>)</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">return</span>;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <em>factory.Close();</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; </em>initialized = <span style="color: blue;">false</span>;</p><p style="margin: 0px;">}</p></div><!--EndFragment--><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">And we’re back to all green again.</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">Next we can test to see if we can save a Person object.&nbsp; To test this we actually have to save it and verify that each property is equal to what it was saved as.&nbsp; I find this is easier to do by breaking a small rule:&nbsp; if we write the load functionality and reuse it to help Assert that our Save works, we can cut a few corners.&nbsp; I welcome any suggestions of&nbsp;a more elegant way of achieving this without resorting to a database query + column/property comparison which is tedious and boring.</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">Starting with the Load, we insert a person record into the database and verify that we can load it properly.&nbsp; I have written a simple helper class that will assist us with these database operations.&nbsp; A really quick and dirty convert-dictionary-to-insert statement is a tad on the ugly side, but this isn’t production code and it serves our purpose nicely.&nbsp; So we insert a test Person record into the database, then we load it and verify that it returns ok.</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">Before I show you this test, keep in mind that since we are inserting data into a (probably) development database, we don’t want this junk data to stick around.&nbsp; We will be running these tests over and over again, and each time it should clean up nicely.&nbsp; We can accomplish this easily by using transactions (more on this later).</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><font face="Georgia" size="2"><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> TestCanLoadAPerson()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">TransactionScope</span> tx = <span style="color: blue;">new</span> <span style="color: teal;">TransactionScope</span>();</p><p style="margin: 0px;">&amp;
nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">try</span></p><p style="margin: 0px;">&nbsp; &nbsp; {</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//first we need to insert a person&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Dictionary</span>&lt;<span style="color: blue;">string</span>, <span style="color: blue;">object</span>&gt; dictionary = <span style="color: blue;">new</span> <span style="color: teal;">Dictionary</span>&lt;<span style="color: blue;">string</span>, <span style="color: blue;">object</span>&gt;();</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;firstName&#8221;</span>, <span style="color: maroon;">&#8220;Fred&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;lastName&#8221;</span>, <span style="color: maroon;">&#8220;Flinstone&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;dateOfBirth&#8221;</span>, <span style="color: blue;">new</span> <span style="color: teal;">DateTime</span>(1925, 10, 5));</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;primaryPhone&#8221;</span>, <span style="color: maroon;">&#8220;111-222-3333&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;altPhone&#8221;</span>, <span style="color: maroon;">&#8220;444-555-6666&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;addressLine1&#8221;</span>, <span style="color: maroon;">&#8220;123 Rocky Lane&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;addressLine2&#8221;</span>, <span style="color: maroon;">&#8220;#555&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;city&#8221;</span>, <span style="color: maroon;">&#8220;Bedrock&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;state&#8221;</span>, <span style="color: maroon;">&#8220;ZZ&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; dictionary.Add(<span style="color: maroon;">&#8220;zip&#8221;</span>, <span style="color: maroon;">&#8220;12345&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">int</span> personId = <em>datasource.ExecuteDictionaryToInsertCommand(dictionary, <span style="color: maroon;">&#8220;People&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//try and fetch that person</span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">using</span> (<span style="color: teal;">ISession</span> session = <span style="color: teal;">SessionSource</span>.Current.GetSession())</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Person</span> fred = (<span style="color: teal;">Person</span>)session.Load(<span style="color: blue;">typeof</span>(<span style="color: teal;">Person</span>), personId);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//assert that fred is who we think he is</span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsNotNull(fred, <span style="color: maroon;">&#8220;Person should not be null&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(personId, fred.Id, <span style="color: maroon;">&#8220;Id was different&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;Fred&#8221;</span>, fred.FirstName, <span style="color: maroon;">&#8220;First Name was different&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;Flinstone&#8221;</span>, fred.LastName, <span style="color: maroon;">&#8220;Last Name was different&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(dictionary[<span style="color: maroon;">&#8220;dateOfBirth&#8221;</span>], fred.DateOfBirth, <span style="color: maroon;">&#8220;Date of Birth was different&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;111-222-3333&#8221;</span>, fred.HomePhone);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;444-555-6666&#8221;</span>, fred.AltPhone);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;123 Rocky Lane&#8221;</span>, fred.Address.Line1);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;#555&#8221;</span>, fred.Address.Line2);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="margin: 0px;">&nbsp; &nbsp; }</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">finally</span></p><p style="margin: 0px;">&nbsp; &nbsp; {</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//cleanup&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; datasource.Dispose();</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; tx.Dispose();</p><p style="margin: 0px;">&nbsp; &nbsp; }</p><p style="margin: 0px;">}</p></div><!--EndFragment--></font><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">Wow, that’s a long test.&nbsp; But it’s explicit and easy to follow.&nbsp; One thing I’d like to point out here is that we are combining standard ADO.NET (the </em><em>datasource</em> call above) with NHibernate’s ISession.&nbsp; It’s difficult to get these 2 to share a single transaction, so I’m using .NET 2.0’s TransactionScope which makes it easy to have a shared transactiont that works on any level.&nbsp; The downside to this is that it’s 1) slow and 2) requires configuration and enabled services, which sometimes makes it a no-go, depending on your environment.&nbsp; In other tests I’ll be able to just use NHibernate transactions and everything will be easier.&nbsp; (<abbr title="Your Milage May Vary">YMMV</abbr>).</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">In writing this test I exposed 2 or 3 different bugs with my mapping (which were then fixed).&nbsp; This is a benefit of writing the tests along with the code.&nbsp; If you wait until you have a UI to test all of this manually, you will have waited too long and will have to re-visit all of this code and remember exactly what it does and how to fix little issues.&nbsp; Our feedback loop is very tight here, and that helps us stay on track and be efficient.&nbsp; Ok, so this test is passing…. what next?</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><p style="margin: 0px;"><font face="Georgia" size="2">Before this article gets too long (too late?) I want to show one last thing.&nbsp; We’ll write a <em>CanSavePerson</em> test.&nbsp; Since we have our load already working, we’ll bend a rule and build on that:</font></p><p style="margin: 0px;"><font face="Georgia" size="2"></font>&nbsp;</p><div style="background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-ori
gin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanSavePerson()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: blue;">using</span> (<span style="color: teal;">ISession</span> session = <span style="color: teal;">SessionSource</span>.Current.GetSession())</p><p style="margin: 0px;">&nbsp; &nbsp; {</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;">using</span> (<span style="color: teal;">ITransaction</span> tx = session.BeginTransaction())</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; {</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//create a person</span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Person</span> p = <span style="color: blue;">new</span> <span style="color: teal;">Person</span>(<span style="color: maroon;">&#8220;Bruce&#8221;</span>, <span style="color: maroon;">&#8220;Wayne&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.DateOfBirth = <span style="color: blue;">new</span> <span style="color: teal;">DateTime</span>(1972, 6, 2);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.HomePhone = <span style="color: maroon;">&#8220;12345678&#8221;</span>;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.AltPhone = <span style="color: maroon;">&#8220;987675123&#8221;</span>;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.Address.Line1 = <span style="color: maroon;">&#8220;123 Bruce Manor&#8221;</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.Address.State = <span style="color: maroon;">&#8220;GT&#8221;</span>;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.Address.City = <span style="color: maroon;">&#8220;Gotham&#8221;</span>;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.Address.Zip = <span style="color: maroon;">&#8220;99999&#8221;</span>;</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: green;">//save the person</span></p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; session.Save(p);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsTrue(p.Id != 0, <span style="color: maroon;">&#8220;Save should give p it&#8217;s primary key&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Person</span> pVerify = (<span style="color: teal;">Person</span>)session.Load(<span style="color: blue;">typeof</span>(<span style="color: teal;">Person</span>), p.Id);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(p, pVerify, <span style="color: maroon;">&#8220;They weren&#8217;t the same&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="margin: 0px;">&nbsp; &nbsp; }</p><p style="margin: 0px;">}</p></div><font face="Georgia" size="2"><p>Here we create a new person object, save it to the database, then call our Load method (which we know works because of the previous test (TDD Purists won’t like this, but I haven’t seen an effective way to test this quickly).&nbsp; Our Person objects (and subsequently, our Address objects) need to overrides the .Equals() method for the last assert to work.&nbsp; As Rocky Lhotka says, let’s be good .NET citizens and override these methods in each of our objects.&nbsp; Lastly, take notice that I’m using NHibernate’s transactions which get rolled back at the end of the test.&nbsp; These don’t share the baggage of TransactionScope objects in the previous test.</p><p>This time we were able to create a mapping file for the Person object.&nbsp; We learned to make sure and set it as an embedded resource so it is recognized by NHibernate.&nbsp; Finally we learned some basic mapping concepts and backed them up with tests.</p><p>Next time we’ll introdude a few more objects and learn to map the relationships with NHibernate.</p><p>As promised, here is the current&nbsp;source code.&nbsp; It contains all of the code written up to this article.&nbsp; Comments and questions are encouraged.</p><div style="margin: 5px; padding: 5px; width: 80%; background-color: aliceblue;"><p><a href="http://www.flux88.com/uploads/Videocracy_06.zip">File Attachment: Videocracy_06.zip (39 KB)</a></p></div><p>&nbsp;<em>If you want to run the tests, you’ll need the <a title="NUnit homepage" href="http://nunit.org/" target="_blank">NUnit Gui</a> or the <a title="TestDriven.NET homepage" href="http://www.testdriven.net/" target="_blank">TestDriven.NET plugin for visual studio</a>.</em></p></font></p>
</div>
  <footer>
    <a rel="full-article" href="/2006/09/a-journey-with-domain-driven-design-and-nhibernate-part-6/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/08/i-got-my-coding-horror-sticker-today/">I Got My Coding Horror Sticker Today</a></h1>
    
    
      <p class="meta">




<time datetime="2006-08-24 00:00:00 -0500" pubdate  updated >Aug 24<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>Today I received my free&nbsp;<a title="coding horror" href="http://www.codinghorror.com/blog/archives/000659.html" target="_blank">Coding Horror Sticker </a>in the mail from Jeff Atwood. Thanks Jeff! </p>


<p><img src="/images/IMAGE_033_small_.jpg" alt="IMAGE_033"  border="0"  /></p>


<p>He even hand-wrote the envelope!&nbsp; 350 of them ?!?!</p>


<p>&nbsp;</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/08/i-got-my-coding-horror-sticker-today/">Read on &rarr;</a>
  </footer>


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/blog/page/31/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/29/">Newer &rarr;</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'subdigital';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <h1>Who am I?</h1>
  <p>I&#8217;m Ben Scheirman. I make Rails &amp; iPhone apps for <a href="http://chaione.com" target="_blank">ChaiONE</a> in Houston, TX.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/formatting-json-from-terminal/">Formatting JSON From Terminal</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/houston-tech-fest-2011-recap/">Houston Tech Fest 2011 Recap</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/appsites-is-now-appkickstand/">Appsites Is Now AppKickstand</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/sharing-vim-configuration-between-machines/">Sharing Vim Configuration Between Machines</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/making-a-uibutton-flip-over/">Making a UIButton Flip Over</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("subdigital", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/subdigital" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @subdigital</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/js/subdigital?title=&count=3&sort=date&extended"></script>
  <p><a href="http://delicious.com/subdigital">My Delicious Bookmarks &raquo;</a></p>
</section>



  
</aside>

    </div>
  </div>
  <footer>
<a style="display:block; float: right" title="Real Time Analytics" href="http://getclicky.com/66470389"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(66470389); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66470389ns.gif" /></p></noscript>

<p>
  Copyright &copy; 2011 - Ben Scheirman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
