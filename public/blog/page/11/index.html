
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fickle Bits</title>
  <meta name="author" content="Ben Scheirman">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://benscheirman.com/blog/page/11/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/ficklebits" rel="alternate" title="Fickle Bits" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-210379-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">Fickle Bits</a></h1>
  
    <h2>You're doing it wrong.</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/ficklebits" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:benscheirman.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="http://appsites.heroku.com/giggletouch">Giggle Touch for
    iOS</a></li>
  <li><a href="/blog/archives">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/houston-alt-net-geek-dinner-january-7th/">Houston ALT.NET Geek Dinner - January 7th</a></h1>
    
    
      <p class="meta">




<time datetime="2008-12-30 00:00:00 -0600" pubdate  updated >Dec 30<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p><a href="http://flux88.com/files/media/image/WindowsLiveWriter/HoustonALT.NETGeekDinnerJanuary7th_805B/63782302_e7b67dd102_m_2.jpg"><img src="/images/63782302_e7b67dd102_m_thumb.jpg" alt="63782302_e7b67dd102_m"  border="0" /></a> </p>


<p> <p>Now that the holidays are coming to a close, it&#8217;s time to get back in the grind.&nbsp; That means community, baby!&nbsp; </p> <p>We&#8217;re going to hold our semi-monthly casual Houston ALT.NET Geek Dinner at Freebird&#8217;s World Burrito near 59 &amp; Shepherd.&nbsp; If you haven&#8217;t eaten a Freebird&#8217;s burrito then you&#8217;re in for a treat.&nbsp; They&#8217;re huge and delicious.&nbsp; <em>(Veggie burritos are certainly available for you herbivores out there).</em></p> <table cellspacing="0" cellpadding="2" width="447" border="0"> <tbody> <tr> <td valign="top" width="116"><strong>When?</strong></td> <td valign="top" width="329">Wednesday Jan 07th, 2008 @ 6:00pm<br><a href="https://www.google.com/calendar/event?action=TEMPLATE&amp;tmeid=b3FnYmw1NTkyb2RjYjEzcmtqbzlxdDEwNG8gc3ViZGlnaXRhbEBt&amp;tmsrc=c3ViZGlnaXRhbEBnbWFpbC5jb20" target="_blank"><img src="/images/gc_button1_en.gif"  border="0" /></a> </td></tr> <tr> <td valign="top" width="116"><strong>Where?</strong></td> <td valign="top" width="329"><a href="http://freebirds.com/" target="_blank">Freebirds</a> (<a href="http://maps.google.com/maps?f=q&amp;hl=en&amp;geocode=&amp;q=3745+Greenbriar,+Houston&amp;sll=37.0625,-95.677068&amp;sspn=55.148262,79.101563&amp;ie=UTF8&amp;ll=29.732772,-95.41244&amp;spn=0.007472,0.009656&amp;z=17&amp;g=3745+Greenbriar,+Houston&amp;iwloc=addr" target="_blank">map</a>)</td></tr></tbody></table> <p><em></em>&nbsp;<br>Hopefully <em>somebody</em> will join me for a beer this time!</p> <p>Some topics that have been suggested:</p> <ul> <li>Oxite Aftermath</li> <li>ASP.NET MVC</li> <li>DDD Discussion</li> <li>RIA Frameworks</li> <li>DI / IoC Frameworks</li> <li>Survey:&nbsp; What are you doing to be/promote agile where you work?</li> <li>Mentoring</li> <li>The agile wall &amp; pull systems</li> <li>Cloud Computing</li> <li>DSLs</li></ul> <p>We&#8217;ll have to trim that list otherwise we&#8217;ll be there all night.&nbsp; Tell your friends, blog about it, whatever you have to do, but <em>get your co-workers out here!</em>&nbsp; Making connections in the community is a great way to becoming a better developer.</p></p>
</div>
  <footer>
    <a rel="full-article" href="/2008/12/houston-alt-net-geek-dinner-january-7th/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/hello-world-x-2/">Hello World X 2</a></h1>
    
    
      <p class="meta">




<time datetime="2008-12-10 00:00:00 -0600" pubdate  updated >Dec 10<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>&#160;<img src="/images/image0_6.jpg" alt="sonogram"  border="0"  /></p>

</div>
  <footer>
    <a rel="full-article" href="/2008/12/hello-world-x-2/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/speaking-at-the-microsoft-developer-conference/">Speaking at the Microsoft Developer Conference</a></h1>
    
    
      <p class="meta">




<time datetime="2008-12-02 00:00:00 -0600" pubdate  updated >Dec 2<span>nd</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.msdndevcon.com"><img src="/images/clip_image001_3.gif" border="0"  title="clip_image001"  /></a></p>


<h5>I&#8217;ll be speaking at the upcoming <a href="http://www.msdndevcon.com">MSDN Developer Conference</a> in Houston (on December 9th) and in Dallas (January 26th).&nbsp; The topics will be similar to what was covered at the PDC this year, so if you weren&#8217;t able to attend, be sure to check this out.</h5>


<p>It&#8217;s just $99 and there&#8217;ll be some cool prizes for attendees.</p>


<p><a href="http://www.msdndevcon.com/Pages/sessions.aspx">Check out the session line up</a>&hellip;</p>


<table width="743" cellspacing="2" cellpadding="2" align="left" unselectable="on">
<tbody>
<tr>
<th width="237" class="tableGreen">Cloud Services</th>
<th width="274" class="tableBlue">Client and Presentation</th>
<th width="282" class="tableOrange">Tools, Languages and Framework</th>
</tr>
<tr>
<td width="237">Lap Around Cloud Services</td>
<td width="274">Windows Presentation Framework (WPF) Roadmap</td>
<td width="282">The Future of Managed Languages: F#, C#, and Visual Basic</td>
</tr>
<tr>
<td width="237"><font color="#ff8000">Developing and Deploying Your First Cloud Services*</font></td>
<td width="274">Developing Data-centric Applications Using the WPF DataGrid and Ribbon Controls</td>
<td width="282">A Lap Around &quot;Oslo&quot;</td>
</tr>
<tr>
<td width="237">A Lap Around the Live Framework and Mesh Services</td>
<td width="274">Building Business Focused Applications using Silverlight 2</td>
<td width="282">&quot;Rosario&quot;: A Sprint with the Next Version of Microsoft Visual Studio Team System</td>
</tr>
<tr>
<td width="237">Developing Applications Using Data Services</td>
<td width="274"><font color="#ff8000">ASP.NET 4.0 Roadmap*</font></td>
<td width="282">Parallel Programming for Managed Code Developers</td>
</tr>
</tbody>
</table>


<p>&nbsp;</p>


<p><font color="#ff8000">* my sessions</font></p>


<p>
<table width="611" cellspacing="0" cellpadding="0" border="0" style="width: 100%;" class="locations">
<tbody>
<tr>
<th width="107">Date</th>
<th width="502">
<p align="left">City</p>
</th>
</tr>
<tr>
<td width="107">12/9/08</td>
<td width="502"><a href="http://www.msdndevcon.com/Pages/Houston.aspx">Houston, TX</a>&nbsp;</td>
</tr>
<tr>
<td width="107">1/26/09</td>
<td width="502"><a href="http://www.msdndevcon.com/Pages/Dallas.aspx">Dallas, TX</a>&nbsp;</td>
</tr>
</tbody>
</table>
</p>


<p>If you aren&#8217;t close to Houston or Dallas, the MDC is coming to a handful of other cities, so check the <a target="_blank" href="http://www.msdndevcon.com">conference website</a> for more details.</p>


<p>Hope to see you there!</p>

</div>
  <footer>
    <a rel="full-article" href="/2008/12/speaking-at-the-microsoft-developer-conference/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/fluent-route-testing-in-asp-net-mvc/">Fluent Route Testing in ASP.NET MVC</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-25 00:00:00 -0600" pubdate  updated >Nov 25<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>Have you written code like this recently?</p>


<p>&nbsp;</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red238\green238\blue238;\red32\green32\blue32;\red255\green0\blue128;\red144\green238\blue144;\red242\green240\blue223;\red192\green192\blue192;\red0\green255\blue255;}??\fs26 \cf1\cb2\highlight2 [\cf3 Test\cf1 ]\par ??\cf4 public\cf1  \cf4 void\cf1  \cf5 tedious_route_test\cf1 ()\par ??\{\par ??    \cf3 Global\cf6 .\cf5 RegisterRoutes\cf1 (\cf3 RouteTable\cf6 .\cf5 Routes\cf1 );\par ??    \cf4 var\cf1  \cf5 httpContext\cf1  \cf6 =\cf1  \cf3 MockRepository\cf6 .\cf5 GenerateStub\cf6 &lt;\cf3 HttpContextBase\cf6 &gt;\cf1 ();\par ??    \cf5 httpContext\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 Request\cf1 )\cf6 .\cf5 Return\cf1 (\cf3 MockRepository\cf6 .\cf5 GenerateStub\cf6 &lt;\cf3 HttpRequestBase\cf6 &gt;\cf1 ());\par ??    \cf5 httpContext\cf6 .\cf5 Request\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 PathInfo\cf1 )\cf6 .\cf5 Return\cf1 (\cf7 {\b ""}\cf1 );\par ??    \cf5 httpContext\cf6 .\cf5 Request\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 AppRelativeCurrentExecutionFilePath\cf1 )\cf6 .\cf5 Return\cf1 (\cf7 {\b "~/foo/bar"}\cf1 );\par ??\par ??    \cf4 var\cf1  \cf5 routeData\cf1  \cf6 =\cf1  \cf3 RouteTable\cf6 .\cf5 Routes\cf6 .\cf5 GetRouteData\cf1 (\cf5 httpContext\cf1 );\par ??\par ??    \cf3 Assert\cf6 .\cf5 That\cf1 (\cf5 routeData\cf6 .\cf5 Values\cf1 [\cf7 {\b "controller"}\cf1 ], \cf3 Is\cf6 .\cf5 EqualTo\cf1 (\cf7 {\b "foo"}\cf1 ));\par ??    \cf3 Assert\cf6 .\cf5 That\cf1 (\cf5 routeData\cf6 .\cf5 Values\cf1 [\cf7 {\b "action"}\cf1 ], \cf3 Is\cf6 .\cf5 EqualTo\cf1 (\cf7 {\b "bar"}\cf1 ));\par ??\}\par ??}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;">[<span style="color: rgb(255, 0, 128);">Test</span>]</p>
<p style="margin: 0px;"><span style="color: rgb(144, 238, 144);">public</span> <span style="color: rgb(144, 238, 144);">void</span> <span style="color: rgb(242, 240, 223);">tedious_route_test</span>()</p>
<p style="margin: 0px;">{</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Global</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">RegisterRoutes</span>(<span style="color: rgb(255, 0, 128);">RouteTable</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Routes</span>);</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">httpContext</span> <span style="color: silver;">=</span> <span style="color: rgb(255, 0, 128);">MockRepository</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GenerateStub</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">HttpContextBase</span><span style="color: silver;">&gt;</span>();</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="color: rgb(255, 0, 128);">MockRepository</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GenerateStub</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">HttpRequestBase</span><span style="color: silver;">&gt;</span>());</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">PathInfo</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="font-weight: bold; color: aqua;">&quot;&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">AppRelativeCurrentExecutionFilePath</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="font-weight: bold; color: aqua;">&quot;~/foo/bar&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">routeData</span> <span style="color: silver;">=</span> <span style="color: rgb(255, 0, 128);">RouteTable</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Routes</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetRouteData</span>(<span style="color: rgb(242, 240, 223);">httpContext</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span>[<span style="font-weight: bold; color: aqua;">&quot;controller&quot;</span>], <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="font-weight: bold; color: aqua;">&quot;foo&quot;</span>));</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span>[<span style="font-weight: bold; color: aqua;">&quot;action&quot;</span>], <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="font-weight: bold; color: aqua;">&quot;bar&quot;</span>));</p>
<p style="margin: 0px;">}</p>
</div>


<p>This mess of nastiness is what is required to test your routes in ASP.NET MVC.&nbsp; There are a number of things wrong with this.&nbsp; First and foremost, we&#8217;re doing magical-mocking here.&nbsp; That is - we somehow know exactly the two properties we need to mock for this to work.&nbsp; It turns out this isn&#8217;t such a magical process as it is looking at reflector and a lot of trial and error.&nbsp; The next thing wrong that I see is that our route values (and keys) are case-insensitive, so we&#8217;d need to include some more flexibility in our Asserts here.</p>


<p>Who wants to deal with that mess?&nbsp; I sure don&#8217;t.&nbsp; Last night, my pal &amp; co-author <a href="http://www.lostechies.com/blogs/jimmy_bogard" target="_blank">Jimmy Bogard</a> banged together a fluent API for testing routes without needing all of this crap.</p>


<p>Here is a test to verify our root route is working properly:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red0\green255\blue255;\red32\green32\blue32;\red192\green192\blue192;\red242\green240\blue223;\red238\green238\blue238;\red255\green0\blue128;}??\fs26 \cf1\cb2\highlight2 {\b "~/"}\cf3 .\cf4 Route\cf5 ()\cf3 .\cf4 ShouldMapTo\cf3 &lt;\cf6 FooController\cf3 &gt;\cf5 (); }
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="font-weight: bold; color: aqua;">&quot;~/&quot;</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Route</span>()<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">FooController</span><span style="color: silver;">&gt;</span>();</p>
</div>


<p>And a more complex case where we have an action parameter:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red0\green255\blue255;\red32\green32\blue32;\red192\green192\blue192;\red242\green240\blue223;\red238\green238\blue238;\red255\green0\blue128;}??\fs26 \cf1\cb2\highlight2 {\b "~/foo/bar/widget"}\cf3 .\cf4 Route\cf5 ()\cf3 .\cf4 ShouldMapTo\cf3 &lt;\cf6 FooController\cf3 &gt;\cf5 (\cf4 x\cf5  \cf3 =&gt;\cf5  \cf4 x\cf3 .\cf4 Bar\cf5 (\cf1 {\b "widget"}\cf5 ));}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="font-weight: bold; color: aqua;">&quot;~/foo/bar/widget&quot;</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Route</span>()<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">FooController</span><span style="color: silver;">&gt;</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Bar</span>(<span style="font-weight: bold; color: aqua;">&quot;widget&quot;</span>));</p>
</div>


<p>These are a lot nicer, as we are dealing with no unnecessary string here, the controller are now strongly-typed (we get intellisense and refactoring support), and we can easily test routes with a single line.</p>


<p>This does have a couple caveats though:&nbsp; it assumes</p>


<ul>
<li>you&#8217;re using NUnit</li>
<li>you&#8217;re using RhinoMocks</li>
<li>you add your routes to the RouteTable.Routes collection</li>
</ul>


<p>So how did we do this?&nbsp; I have to admit, I tried to get this to work on the bus ride to work, but without an internet connection I was dead in the water.&nbsp; Jimmy helped me grasp the way that Expression&lt;T&gt; works.&nbsp; His wise words were: &quot;Here&#8217;s where you just set a breakpoint and fire up the debugger and look.&quot;&nbsp; He&#8217;s right - the API there is quite opaque.&nbsp; But once I got it to&nbsp; work it made a lot of sense.&nbsp; Expression&lt;T&gt; is awesome!</p>


<p>Here&#8217;s the method with most of the goods:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red144\green238\blue144;\red32\green32\blue32;\red238\green238\blue238;\red255\green0\blue128;\red242\green240\blue223;\red192\green192\blue192;\red255\green255\blue0;\red0\green255\blue255;\red164\green164\blue164;}??\fs26 \cf1\cb2\highlight2 public\cf3  \cf1 static\cf3  \cf4 RouteData\cf3  \cf5 ShouldMapTo\cf6 &lt;\cf5 TController\cf6 &gt;\cf3 (\cf1 this\cf3  \cf4 RouteData\cf3  \cf5 routeData\cf3 , \cf4 Expression\cf6 &lt;\cf7 Func\cf6 &lt;\cf5 TController\cf3 , \cf4 ActionResult\cf6 &gt;&gt;\cf3  \cf5 action\cf3 )\par ??    \cf1 where\cf3  \cf5 TController\cf3  : \cf4 Controller\par ??\cf3 \{            \par ??    \cf4 Assert\cf6 .\cf5 That\cf3 (\cf5 routeData\cf3 , \cf4 Is\cf6 .\cf5 Not\cf6 .\cf5 Null\cf3 , \cf8 {\b "The URL did not match any route"}\cf3 );\par ??\par ??    \cf9 {\b //check controller}\par ??\cf3     \cf5 routeData\cf6 .\cf5 ShouldMapTo\cf6 &lt;\cf5 TController\cf6 &gt;\cf3 ();\par ??    \par ??    \cf9 {\b //check action}\par ??\cf3     \cf1 var\cf3  \cf5 methodCall\cf3  \cf6 =\cf3  (\cf4 MethodCallExpression\cf3 ) \cf5 action\cf6 .\cf5 Body\cf3 ;\par ??    \cf1 string\cf3  \cf5 actualAction\cf3  \cf6 =\cf3  \cf5 routeData\cf6 .\cf5 Values\cf6 .\cf5 GetValue\cf3 (\cf8 {\b "action"}\cf3 )\cf6 .\cf5 ToString\cf3 ();\par ??    \cf1 string\cf3  \cf5 expectedAction\cf3  \cf6 =\cf3  \cf5 methodCall\cf6 .\cf5 Method\cf6 .\cf5 Name\cf3 ;\par ??    \cf5 actualAction\cf6 .\cf5 AssertSameStringAs\cf3 (\cf5 expectedAction\cf3 );\par ??                \par ??    \cf9 {\b //check parameters}\par ??\cf3     \cf1 for\cf3  (\cf1 int\cf3  \cf5 i\cf3  \cf6 =\cf3  \cf8 0\cf3 ; \cf5 i\cf3  \cf6 &lt;\cf3  \cf5 methodCall\cf6 .\cf5 Arguments\cf6 .\cf5 Count\cf3 ; \cf5 i\cf6 ++\cf3 )\par ??    \{\par ??        \cf1 string\cf3  \cf5 name\cf3  \cf6 =\cf3  \cf5 methodCall\cf6 .\cf5 Method\cf6 .\cf5 GetParameters\cf3 ()[\cf5 i\cf3 ]\cf6 .\cf5 Name\cf3 ;\par ??        \cf1 object\cf3  \cf5 value\cf3  \cf6 =\cf3  ((\cf4 ConstantExpression\cf3 ) \cf5 methodCall\cf6 .\cf5 Arguments\cf3 [\cf5 i\cf3 ])\cf6 .\cf5 Value\cf3 ;\par ??\par ??        \cf4 Assert\cf6 .\cf5 That\cf3 (\cf5 routeData\cf6 .\cf5 Values\cf6 .\cf5 GetValue\cf3 (\cf5 name\cf3 ), \cf4 Is\cf6 .\cf5 EqualTo\cf3 (\cf5 value\cf6 .\cf5 ToString\cf3 ()));\par ??    \}\par ??\par ??    \cf1 return\cf3  \cf5 routeData\cf3 ;\par ??\}\par ??}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="color: rgb(144, 238, 144);">public</span> <span style="color: rgb(144, 238, 144);">static</span> <span style="color: rgb(255, 0, 128);">RouteData</span> <span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span><span style="color: silver;">&gt;</span>(<span style="color: rgb(144, 238, 144);">this</span> <span style="color: rgb(255, 0, 128);">RouteData</span> <span style="color: rgb(242, 240, 223);">routeData</span>, <span style="color: rgb(255, 0, 128);">Expression</span><span style="color: silver;">&lt;</span><span style="color: yellow;">Func</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span>, <span style="color: rgb(255, 0, 128);">ActionResult</span><span style="color: silver;">&gt;&gt;</span> <span style="color: rgb(242, 240, 223);">action</span>)</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">where</span> <span style="color: rgb(242, 240, 223);">TController</span> : <span style="color: rgb(255, 0, 128);">Controller</span></p>
<p style="margin: 0px;">{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span>, <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Not</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Null</span>, <span style="font-weight: bold; color: aqua;">&quot;The URL did not match any route&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check controller</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span><span style="color: silver;">&gt;</span>();</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check action</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">methodCall</span> <span style="color: silver;">=</span> (<span style="color: rgb(255, 0, 128);">MethodCallExpression</span>) <span style="color: rgb(242, 240, 223);">action</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Body</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">actualAction</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetValue</span>(<span style="font-weight: bold; color: aqua;">&quot;action&quot;</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ToString</span>();</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">expectedAction</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Method</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Name</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">actualAction</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">AssertSameStringAs</span>(<span style="color: rgb(242, 240, 223);">expectedAction</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check parameters</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">for</span> (<span style="color: rgb(144, 238, 144);">int</span> <span style="color: rgb(242, 240, 223);">i</span> <span style="color: silver;">=</span> <span style="color: aqua;">0</span>; <span style="color: rgb(242, 240, 223);">i</span> <span style="color: silver;">&lt;</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Arguments</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Count</span>; <span style="color: rgb(242, 240, 223);">i</span><span style="color: silver;">++</span>)</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">name</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Method</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetParameters</span>()[<span style="color: rgb(242, 240, 223);">i</span>]<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Name</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">object</span> <span style="color: rgb(242, 240, 223);">value</span> <span style="color: silver;">=</span> ((<span style="color: rgb(255, 0, 128);">ConstantExpression</span>) <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Arguments</span>[<span style="color: rgb(242, 240, 223);">i</span>])<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Value</span>;</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetValue</span>(<span style="color: rgb(242, 240, 223);">name</span>), <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="color: rgb(242, 240, 223);">value</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ToString</span>()));</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">return</span> <span style="color: rgb(242, 240, 223);">routeData</span>;</p>
<p style="margin: 0px;">}</p>
</div>


<p>This might be a tad brittle, but in my preliminary testing it worked wonders.&nbsp; This code is now in <a href="http://mvccontrib.org" target="_blank">MvcContrib</a>&#8217;s TestHelper project.&nbsp;</p>


<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:b04a1ca3-9141-402a-955f-b9b27054f6ac" style="margin: 0px; padding: 0px; display: inline;">Technorati Tags: <a href="http://technorati.com/tags/asp.net%20mvc" rel="tag">asp.net mvc</a></div>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/fluent-route-testing-in-asp-net-mvc/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/subsonic-and-projections/">SubSonic and Projections</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-11 00:00:00 -0600" pubdate  updated >Nov 11<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve said in the past that we use SubSonic on my current project.&#160; It does what it says it does (mostly) and generates some usable code off of an existing database.&#160; I do have my qualms about it, mostly because of my bias to look at things from the object/domain world rather than the database world.&#160; But I am a committer, so my energy complaining would be better off contributing goodness to the project.</p>


<p>  <p>With the most recent release of the new query API in SubSonic, we were given a lot of flexibility.&#160; This was much needed in our project because getting single results and collections off of a single entity is rarely sufficient for complex applications.&#160; Often times the data needed to display on a page comes from multiple tables.</p>  <p>In the past, I was forced to do this sort of ugly nastiness:</p></p>

<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>&lt;span class="rem">//get schedules (1 query)&lt;/span>
</div><div class='line'>Schedule[] schedules = _repository.GetSchedulesInRange(start, end);
</div><div class='line'>&lt;span class="rem">//get employee info (2 queries)&lt;/span>
</div><div class='line'>Employee[] employees = _repository.GetEmployeesInSchedules(schedules);
</div><div class='line'>ScheduleDisplayMapper mapper = &lt;span class="kwrd">new&lt;/span> ScheduleDisplayMapper();
</div><div class='line'>&lt;span class="kwrd">return&lt;/span> mapper.Map(schedules, employees);</div></code></pre></td></tr></table></div></figure></div>




<p>This function returned an array of `ScheduleDTO` objects that were used to bind to a view.&#160; The lack of joins at the database level was really killing our productivity and in some cases, performance.&#160; It often took more code to write the query than you&#8217;d expect, because you would have to perform it in steps.</p>


<blockquote>
<p>Note: I&#8217;m really pragmatic about performance, so 2 queries when 1 is possible doesn&#8217;t usually matter in the long run.&#160; Of course if this *is* a perf bottleneck, then of course, optimize.&#160; I much prefer to balance programmer performance over unnoticeable application performance.</p>
</blockquote>


<p>With the new query API, I can now do this:</p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>SqlQuery query = &lt;span class="kwrd">new&lt;/span> Select()
</div><div class='line'>.From&lt;OnCallSchedule&gt;()
</div><div class='line'>.InnerJoin(Area.AreaIdColumn, OnCallSchedule.AreaIdColumn)
</div><div class='line'>.InnerJoin(EmployeeProfile.EmployeeProfileIdColumn, OnCallSchedule.EmployeeProfileIdColumn)
</div><div class='line'>.Where(OnCallSchedule.StartDtColumn).IsLessThanOrEqualTo(date)
</div><div class='line'>.And(OnCallSchedule.EndDtColumn).IsGreaterThanOrEqualTo(date)
</div><div class='line'>.OpenExpression()
</div><div class='line'>.And(Area.AreaIdColumn).IsNull()
</div><div class='line'>.Or(Area.AreaIdColumn).IsEqualTo(areaId)
</div><div class='line'>.CloseExpression()
</div><div class='line'>.OrderAsc(OnCallSchedule.PriorityColumn.ColumnName);</div></code></pre></td></tr></table></div></figure></div>




<p>I get complete refactoring support, intellisense, and type-safety.&#160; But now we have a different problem:&#160; we&#8217;re not returning a single entity anymore.&#160; We&#8217;re returning a combination of columns from different tables.</p>


<p>To build my DTO objects, I then had to resort to functions like this:</p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
<span class='line'>12</span>
<span class='line'>13</span>
<span class='line'>14</span>
<span class='line'>15</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">static&lt;/span> ScheduleDTO FetchFromRow(IDataReader dr)
</div><div class='line'>{
</div><div class='line'>&lt;span class="kwrd">int&lt;/span> i = 0;
</div><div class='line'>ScheduleDTO schedule = &lt;span class="kwrd">new&lt;/span> ScheduleDTO();
</div><div class='line'>schedule.OnCallScheduleId = dr.GetGuid(i++);
</div><div class='line'>schedule.Start = dr.GetDateTime(i++);
</div><div class='line'>schedule.End = dr.GetDateTime(i++);
</div><div class='line'>schedule.Comments = dr[i++] &lt;span class="kwrd">as&lt;/span> &lt;span class="kwrd">string&lt;/span>;
</div><div class='line'>schedule.Priority = dr.GetInt32(i++);
</div><div class='line'>schedule.EmployeeProfileId = dr.GetGuid(i++);
</div><div class='line'>&lt;span class="kwrd">string&lt;/span> firstName = dr.GetString(i++);
</div><div class='line'>&lt;span class="kwrd">string&lt;/span> lastName = dr.GetString(i++);
</div><div class='line'>schedule.EmployeeName = firstName + &lt;span class="str">&quot; &quot;&lt;/span> + lastName;
</div><div class='line'>&lt;span class="kwrd">return&lt;/span> schedule;
</div><div class='line'>}</div></code></pre></td></tr></table></div></figure></div>




<p><strong>Excuse me while I go vomit</strong>.&#160; This code gives me nightmares from the days when I wrote my own data access layer by hand.&#160; We as programmers should never be writing code that is simply of the form <em>copy this value to that value.&#160; Cast X to Y</em>.&#160; It&#8217;s specifically the reason why data binding exists for forms.</p>


<p>After writing two of these methods I decided we need to come up with a better way.&#160; I wanted to declaratively say, this <em>DTO maps to these columns</em>.&#160; We don&#8217;t have .NET 3.5, so magic-y lambda syntax is out.</p>


<p>I decided to lean on attributes.&#160; Yes, this does add some &quot;database-y&quot; things on my DTOs, but I figured the baggage was worth it.&#160; I created a custom attribute to map properties on my DTOs to columns on a result set.</p>


<p></p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
<span class='line'>12</span>
<span class='line'>13</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>[AttributeUsage(AttributeTargets.Property)]
</div><div class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">class&lt;/span> MapToColumnAttribute : Attribute
</div><div class='line'>{
</div><div class='line'>&lt;span class="kwrd">private&lt;/span> &lt;span class="kwrd">readonly&lt;/span> &lt;span class="kwrd">string&lt;/span> _columnName;
</div><div class='line'>&lt;span class="kwrd">public&lt;/span> MapToColumnAttribute(&lt;span class="kwrd">string&lt;/span> columnName)
</div><div class='line'>{
</div><div class='line'>_columnName = columnName;
</div><div class='line'>}
</div><div class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">string&lt;/span> ColumnName
</div><div class='line'>{
</div><div class='line'>get { &lt;span class="kwrd">return&lt;/span> _columnName; }
</div><div class='line'>}
</div><div class='line'>}</div></code></pre></td></tr></table></div></figure></div>




<p></p>


<p>Now to decorate my DTO&#8230;.</p>


<p></p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
<span class='line'>12</span>
<span class='line'>13</span>
<span class='line'>14</span>
<span class='line'>15</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">class&lt;/span> ScheduleDTO
</div><div class='line'>{
</div><div class='line'>[MapToColumn(OnCallSchedule.Columns.Priority)]
</div><div class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">int&lt;/span> Priority
</div><div class='line'>{
</div><div class='line'>get { &lt;span class="kwrd">return&lt;/span> _priority; }
</div><div class='line'>set { _priority = &lt;span class="kwrd">value&lt;/span>; }
</div><div class='line'>}
</div><div class='line'>[MapToColumn(EmployeeProfile.Columns.EmployeeProfileId)]
</div><div class='line'>&lt;span class="kwrd">public&lt;/span> Guid ProfileId
</div><div class='line'>{
</div><div class='line'>get { &lt;span class="kwrd">return&lt;/span> _profileId; }
</div><div class='line'>set { _profileId = &lt;span class="kwrd">value&lt;/span>; }
</div><div class='line'>}
</div><div class='line'>&lt;span class="rem">/* snip */&lt;/span></div></code></pre></td></tr></table></div></figure></div>




<p></p>


<p>SubSonic has a struct called <em>Columns</em> that contains all of the column names. I had to edit the default template to make these constants rather than statics, so that they would be usable in the attribute constructors.</p>


<p>Now that all of the mapping information has been provided declaratively, I can now leverage a generic mapper class to do the copying form DataReader over to DTO.</p>


<p></p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
<span class='line'>7</span>
<span class='line'>8</span>
<span class='line'>9</span>
<span class='line'>10</span>
<span class='line'>11</span>
<span class='line'>12</span>
<span class='line'>13</span>
<span class='line'>14</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>&lt;span class="kwrd">public&lt;/span> T Map&lt;T&gt;(IDataReader dr) &lt;span class="kwrd">where&lt;/span> T : &lt;span class="kwrd">new&lt;/span>()
</div><div class='line'>{
</div><div class='line'>Type type = &lt;span class="kwrd">typeof&lt;/span>(T);
</div><div class='line'>T target = &lt;span class="kwrd">new&lt;/span> T();
</div><div class='line'>&lt;span class="kwrd">foreach&lt;/span>(PropertyInfo property &lt;span class="kwrd">in&lt;/span> type.GetProperties())
</div><div class='line'>{
</div><div class='line'>&lt;span class="kwrd">foreach&lt;/span>(MapToColumnAttribute attr &lt;span class="kwrd">in&lt;/span> ReflectionUtil.GetAttributes&lt;MapToColumnAttribute&gt;(property))
</div><div class='line'>{
</div><div class='line'>&lt;span class="kwrd">object&lt;/span> &lt;span class="kwrd">value&lt;/span> = dr[attr.ColumnName];
</div><div class='line'>property.SetValue(target, &lt;span class="kwrd">value&lt;/span>, &lt;span class="kwrd">null&lt;/span>);
</div><div class='line'>}
</div><div class='line'>}
</div><div class='line'>&lt;span class="kwrd">return&lt;/span> target;
</div><div class='line'>}</div></code></pre></td></tr></table></div></figure></div>




<p></p>


<p>This function takes a DataReader that currently on a record, loops over the properties of the DTO looking for our attribute.&#160; It then sets the value using reflection.&#160; The beauty of this is, I don&#8217;t have to worry about casting anything.&#160; As long as the types of the columns match up with the type of the property, then we&#8217;re golden.</p>


<p>The act of mapping projections of entities onto flat data transfer objects is now incredibly simple:</p>


<p></p>




<div><figure role=code><div class="highlight"><table cellpadding="0" cellspacing="0"><tr><td class="gutter"><pre class="line-numbers"><span class='line'>1</span>
<span class='line'>2</span>
<span class='line'>3</span>
<span class='line'>4</span>
<span class='line'>5</span>
<span class='line'>6</span>
</pre></td><td class='code' width='100%'><pre><code class=''><div class='line'>ProjectionMapper mapper = &lt;span class="kwrd">new&lt;/span> ProjectionMapper();
</div><div class='line'>&lt;span class="kwrd">using&lt;/span>(IDataReader dr = query.ExecuteReader())
</div><div class='line'>{
</div><div class='line'>&lt;span class="kwrd">while&lt;/span>(dr.Read())
</div><div class='line'>results.Add(mapper.Map&lt;ScheduleDTO&gt;(dr));
</div><div class='line'>}</div></code></pre></td></tr></table></div></figure></div>




<p></p>


<p></p>


<p>You can take this one step further to encapsulate the looping over the data reader as well.</p>


<p>It was a nice feeling to be able to remove 17 lines of query code and 1 40 line mapping class and replace it with a tighter query and a few attributes.</p>


<p>Deleting code is fun.</p>


<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:226b7435-322b-43b9-b942-f3fbbede0838" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: <a href="http://technorati.com/tags/SubSonic" rel="tag">SubSonic</a></div>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/subsonic-and-projections/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/photos/">Photos</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-11 00:00:00 -0600" pubdate  updated >Nov 11<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p><em>This album displays photos from my <a target="_blank" href="http://flickr.com/photos/bensilvia">Flickr</a> account.</em></p>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/photos/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/new-blog-design-platform/">New Blog Design / Platform</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-10 00:00:00 -0600" pubdate  updated >Nov 10<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>My blog is now running on <a href="http://graffiticms.com">Graffiti</a>. &nbsp;I also updated the design a little bit. &nbsp;I decided that after the lack of stability on my VPS with <a href="http://godaddy.com">Go Daddy</a> that I&#8217;d try out a real host. &nbsp;So I&#8217;ve moved my blog over to <a href="http://www.orcsweb.com">ORCS Web</a>. &nbsp;So far, things are great.</p>


<p>Graffiti has a tool to import posts from DasBlog, which is nice, however I wanted to preserve all of my old posts. &nbsp;A simple lookup table, joined with the new Graffiti Posts table gave me the information I needed to map the URLs. &nbsp;Then I created an HttpModule to intercept requests for the old URLs and 301 redirect them to the new ones.</p>


<p>I tested about 20 URLs and it worked fine for me, but if you notice a post that no longer works, please let me know!</p>


<p>What do <em>you</em> think of the new blog?</p>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/new-blog-design-platform/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/contact/">Contact</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-09 00:00:00 -0600" pubdate  updated >Nov 9<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>Fill out the form below to get in touch with me.</p>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/contact/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/book/">Book</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-09 00:00:00 -0600" pubdate  updated >Nov 9<span>th</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p><strong>Update: &nbsp;The book is finished! &nbsp;You can purchase it at <a href="http://manning.com/palermo">Manning</a> or <a href="http://www.amazon.com/ASP-NET-MVC-Action-Jeffrey-Palermo/dp/1933988622/ref=sr_1_5?ie=UTF8&amp;s=books&amp;qid=1250604657&amp;sr=8-5">Amazon</a>.</strong></p>


<p><img alt="" src="http://jeffreypalermo.com/files/media/image/WindowsLiveWriter/ASP.NETMVCinActionbookcompleteandheadedt_7A74/image_caa2976c-de99-4b61-a7c8-7a32ef519518.png" />&nbsp;I&#8217;m currently writing a book called ASP.NET MVC in Action with <a target="_blank" href="http://www.jeffreypalermo.com">Jeffrey Palermo</a> and <a href="http://www.lostechies.com/blogs/jimmy_bogard/">Jimmy Bogard</a>. &nbsp;You can get early PDFs from <a href="http://manning.com/palermo">Manning&#8217;s Early Access Program</a>. &nbsp;If you&#8217;re interested in ASP.NET MVC, be sure to pick it up!</p>


<p>The book will not be your typical introductory text. &nbsp;Instead, we&#8217;re focusing on realistic usage, such as encouraging &amp; facilitating test-driven development, leveraging inversion of control frameworks, and adhering to good software development principles like Single Responsibility.</p>


<p>You can take a look at our sample application for the book, <a target="_blank" href="http://codecampserver.org">Code Camp Server</a>.</p>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/book/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/about-me/">About Me</a></h1>
    
    
      <p class="meta">




<time datetime="2008-11-01 00:00:00 -0500" pubdate  updated >Nov 1<span>st</span>, 2008</time>


</p>
    
  </header>


  <div class="entry-content"><p>My name is Ben Scheirman. &nbsp;I am the Director of Development at <a href="http://www.chaione.com">ChaiONE</a> in Houston, TX.</p>


<p>I started out programming when I was 13, tinkering with QBASIC and creating simple games and screensavers. &nbsp;My favorite experience was creating a fake application called &quot;DELBUG&quot; that &quot;removes bugs from programs.&quot; &nbsp;It proceeded to tell the user that it had no choice but to format their hard drive. &nbsp;After that, I was hooked.</p>


<p>I took Computer Science classes all through high school, and then took the passion to college as well.&nbsp; I received a Bachelor&#8217;s degree in Computer Science from the University of Houston in 2004.</p>


<p>On this blog you&rsquo;ll find my random tidbits about software development as I evolve in my craft. &nbsp;Currently, I&#8217;m interested in agile practices such as test-driven development, refactoring, continuous integration, domain driven design, and more.&nbsp; I also frequently cover object-relational mapping concepts with NHibernate.&nbsp; I&#8217;m highly interested in both web and iPhone development.</p>


<p>My platforms of choice (in no particular order):&nbsp; .NET, Rails, iPhone</p>


<p>Languages:&nbsp; C#, Ruby, Objective-C, JavaScript, Boo</p>


<p>I wrote a   <a href="http://www.amazon.com/gp/product/1933988622?ie=UTF8&amp;tag=flux88com-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1933988622">book</a><img width="1" height="1" border="0" style="border: medium none ! important; margin: 0px ! important;" alt="" src="http://www.assoc-amazon.com/e/ir?t=flux88com-20&amp;l=as2&amp;o=1&amp;a=1933988622" />&nbsp;(and a <a href="http://manning.com/palermo2/">2nd edition</a>)  and an <a href="http://pockettabs.com">iPhone app</a> that you might want to check out.</p>


<p>I enjoy reading, but the only thing that captures my attention are technical books.&nbsp; My reading list is growing faster than I can possibly read them! &nbsp;</p>


<p>I live in Houston with my wife and <strike>three</strike>&nbsp;<strong>five</strong> beautiful children.&nbsp; When I&rsquo;m not working, I&rsquo;m usually hanging out with my family, playing video games, or playing guitar.</p>


<p>Thanks for looking!</p>

</div>
  <footer>
    <a rel="full-article" href="/2008/11/about-me/">Read on &rarr;</a>
  </footer>


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/blog/page/12/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/10/">Newer &rarr;</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'subdigital';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <h1>Who am I?</h1>
  <p>I&#8217;m Ben Scheirman. I make Rails &amp; iPhone apps for <a href="http://chaione.com" target="_blank">ChaiONE</a> in Houston, TX.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/10/sharing-vim-configuration-between-machines/">Sharing Vim Configuration Between Machines</a>
      </li>
    
      <li class="post">
        <a href="/2011/10/making-a-uibutton-flip-over/">Making a UIButton Flip Over</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/creating-a-glow-effect-for-uilabel-and-uibutton/">Creating a Glow Effect for UILabel and UIButton</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/introducing-appsites/">Introducing App Sites</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/firebug-style-debugging-for-ios/">Firebug-Style Visual Debugging for iOS</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("subdigital", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/subdigital" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @subdigital</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/js/subdigital?title=&count=3&sort=date&extended"></script>
  <p><a href="http://delicious.com/subdigital">My Delicious Bookmarks &raquo;</a></p>
</section>



  
</aside>

    </div>
  </div>
  <footer>
<a style="display:block; float: right" title="Real Time Analytics" href="http://getclicky.com/66470389"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(66470389); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66470389ns.gif" /></p></noscript>

<p>
  Copyright &copy; 2011 - Ben Scheirman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
