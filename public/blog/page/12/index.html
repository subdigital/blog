
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fickle Bits</title>
  <meta name="author" content="Ben Scheirman">

  
  <meta name="description" content="I&#8217;ll be speaking at the upcoming MSDN Developer Conference in Houston (on December 9th) and in Dallas (January 26th).&nbsp; The topics will be &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://benscheirman.com/blog/page/12/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/ficklebits" rel="alternate" title="Fickle Bits" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-210379-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Fickle Bits</a></h1>
  
    <h2>You're doing it wrong.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/ficklebits" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:benscheirman.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="/projects">Projects</a></li>
  <!-- <li><a href="http://giggletouch.com">Giggle Touch</a></li> -->
  <!-- <li><a href="http://appkickstand.com">AppKickstand</a></li> -->
  <li><a href="/blog/archives">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/speaking-at-the-microsoft-developer-conference/">Speaking at the Microsoft Developer Conference</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-12-02T00:00:00-06:00" pubdate data-updated="true">Dec 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.msdndevcon.com"><img src="/images/clip_image001_3.gif" border="0"  title="clip_image001"  /></a></p>


<h5>I&#8217;ll be speaking at the upcoming <a href="http://www.msdndevcon.com">MSDN Developer Conference</a> in Houston (on December 9th) and in Dallas (January 26th).&nbsp; The topics will be similar to what was covered at the PDC this year, so if you weren&#8217;t able to attend, be sure to check this out.</h5>


<p>It&#8217;s just $99 and there&#8217;ll be some cool prizes for attendees.</p>


<p><a href="http://www.msdndevcon.com/Pages/sessions.aspx">Check out the session line up</a>&hellip;</p>


<table width="743" cellspacing="2" cellpadding="2" align="left" unselectable="on">
<tbody>
<tr>
<th width="237" class="tableGreen">Cloud Services</th>
<th width="274" class="tableBlue">Client and Presentation</th>
<th width="282" class="tableOrange">Tools, Languages and Framework</th>
</tr>
<tr>
<td width="237">Lap Around Cloud Services</td>
<td width="274">Windows Presentation Framework (WPF) Roadmap</td>
<td width="282">The Future of Managed Languages: F#, C#, and Visual Basic</td>
</tr>
<tr>
<td width="237"><font color="#ff8000">Developing and Deploying Your First Cloud Services*</font></td>
<td width="274">Developing Data-centric Applications Using the WPF DataGrid and Ribbon Controls</td>
<td width="282">A Lap Around &quot;Oslo&quot;</td>
</tr>
<tr>
<td width="237">A Lap Around the Live Framework and Mesh Services</td>
<td width="274">Building Business Focused Applications using Silverlight 2</td>
<td width="282">&quot;Rosario&quot;: A Sprint with the Next Version of Microsoft Visual Studio Team System</td>
</tr>
<tr>
<td width="237">Developing Applications Using Data Services</td>
<td width="274"><font color="#ff8000">ASP.NET 4.0 Roadmap*</font></td>
<td width="282">Parallel Programming for Managed Code Developers</td>
</tr>
</tbody>
</table>


<p>&nbsp;</p>


<p><font color="#ff8000">* my sessions</font></p>


<p>
<table width="611" cellspacing="0" cellpadding="0" border="0" style="width: 100%;" class="locations">
<tbody>
<tr>
<th width="107">Date</th>
<th width="502">
<p align="left">City</p>
</th>
</tr>
<tr>
<td width="107">12/9/08</td>
<td width="502"><a href="http://www.msdndevcon.com/Pages/Houston.aspx">Houston, TX</a>&nbsp;</td>
</tr>
<tr>
<td width="107">1/26/09</td>
<td width="502"><a href="http://www.msdndevcon.com/Pages/Dallas.aspx">Dallas, TX</a>&nbsp;</td>
</tr>
</tbody>
</table>
</p>


<p>If you aren&#8217;t close to Houston or Dallas, the MDC is coming to a handful of other cities, so check the <a target="_blank" href="http://www.msdndevcon.com">conference website</a> for more details.</p>


<p>Hope to see you there!</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/fluent-route-testing-in-asp-net-mvc/">Fluent Route Testing in ASP.NET MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-25T00:00:00-06:00" pubdate data-updated="true">Nov 25<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Have you written code like this recently?</p>


<p>&nbsp;</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red238\green238\blue238;\red32\green32\blue32;\red255\green0\blue128;\red144\green238\blue144;\red242\green240\blue223;\red192\green192\blue192;\red0\green255\blue255;}??\fs26 \cf1\cb2\highlight2 [\cf3 Test\cf1 ]\par ??\cf4 public\cf1  \cf4 void\cf1  \cf5 tedious_route_test\cf1 ()\par ??\{\par ??    \cf3 Global\cf6 .\cf5 RegisterRoutes\cf1 (\cf3 RouteTable\cf6 .\cf5 Routes\cf1 );\par ??    \cf4 var\cf1  \cf5 httpContext\cf1  \cf6 =\cf1  \cf3 MockRepository\cf6 .\cf5 GenerateStub\cf6 &lt;\cf3 HttpContextBase\cf6 &gt;\cf1 ();\par ??    \cf5 httpContext\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 Request\cf1 )\cf6 .\cf5 Return\cf1 (\cf3 MockRepository\cf6 .\cf5 GenerateStub\cf6 &lt;\cf3 HttpRequestBase\cf6 &gt;\cf1 ());\par ??    \cf5 httpContext\cf6 .\cf5 Request\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 PathInfo\cf1 )\cf6 .\cf5 Return\cf1 (\cf7 {\b ""}\cf1 );\par ??    \cf5 httpContext\cf6 .\cf5 Request\cf6 .\cf5 Stub\cf1 (\cf5 x\cf1  \cf6 =&gt;\cf1  \cf5 x\cf6 .\cf5 AppRelativeCurrentExecutionFilePath\cf1 )\cf6 .\cf5 Return\cf1 (\cf7 {\b "~/foo/bar"}\cf1 );\par ??\par ??    \cf4 var\cf1  \cf5 routeData\cf1  \cf6 =\cf1  \cf3 RouteTable\cf6 .\cf5 Routes\cf6 .\cf5 GetRouteData\cf1 (\cf5 httpContext\cf1 );\par ??\par ??    \cf3 Assert\cf6 .\cf5 That\cf1 (\cf5 routeData\cf6 .\cf5 Values\cf1 [\cf7 {\b "controller"}\cf1 ], \cf3 Is\cf6 .\cf5 EqualTo\cf1 (\cf7 {\b "foo"}\cf1 ));\par ??    \cf3 Assert\cf6 .\cf5 That\cf1 (\cf5 routeData\cf6 .\cf5 Values\cf1 [\cf7 {\b "action"}\cf1 ], \cf3 Is\cf6 .\cf5 EqualTo\cf1 (\cf7 {\b "bar"}\cf1 ));\par ??\}\par ??}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;">[<span style="color: rgb(255, 0, 128);">Test</span>]</p>
<p style="margin: 0px;"><span style="color: rgb(144, 238, 144);">public</span> <span style="color: rgb(144, 238, 144);">void</span> <span style="color: rgb(242, 240, 223);">tedious_route_test</span>()</p>
<p style="margin: 0px;">{</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Global</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">RegisterRoutes</span>(<span style="color: rgb(255, 0, 128);">RouteTable</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Routes</span>);</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">httpContext</span> <span style="color: silver;">=</span> <span style="color: rgb(255, 0, 128);">MockRepository</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GenerateStub</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">HttpContextBase</span><span style="color: silver;">&gt;</span>();</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="color: rgb(255, 0, 128);">MockRepository</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GenerateStub</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">HttpRequestBase</span><span style="color: silver;">&gt;</span>());</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">PathInfo</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="font-weight: bold; color: aqua;">&quot;&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">httpContext</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Request</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Stub</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">AppRelativeCurrentExecutionFilePath</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Return</span>(<span style="font-weight: bold; color: aqua;">&quot;~/foo/bar&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">routeData</span> <span style="color: silver;">=</span> <span style="color: rgb(255, 0, 128);">RouteTable</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Routes</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetRouteData</span>(<span style="color: rgb(242, 240, 223);">httpContext</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span>[<span style="font-weight: bold; color: aqua;">&quot;controller&quot;</span>], <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="font-weight: bold; color: aqua;">&quot;foo&quot;</span>));</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span>[<span style="font-weight: bold; color: aqua;">&quot;action&quot;</span>], <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="font-weight: bold; color: aqua;">&quot;bar&quot;</span>));</p>
<p style="margin: 0px;">}</p>
</div>


<p>This mess of nastiness is what is required to test your routes in ASP.NET MVC.&nbsp; There are a number of things wrong with this.&nbsp; First and foremost, we&#8217;re doing magical-mocking here.&nbsp; That is - we somehow know exactly the two properties we need to mock for this to work.&nbsp; It turns out this isn&#8217;t such a magical process as it is looking at reflector and a lot of trial and error.&nbsp; The next thing wrong that I see is that our route values (and keys) are case-insensitive, so we&#8217;d need to include some more flexibility in our Asserts here.</p>


<p>Who wants to deal with that mess?&nbsp; I sure don&#8217;t.&nbsp; Last night, my pal &amp; co-author <a href="http://www.lostechies.com/blogs/jimmy_bogard" target="_blank">Jimmy Bogard</a> banged together a fluent API for testing routes without needing all of this crap.</p>


<p>Here is a test to verify our root route is working properly:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red0\green255\blue255;\red32\green32\blue32;\red192\green192\blue192;\red242\green240\blue223;\red238\green238\blue238;\red255\green0\blue128;}??\fs26 \cf1\cb2\highlight2 {\b "~/"}\cf3 .\cf4 Route\cf5 ()\cf3 .\cf4 ShouldMapTo\cf3 &lt;\cf6 FooController\cf3 &gt;\cf5 (); }
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="font-weight: bold; color: aqua;">&quot;~/&quot;</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Route</span>()<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">FooController</span><span style="color: silver;">&gt;</span>();</p>
</div>


<p>And a more complex case where we have an action parameter:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red0\green255\blue255;\red32\green32\blue32;\red192\green192\blue192;\red242\green240\blue223;\red238\green238\blue238;\red255\green0\blue128;}??\fs26 \cf1\cb2\highlight2 {\b "~/foo/bar/widget"}\cf3 .\cf4 Route\cf5 ()\cf3 .\cf4 ShouldMapTo\cf3 &lt;\cf6 FooController\cf3 &gt;\cf5 (\cf4 x\cf5  \cf3 =&gt;\cf5  \cf4 x\cf3 .\cf4 Bar\cf5 (\cf1 {\b "widget"}\cf5 ));}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="font-weight: bold; color: aqua;">&quot;~/foo/bar/widget&quot;</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Route</span>()<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(255, 0, 128);">FooController</span><span style="color: silver;">&gt;</span>(<span style="color: rgb(242, 240, 223);">x</span> <span style="color: silver;">=&gt;</span> <span style="color: rgb(242, 240, 223);">x</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Bar</span>(<span style="font-weight: bold; color: aqua;">&quot;widget&quot;</span>));</p>
</div>


<p>These are a lot nicer, as we are dealing with no unnecessary string here, the controller are now strongly-typed (we get intellisense and refactoring support), and we can easily test routes with a single line.</p>


<p>This does have a couple caveats though:&nbsp; it assumes</p>


<ul>
<li>you&#8217;re using NUnit</li>
<li>you&#8217;re using RhinoMocks</li>
<li>you add your routes to the RouteTable.Routes collection</li>
</ul>


<p>So how did we do this?&nbsp; I have to admit, I tried to get this to work on the bus ride to work, but without an internet connection I was dead in the water.&nbsp; Jimmy helped me grasp the way that Expression&lt;T&gt; works.&nbsp; His wise words were: &quot;Here&#8217;s where you just set a breakpoint and fire up the debugger and look.&quot;&nbsp; He&#8217;s right - the API there is quite opaque.&nbsp; But once I got it to&nbsp; work it made a lot of sense.&nbsp; Expression&lt;T&gt; is awesome!</p>


<p>Here&#8217;s the method with most of the goods:</p>


<!--
{\rtf1\ansi\ansicpg\lang1024\noproof65001\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Consolas;}}{\colortbl;??\red144\green238\blue144;\red32\green32\blue32;\red238\green238\blue238;\red255\green0\blue128;\red242\green240\blue223;\red192\green192\blue192;\red255\green255\blue0;\red0\green255\blue255;\red164\green164\blue164;}??\fs26 \cf1\cb2\highlight2 public\cf3  \cf1 static\cf3  \cf4 RouteData\cf3  \cf5 ShouldMapTo\cf6 &lt;\cf5 TController\cf6 &gt;\cf3 (\cf1 this\cf3  \cf4 RouteData\cf3  \cf5 routeData\cf3 , \cf4 Expression\cf6 &lt;\cf7 Func\cf6 &lt;\cf5 TController\cf3 , \cf4 ActionResult\cf6 &gt;&gt;\cf3  \cf5 action\cf3 )\par ??    \cf1 where\cf3  \cf5 TController\cf3  : \cf4 Controller\par ??\cf3 \{            \par ??    \cf4 Assert\cf6 .\cf5 That\cf3 (\cf5 routeData\cf3 , \cf4 Is\cf6 .\cf5 Not\cf6 .\cf5 Null\cf3 , \cf8 {\b "The URL did not match any route"}\cf3 );\par ??\par ??    \cf9 {\b //check controller}\par ??\cf3     \cf5 routeData\cf6 .\cf5 ShouldMapTo\cf6 &lt;\cf5 TController\cf6 &gt;\cf3 ();\par ??    \par ??    \cf9 {\b //check action}\par ??\cf3     \cf1 var\cf3  \cf5 methodCall\cf3  \cf6 =\cf3  (\cf4 MethodCallExpression\cf3 ) \cf5 action\cf6 .\cf5 Body\cf3 ;\par ??    \cf1 string\cf3  \cf5 actualAction\cf3  \cf6 =\cf3  \cf5 routeData\cf6 .\cf5 Values\cf6 .\cf5 GetValue\cf3 (\cf8 {\b "action"}\cf3 )\cf6 .\cf5 ToString\cf3 ();\par ??    \cf1 string\cf3  \cf5 expectedAction\cf3  \cf6 =\cf3  \cf5 methodCall\cf6 .\cf5 Method\cf6 .\cf5 Name\cf3 ;\par ??    \cf5 actualAction\cf6 .\cf5 AssertSameStringAs\cf3 (\cf5 expectedAction\cf3 );\par ??                \par ??    \cf9 {\b //check parameters}\par ??\cf3     \cf1 for\cf3  (\cf1 int\cf3  \cf5 i\cf3  \cf6 =\cf3  \cf8 0\cf3 ; \cf5 i\cf3  \cf6 &lt;\cf3  \cf5 methodCall\cf6 .\cf5 Arguments\cf6 .\cf5 Count\cf3 ; \cf5 i\cf6 ++\cf3 )\par ??    \{\par ??        \cf1 string\cf3  \cf5 name\cf3  \cf6 =\cf3  \cf5 methodCall\cf6 .\cf5 Method\cf6 .\cf5 GetParameters\cf3 ()[\cf5 i\cf3 ]\cf6 .\cf5 Name\cf3 ;\par ??        \cf1 object\cf3  \cf5 value\cf3  \cf6 =\cf3  ((\cf4 ConstantExpression\cf3 ) \cf5 methodCall\cf6 .\cf5 Arguments\cf3 [\cf5 i\cf3 ])\cf6 .\cf5 Value\cf3 ;\par ??\par ??        \cf4 Assert\cf6 .\cf5 That\cf3 (\cf5 routeData\cf6 .\cf5 Values\cf6 .\cf5 GetValue\cf3 (\cf5 name\cf3 ), \cf4 Is\cf6 .\cf5 EqualTo\cf3 (\cf5 value\cf6 .\cf5 ToString\cf3 ()));\par ??    \}\par ??\par ??    \cf1 return\cf3  \cf5 routeData\cf3 ;\par ??\}\par ??}
-->


<div style="padding: 10px; background: rgb(32, 32, 32) none repeat scroll 0% 0%; font-size: 13pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: rgb(238, 238, 238); font-family: consolas,courier new;">
<p style="margin: 0px;"><span style="color: rgb(144, 238, 144);">public</span> <span style="color: rgb(144, 238, 144);">static</span> <span style="color: rgb(255, 0, 128);">RouteData</span> <span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span><span style="color: silver;">&gt;</span>(<span style="color: rgb(144, 238, 144);">this</span> <span style="color: rgb(255, 0, 128);">RouteData</span> <span style="color: rgb(242, 240, 223);">routeData</span>, <span style="color: rgb(255, 0, 128);">Expression</span><span style="color: silver;">&lt;</span><span style="color: yellow;">Func</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span>, <span style="color: rgb(255, 0, 128);">ActionResult</span><span style="color: silver;">&gt;&gt;</span> <span style="color: rgb(242, 240, 223);">action</span>)</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">where</span> <span style="color: rgb(242, 240, 223);">TController</span> : <span style="color: rgb(255, 0, 128);">Controller</span></p>
<p style="margin: 0px;">{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span>, <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Not</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Null</span>, <span style="font-weight: bold; color: aqua;">&quot;The URL did not match any route&quot;</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check controller</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ShouldMapTo</span><span style="color: silver;">&lt;</span><span style="color: rgb(242, 240, 223);">TController</span><span style="color: silver;">&gt;</span>();</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check action</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">var</span> <span style="color: rgb(242, 240, 223);">methodCall</span> <span style="color: silver;">=</span> (<span style="color: rgb(255, 0, 128);">MethodCallExpression</span>) <span style="color: rgb(242, 240, 223);">action</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Body</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">actualAction</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetValue</span>(<span style="font-weight: bold; color: aqua;">&quot;action&quot;</span>)<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ToString</span>();</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">expectedAction</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Method</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Name</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(242, 240, 223);">actualAction</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">AssertSameStringAs</span>(<span style="color: rgb(242, 240, 223);">expectedAction</span>);</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="font-weight: bold; color: rgb(164, 164, 164);">//check parameters</span></p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">for</span> (<span style="color: rgb(144, 238, 144);">int</span> <span style="color: rgb(242, 240, 223);">i</span> <span style="color: silver;">=</span> <span style="color: aqua;">0</span>; <span style="color: rgb(242, 240, 223);">i</span> <span style="color: silver;">&lt;</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Arguments</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Count</span>; <span style="color: rgb(242, 240, 223);">i</span><span style="color: silver;">++</span>)</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">string</span> <span style="color: rgb(242, 240, 223);">name</span> <span style="color: silver;">=</span> <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Method</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetParameters</span>()[<span style="color: rgb(242, 240, 223);">i</span>]<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Name</span>;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">object</span> <span style="color: rgb(242, 240, 223);">value</span> <span style="color: silver;">=</span> ((<span style="color: rgb(255, 0, 128);">ConstantExpression</span>) <span style="color: rgb(242, 240, 223);">methodCall</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Arguments</span>[<span style="color: rgb(242, 240, 223);">i</span>])<span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Value</span>;</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(255, 0, 128);">Assert</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">That</span>(<span style="color: rgb(242, 240, 223);">routeData</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">Values</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">GetValue</span>(<span style="color: rgb(242, 240, 223);">name</span>), <span style="color: rgb(255, 0, 128);">Is</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">EqualTo</span>(<span style="color: rgb(242, 240, 223);">value</span><span style="color: silver;">.</span><span style="color: rgb(242, 240, 223);">ToString</span>()));</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px;">&nbsp;</p>
<p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: rgb(144, 238, 144);">return</span> <span style="color: rgb(242, 240, 223);">routeData</span>;</p>
<p style="margin: 0px;">}</p>
</div>


<p>This might be a tad brittle, but in my preliminary testing it worked wonders.&nbsp; This code is now in <a href="http://mvccontrib.org" target="_blank">MvcContrib</a>&#8217;s TestHelper project.&nbsp;</p>


<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:b04a1ca3-9141-402a-955f-b9b27054f6ac" style="margin: 0px; padding: 0px; display: inline;">Technorati Tags: <a href="http://technorati.com/tags/asp.net%20mvc" rel="tag">asp.net mvc</a></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/subsonic-and-projections/">SubSonic and Projections</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-11T00:00:00-06:00" pubdate data-updated="true">Nov 11<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve said in the past that we use SubSonic on my current project.&#160; It does what it says it does (mostly) and generates some usable code off of an existing database.&#160; I do have my qualms about it, mostly because of my bias to look at things from the object/domain world rather than the database world.&#160; But I am a committer, so my energy complaining would be better off contributing goodness to the project.</p>


<p>  <p>With the most recent release of the new query API in SubSonic, we were given a lot of flexibility.&#160; This was much needed in our project because getting single results and collections off of a single entity is rarely sufficient for complex applications.&#160; Often times the data needed to display on a page comes from multiple tables.</p>  <p>In the past, I was forced to do this sort of ugly nastiness:</p></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;span class="rem">//get schedules (1 query)&lt;/span>
</span><span class='line'>Schedule[] schedules = _repository.GetSchedulesInRange(start, end);
</span><span class='line'>&lt;span class="rem">//get employee info (2 queries)&lt;/span>
</span><span class='line'>Employee[] employees = _repository.GetEmployeesInSchedules(schedules);
</span><span class='line'>ScheduleDisplayMapper mapper = &lt;span class="kwrd">new&lt;/span> ScheduleDisplayMapper();
</span><span class='line'>&lt;span class="kwrd">return&lt;/span> mapper.Map(schedules, employees);</span></code></pre></td></tr></table></div></figure>




<p>This function returned an array of `ScheduleDTO` objects that were used to bind to a view.&#160; The lack of joins at the database level was really killing our productivity and in some cases, performance.&#160; It often took more code to write the query than you&#8217;d expect, because you would have to perform it in steps.</p>


<blockquote>
<p>Note: I&#8217;m really pragmatic about performance, so 2 queries when 1 is possible doesn&#8217;t usually matter in the long run.&#160; Of course if this *is* a perf bottleneck, then of course, optimize.&#160; I much prefer to balance programmer performance over unnoticeable application performance.</p>
</blockquote>


<p>With the new query API, I can now do this:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SqlQuery query = &lt;span class="kwrd">new&lt;/span> Select()
</span><span class='line'>.From&lt;OnCallSchedule&gt;()
</span><span class='line'>.InnerJoin(Area.AreaIdColumn, OnCallSchedule.AreaIdColumn)
</span><span class='line'>.InnerJoin(EmployeeProfile.EmployeeProfileIdColumn, OnCallSchedule.EmployeeProfileIdColumn)
</span><span class='line'>.Where(OnCallSchedule.StartDtColumn).IsLessThanOrEqualTo(date)
</span><span class='line'>.And(OnCallSchedule.EndDtColumn).IsGreaterThanOrEqualTo(date)
</span><span class='line'>.OpenExpression()
</span><span class='line'>.And(Area.AreaIdColumn).IsNull()
</span><span class='line'>.Or(Area.AreaIdColumn).IsEqualTo(areaId)
</span><span class='line'>.CloseExpression()
</span><span class='line'>.OrderAsc(OnCallSchedule.PriorityColumn.ColumnName);</span></code></pre></td></tr></table></div></figure>




<p>I get complete refactoring support, intellisense, and type-safety.&#160; But now we have a different problem:&#160; we&#8217;re not returning a single entity anymore.&#160; We&#8217;re returning a combination of columns from different tables.</p>


<p>To build my DTO objects, I then had to resort to functions like this:</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">static&lt;/span> ScheduleDTO FetchFromRow(IDataReader dr)
</span><span class='line'>{
</span><span class='line'>&lt;span class="kwrd">int&lt;/span> i = 0;
</span><span class='line'>ScheduleDTO schedule = &lt;span class="kwrd">new&lt;/span> ScheduleDTO();
</span><span class='line'>schedule.OnCallScheduleId = dr.GetGuid(i++);
</span><span class='line'>schedule.Start = dr.GetDateTime(i++);
</span><span class='line'>schedule.End = dr.GetDateTime(i++);
</span><span class='line'>schedule.Comments = dr[i++] &lt;span class="kwrd">as&lt;/span> &lt;span class="kwrd">string&lt;/span>;
</span><span class='line'>schedule.Priority = dr.GetInt32(i++);
</span><span class='line'>schedule.EmployeeProfileId = dr.GetGuid(i++);
</span><span class='line'>&lt;span class="kwrd">string&lt;/span> firstName = dr.GetString(i++);
</span><span class='line'>&lt;span class="kwrd">string&lt;/span> lastName = dr.GetString(i++);
</span><span class='line'>schedule.EmployeeName = firstName + &lt;span class="str">&quot; &quot;&lt;/span> + lastName;
</span><span class='line'>&lt;span class="kwrd">return&lt;/span> schedule;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<p><strong>Excuse me while I go vomit</strong>.&#160; This code gives me nightmares from the days when I wrote my own data access layer by hand.&#160; We as programmers should never be writing code that is simply of the form <em>copy this value to that value.&#160; Cast X to Y</em>.&#160; It&#8217;s specifically the reason why data binding exists for forms.</p>


<p>After writing two of these methods I decided we need to come up with a better way.&#160; I wanted to declaratively say, this <em>DTO maps to these columns</em>.&#160; We don&#8217;t have .NET 3.5, so magic-y lambda syntax is out.</p>


<p>I decided to lean on attributes.&#160; Yes, this does add some &quot;database-y&quot; things on my DTOs, but I figured the baggage was worth it.&#160; I created a custom attribute to map properties on my DTOs to columns on a result set.</p>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[AttributeUsage(AttributeTargets.Property)]
</span><span class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">class&lt;/span> MapToColumnAttribute : Attribute
</span><span class='line'>{
</span><span class='line'>&lt;span class="kwrd">private&lt;/span> &lt;span class="kwrd">readonly&lt;/span> &lt;span class="kwrd">string&lt;/span> _columnName;
</span><span class='line'>&lt;span class="kwrd">public&lt;/span> MapToColumnAttribute(&lt;span class="kwrd">string&lt;/span> columnName)
</span><span class='line'>{
</span><span class='line'>_columnName = columnName;
</span><span class='line'>}
</span><span class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">string&lt;/span> ColumnName
</span><span class='line'>{
</span><span class='line'>get { &lt;span class="kwrd">return&lt;/span> _columnName; }
</span><span class='line'>}
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<p></p>


<p>Now to decorate my DTO&#8230;.</p>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">class&lt;/span> ScheduleDTO
</span><span class='line'>{
</span><span class='line'>[MapToColumn(OnCallSchedule.Columns.Priority)]
</span><span class='line'>&lt;span class="kwrd">public&lt;/span> &lt;span class="kwrd">int&lt;/span> Priority
</span><span class='line'>{
</span><span class='line'>get { &lt;span class="kwrd">return&lt;/span> _priority; }
</span><span class='line'>set { _priority = &lt;span class="kwrd">value&lt;/span>; }
</span><span class='line'>}
</span><span class='line'>[MapToColumn(EmployeeProfile.Columns.EmployeeProfileId)]
</span><span class='line'>&lt;span class="kwrd">public&lt;/span> Guid ProfileId
</span><span class='line'>{
</span><span class='line'>get { &lt;span class="kwrd">return&lt;/span> _profileId; }
</span><span class='line'>set { _profileId = &lt;span class="kwrd">value&lt;/span>; }
</span><span class='line'>}
</span><span class='line'>&lt;span class="rem">/* snip */&lt;/span></span></code></pre></td></tr></table></div></figure>




<p></p>


<p>SubSonic has a struct called <em>Columns</em> that contains all of the column names. I had to edit the default template to make these constants rather than statics, so that they would be usable in the attribute constructors.</p>


<p>Now that all of the mapping information has been provided declaratively, I can now leverage a generic mapper class to do the copying form DataReader over to DTO.</p>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;span class="kwrd">public&lt;/span> T Map&lt;T&gt;(IDataReader dr) &lt;span class="kwrd">where&lt;/span> T : &lt;span class="kwrd">new&lt;/span>()
</span><span class='line'>{
</span><span class='line'>Type type = &lt;span class="kwrd">typeof&lt;/span>(T);
</span><span class='line'>T target = &lt;span class="kwrd">new&lt;/span> T();
</span><span class='line'>&lt;span class="kwrd">foreach&lt;/span>(PropertyInfo property &lt;span class="kwrd">in&lt;/span> type.GetProperties())
</span><span class='line'>{
</span><span class='line'>&lt;span class="kwrd">foreach&lt;/span>(MapToColumnAttribute attr &lt;span class="kwrd">in&lt;/span> ReflectionUtil.GetAttributes&lt;MapToColumnAttribute&gt;(property))
</span><span class='line'>{
</span><span class='line'>&lt;span class="kwrd">object&lt;/span> &lt;span class="kwrd">value&lt;/span> = dr[attr.ColumnName];
</span><span class='line'>property.SetValue(target, &lt;span class="kwrd">value&lt;/span>, &lt;span class="kwrd">null&lt;/span>);
</span><span class='line'>}
</span><span class='line'>}
</span><span class='line'>&lt;span class="kwrd">return&lt;/span> target;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<p></p>


<p>This function takes a DataReader that currently on a record, loops over the properties of the DTO looking for our attribute.&#160; It then sets the value using reflection.&#160; The beauty of this is, I don&#8217;t have to worry about casting anything.&#160; As long as the types of the columns match up with the type of the property, then we&#8217;re golden.</p>


<p>The act of mapping projections of entities onto flat data transfer objects is now incredibly simple:</p>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ProjectionMapper mapper = &lt;span class="kwrd">new&lt;/span> ProjectionMapper();
</span><span class='line'>&lt;span class="kwrd">using&lt;/span>(IDataReader dr = query.ExecuteReader())
</span><span class='line'>{
</span><span class='line'>&lt;span class="kwrd">while&lt;/span>(dr.Read())
</span><span class='line'>results.Add(mapper.Map&lt;ScheduleDTO&gt;(dr));
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<p></p>


<p></p>


<p>You can take this one step further to encapsulate the looping over the data reader as well.</p>


<p>It was a nice feeling to be able to remove 17 lines of query code and 1 40 line mapping class and replace it with a tighter query and a few attributes.</p>


<p>Deleting code is fun.</p>


<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:226b7435-322b-43b9-b942-f3fbbede0838" style="padding-right: 0px; display: inline; padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: <a href="http://technorati.com/tags/SubSonic" rel="tag">SubSonic</a></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/photos/">Photos</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-11T00:00:00-06:00" pubdate data-updated="true">Nov 11<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>This album displays photos from my <a target="_blank" href="http://flickr.com/photos/bensilvia">Flickr</a> account.</em></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/new-blog-design-platform/">New Blog Design / Platform</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-10T00:00:00-06:00" pubdate data-updated="true">Nov 10<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My blog is now running on <a href="http://graffiticms.com">Graffiti</a>. &nbsp;I also updated the design a little bit. &nbsp;I decided that after the lack of stability on my VPS with <a href="http://godaddy.com">Go Daddy</a> that I&#8217;d try out a real host. &nbsp;So I&#8217;ve moved my blog over to <a href="http://www.orcsweb.com">ORCS Web</a>. &nbsp;So far, things are great.</p>


<p>Graffiti has a tool to import posts from DasBlog, which is nice, however I wanted to preserve all of my old posts. &nbsp;A simple lookup table, joined with the new Graffiti Posts table gave me the information I needed to map the URLs. &nbsp;Then I created an HttpModule to intercept requests for the old URLs and 301 redirect them to the new ones.</p>


<p>I tested about 20 URLs and it worked fine for me, but if you notice a post that no longer works, please let me know!</p>


<p>What do <em>you</em> think of the new blog?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/contact/">Contact</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-09T00:00:00-06:00" pubdate data-updated="true">Nov 9<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Fill out the form below to get in touch with me.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/book/">Book</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-09T00:00:00-06:00" pubdate data-updated="true">Nov 9<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>Update: &nbsp;The book is finished! &nbsp;You can purchase it at <a href="http://manning.com/palermo">Manning</a> or <a href="http://www.amazon.com/ASP-NET-MVC-Action-Jeffrey-Palermo/dp/1933988622/ref=sr_1_5?ie=UTF8&amp;s=books&amp;qid=1250604657&amp;sr=8-5">Amazon</a>.</strong></p>


<p><img alt="" src="http://jeffreypalermo.com/files/media/image/WindowsLiveWriter/ASP.NETMVCinActionbookcompleteandheadedt_7A74/image_caa2976c-de99-4b61-a7c8-7a32ef519518.png" />&nbsp;I&#8217;m currently writing a book called ASP.NET MVC in Action with <a target="_blank" href="http://www.jeffreypalermo.com">Jeffrey Palermo</a> and <a href="http://www.lostechies.com/blogs/jimmy_bogard/">Jimmy Bogard</a>. &nbsp;You can get early PDFs from <a href="http://manning.com/palermo">Manning&#8217;s Early Access Program</a>. &nbsp;If you&#8217;re interested in ASP.NET MVC, be sure to pick it up!</p>


<p>The book will not be your typical introductory text. &nbsp;Instead, we&#8217;re focusing on realistic usage, such as encouraging &amp; facilitating test-driven development, leveraging inversion of control frameworks, and adhering to good software development principles like Single Responsibility.</p>


<p>You can take a look at our sample application for the book, <a target="_blank" href="http://codecampserver.org">Code Camp Server</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/about-me/">About Me</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-11-01T00:00:00-05:00" pubdate data-updated="true">Nov 1<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My name is Ben Scheirman. &nbsp;I am the Director of Development at <a href="http://www.chaione.com">ChaiONE</a> in Houston, TX.</p>


<p>I started out programming when I was 13, tinkering with QBASIC and creating simple games and screensavers. &nbsp;My favorite experience was creating a fake application called &quot;DELBUG&quot; that &quot;removes bugs from programs.&quot; &nbsp;It proceeded to tell the user that it had no choice but to format their hard drive. &nbsp;After that, I was hooked.</p>


<p>I took Computer Science classes all through high school, and then took the passion to college as well.&nbsp; I received a Bachelor&#8217;s degree in Computer Science from the University of Houston in 2004.</p>


<p>On this blog you&rsquo;ll find my random tidbits about software development as I evolve in my craft. &nbsp;Currently, I&#8217;m interested in agile practices such as test-driven development, refactoring, continuous integration, domain driven design, and more.&nbsp; I also frequently cover object-relational mapping concepts with NHibernate.&nbsp; I&#8217;m highly interested in both web and iPhone development.</p>


<p>My platforms of choice (in no particular order):&nbsp; .NET, Rails, iPhone</p>


<p>Languages:&nbsp; C#, Ruby, Objective-C, JavaScript, Boo</p>


<p>I wrote a   <a href="http://www.amazon.com/gp/product/1933988622?ie=UTF8&amp;tag=flux88com-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1933988622">book</a><img width="1" height="1" border="0" style="border: medium none ! important; margin: 0px ! important;" alt="" src="http://www.assoc-amazon.com/e/ir?t=flux88com-20&amp;l=as2&amp;o=1&amp;a=1933988622" />&nbsp;(and a <a href="http://manning.com/palermo2/">2nd edition</a>)  and an <a href="http://pockettabs.com">iPhone app</a> that you might want to check out.</p>


<p>I enjoy reading, but the only thing that captures my attention are technical books.&nbsp; My reading list is growing faster than I can possibly read them! &nbsp;</p>


<p>I live in Houston with my wife and <strike>three</strike>&nbsp;<strong>five</strong> beautiful children.&nbsp; When I&rsquo;m not working, I&rsquo;m usually hanging out with my family, playing video games, or playing guitar.</p>


<p>Thanks for looking!</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/leveraging-existing-asp-net-features-in-asp-net-mvc/">Leveraging Existing ASP.NET Features in ASP.NET MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-20T00:00:00-05:00" pubdate data-updated="true">Oct 20<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>The following is an excerpt from my upcoming book, </em><a href="http://manning.com/palermo" target="_blank"><em>ASP.NET MVC in Action</em></a><em>&#8230;</em></p>


<p>Many of us have invested heavily in ASP.NET. With ASP.NET MVC now available as an alternative to WebForms, is all that knowledge lost? Do we have to relearn this platform entirely from scratch? You&#8217;ll be relieved to know that many of ASP.NET&#8217;s platform features work the same way they always have. Some ASP.NET server controls even work. In this chapter we&#8217;ll cover what works in ASP.NET MVC and what does not. By the end of the chapter, you should feel comfortable leveraging your existing knowledge of ASP.NET to build robust web sites with ASP.NET MVC.</p>


<h2>8.1 ASP.NET Server Controls</h2>


<p>As you just discovered, some ASP.NET server controls work with ASP.NET MVC, but which ones? How can we tell if a control will work or not? To put it simply, any control that depends on ViewState or generates post-backs will not work. Some controls will render, but they require a &lt;form runat=&#8221;server&#8221;&gt; which you might not want to add. Adding a server-side form tag will put hidden fields on the page for ViewState and event validation. The form will also POST to the same action you&#8217;re on, which is usually unacceptable.</p>


<blockquote> <h4>Note:</h4><p>The code you&#8217;ll read in this section is purely exploratory. Most of it contains hacks and other workarounds that go against the intended design of an MVC web application. The intent of this section is to see how far we can bend the framework without breaking it. Your authors would not recommend using most of these methods in a production application unless absolutely necessary.</p> </blockquote>


<h3><a name="_Toc212290640">8.1.1 The TextBox</a></h3>


<p>The first control we&#8217;ll examine is the &lt;asp:TextBox /&gt;. It renders as an &lt;input /&gt; HTML element. It requires a &lt;form runat=&#8221;server&#8221;&gt; tag to function, and will be given a generated ID, again which is what we&#8217;re trying to avoid here! Since it is a form field, and the form is required to be runat=&#8221;server&#8221;, it is crippled in its function. Figure 8.1 shows it in action, while Listing 8.1 shows the resulting HTML.</p>


<p><img src="/images/figure8_1.png" alt="figure8_1"  border="0"  />&#160; <br /><strong>Figure 8.1 - The TextBox renders correctly</strong></p>


<p><strong>Listing 8.2 - The resulting HTML for the TextBox is less than desirable</strong> </p>


<p><img src="/images/figure8_2.png" alt="figure8_2"  border="0"  /> </p>


<p>We can see here that the rendered HTML contains a lot of things that we didn&#8217;t ask for. In addition, notice that the form tag has an action attribute that we didn&#8217;t specify. This will prevent the form from submitting to an action that we request. Since a textbox in ASP.NET MVC is as simple as &lt;%= Html.TextBox(&#8220;name&#8221;) %&gt;, the TextBox server control offers no functionality - only baggage - for your ASP.NET MVC views.</p>


<h3>8.1.2 Other Common Controls</h3>


<p>We can see from our simple text box example that most ASP.NET WebForms input controls have little to offer. However, some of the controls have very functional rendered output. An excellent example is the &lt;asp:Menu /&gt; control. It doesn&#8217;t require or generate any post-backs and it doesn&#8217;t require view state. It simply renders HTML and JavaScript to allow elements to expand and hide on mouse events. Leaving aside that the &lt;asp:Menu /&gt; renders a nasty pile of HTML tables to display properly, it&#8217;s purely a client rendered control, and it works just fine in ASP.NET MVC. Luckily we can fix the poor markup with ASP.NET Control Adapters, which also function in ASP.NET MVC. Figure 8.3 demonstrates the menu control.</p>


<p><img src="/images/figure8_3.png" alt="figure8_3"  border="0"  /> </p>


<p><strong>Figure 8.3 - The menu control renders, unfortunately the links require post-backs. More surgery is needed to make it function.</strong></p>


<p><img src="/images/figure8_4.png" alt="figure8_4"  border="0"  /> </p>


<p><strong>Figure 8.4 - The horrific markup that is rendered by the Menu control. Stay tuned for a better way.</strong></p>


<p>While the &lt;asp:Menu /&gt; control renders properly, the links in the menu are post-back links, and don&#8217;t work. We could conjure up some javascript to alter this behavior, however doing so would just add to the mess. Additionally, take a look at the rendered markup in Figure 8.4. Hard-coded styles, deeply nested tables, highly obtrusive javascript make this tiny menu render nothing short of a headache. </p>


<blockquote> <p><strong>Note:</strong></p><p>This type of markup is a constant reminder of why we want more control over our HTML! Later, in Chapter 14 (Recipes) we&#8217;ll see how we can do much better. For now, let&#8217;s continue on with our exploration of ASP.NET server controls. </p> </blockquote>


<p>Two controls that would be hard to live without would be the &lt;asp:TreeView /&gt; and the &lt;asp:Calendar /&gt;. The TreeView works fairly well, however it generates post-backs that do nothing. The visual aspect works just fine, however. The calendar relies heavily on post-back for navigation, so unfortunately it does not function in ASP.NET MVC.</p>


<p>I&#8217;ve so far neglected the big-daddy of ASP.NET server controls. That&#8217;s right; I&#8217;m talking about the GridView. The GridView is an interesting case, because it has so many different forms. At its simplest, the GridView is just an HTML table. It&#8217;s great for displaying tabular data. If we don&#8217;t require any post-back, then it should work, right? In short it does work, however there are a view gotchas along the way.</p>


<h3>8.1.3 The GridView</h3>


<p>The first issue you face is there is no declarative way to bind the GridView to data coming from ViewData. For this we can poke into the code-behind class, which up until now has been mostly useless. In standard ASP.NET Form, you can add an OnLoad event handler and set the grid&#8217;s DataSource property to the data coming from ViewData. Listing 8.1 shows how you might accomplish this. Another method you could employ is to take the data binding code and put it directly in the view markup, inside &lt;% %&gt; code blocks. Listing 8.2 demonstrates this. Both of these methods send bad vibes up my spine, but the point is that it is possible.</p>


<p><strong>Listing 8.1 - Binding a GridView from the code-behind</strong></p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public partial class grid : ViewPage&lt;Customer[]&gt;{ protected override void OnLoad(System.EventArgs e) {base.OnLoad(e);grid1.DataSource = ViewData.Model;grid1.DataBind(); }}</span></code></pre></td></tr></table></div></figure>


<p><strong>Listing 8.2 - Binding a GridView from the view itself</strong></p>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;% grid1.DataSource = ViewData.Model; grid1.DataBind();%&gt;</span></code></pre></td></tr></table></div></figure>


<p>You also have the option of using the DataSource controls such as ObjectDataSource, SqlDataSource, and XmlDataSource. Of course, in doing this you&#8217;ve completely circumvented the MVC pattern and placed all of your data access directly in the view!</p>


<p><img src="/images/figure8_5.png" alt="figure8_5"  border="0"  /> </p>


<p><strong>Figure 8.5 - The GridView ren
ders properly</strong></p>


<p>Figure 8.5 shows our newly bound GridView in action. Unfortunately, that&#8217;s all you get, because none of the advanced features of the GridView will work. No sorting, paging, editing, or selecting. Because of this, it is of limited utility, and will probably only aid you during prototyping and demos.</p>


<p>All is not lost, however. In ASP.NET MVC you can achieve the holy grail of an editable data grid, complete with sorting, paging, and editing. You just have to structure it in a different way. You&#8217;ll see an example of this in Chapter 14 (Recipes).</p>


<p><a name="_Toc212290643">8.1.4 So Where Do I Get The Good Stuff?</a></p>


<p>The examples I&#8217;ve shown here might give you a sour taste in your mouth about ASP.NET MVC. Before you scoff at it and decide that you don&#8217;t want to live without your TreeView and Menu controls, consider this: many thousands of samples online show how you can achieve the same functionality with a little bit of Javascript and CSS. These are freely available solutions that many other platforms leverage. With ASP.NET MVC we can do the same, and with minimal friction in applying it. Often, these solutions are so simple; they make the declarative ASP.NET controls look like a sledgehammer. Here are a few references for platform-agnostic solutions to tree views, menus, and tabs using jQuery.</p>


<table cellspacing="0" cellpadding="4" border="0"><tbody><tr><td>jQuery Treeview Example</td><td><a href="http://jquery.bassistance.de/treeview/demo/">http://jquery.bassistance.de/treeview/demo/</a></td></tr><tr><td valign="top"><p>jQuery Menu Example</p></td><td><a href="http://jdsharp.us/jQuery/plugins/jdMenu/">http://jdsharp.us/jQuery/plugins/jdMenu/</a></td></tr><tr><td>jQuery Tabs Example</td><td><p><a href="http://stilbuero.de/jquery/tabs/">http://stilbuero.de/jquery/tabs/</a></p></td></tr></tbody></table>


<p>&#160;</p>


<p>______________________________</p>


<p>For more early sections of ASP.NET MVC in Action, check out the pre-release PDFs available at <a href="http://manning.com/palermo" target="_blank">Manning Press</a>.</p>


<p>My co-authors may also be posting some excerpts, so pay attention to them:&#160; <a href="http://www.jeffreypalermo.com" target="_blank">Jeffrey Palermo</a> and <a href="http://www.lostechies.com/blogs/jimmy_bogard/" target="_blank">Jimmy Bogard</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/10/vs-live-tulsa-techfest-material/">Vs Live / Tulsa TechFest Material</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-14T00:00:00-05:00" pubdate data-updated="true">Oct 14<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just wrapped up my session on Test-Driven Development with ASP.NET MVC.&nbsp; The audience was a bit thin, but the people who were there seemed genuinely interested in both ASP.NET MVC and Test Driven Development.</p>


<p> <p>I had a little hiccup during the demo, so I had to comment out my Windsor code &amp; just revert to poor man&#8217;s dependency injection!&nbsp; What&#8217;s weird is that this worked 20 minutes before the demo, but whatever.</p> <p>Another thing to note is that I&#8217;m now a BDD convert, so my tests changed a bit from the material that was delivered on DVD over a month ago.&nbsp; The example I did today, with BDD style tests &amp; some ShouldBe extension methods is available here:</p> <p><a href="http://benscheirman.googlecode.com/files/vslive%20las%20vegas%202008.zip" target="_blank">VS Live Presentation Material</a></p> <p>I also ended up winning a little bit of money yesterday, which was awesome!&nbsp; While playing nickel slots and talking on the phone to my wife, I accidentally pressed the cash out button when I only had $0.10 left :)&nbsp; Here&#8217;s a stellar picture showing my excitement:</p> <p><a href="http://flux88.com/uploads/VSLiveTulsaTechFestMaterial_9BAA/lasvegaswinnings.png"><img src="/images/lasvegaswinnings_thumb.png" alt="las-vegas-winnings"  border="0" /></a> </p> <h2>Tulsa TechFest</h2> <p>Also, last week I gave two presentations in Tulsa:</p> <ul> <li>Become a .NET Jedi with ReSharper</li> <li>Build a blog with ASP.NET MVC</li></ul> <p>The audiences for both talks were very engaged, and I think they both went really well.&nbsp; I did leave Tulsa wondering, however, <strong>what&#8217;s with all the VB developers!</strong>&nbsp; (I kid, I kid!)</p> <p>The material for the blog example is available here:</p> <p><a href="http://benscheirman.googlecode.com/files/vslive%20las%20vegas%202008.zip" target="_blank">Tulsa TechFest Presentation Material</a></p> <p>If you want to browse the source for either of these talks, check out <a href="http://code.google.com/p/benscheirman" target="_blank">my google code repository</a> (they&#8217;ll be posted soon).</p> <p>Thanks to those who attended my talks &amp; game me valuable feedback.&nbsp; I&#8217;m always looking to improve my presentation skills.</p> <p>&nbsp;</p> <p>What&#8217;s next for me?&nbsp; I&#8217;ll be speaking at the <a href="http://www.innotechok.com/" target="_blank">Innotech</a> in Oklahoma City on November 6th, on the same subject.</p></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/13/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/11/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Who am I?</h1>
  <p>I&#8217;m Ben Scheirman. I make Rails &amp; iPhone apps for <a href="http://chaione.com" target="_blank">ChaiONE</a> in Houston, TX.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/07/houston-code-camp-call-for-speakers/">Houston Code Camp - Call for Speakers</a>
      </li>
    
      <li class="post">
        <a href="/2012/07/serving-assets-from-s3-on-heroku/">Serving Assets from S3 on Heroku</a>
      </li>
    
      <li class="post">
        <a href="/2012/02/hello/">Hello, NSScreencast</a>
      </li>
    
      <li class="post">
        <a href="/2012/01/nsscreencasts/">NSScreencasts, Coming Soon</a>
      </li>
    
      <li class="post">
        <a href="/2012/01/careful-with-block-based-notification-handlers/">Careful With Block-Based Notification Handlers</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("subdigital", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/subdigital" class="twitter-follow-button" data-show-count="false">Follow @subdigital</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/subdigital?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/subdigital">My Delicious Bookmarks &raquo;</a></p>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo">
<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4f26d557844d525165000005');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>


<p>
  Copyright &copy; 2012 - Ben Scheirman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'subdigital';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
