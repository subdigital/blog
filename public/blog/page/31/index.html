
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fickle Bits</title>
  <meta name="author" content="Ben Scheirman">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://benscheirman.com/blog/page/31/index.html"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/ficklebits" rel="alternate" title="Fickle Bits" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-210379-10']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">Fickle Bits</a></h1>
  
    <h2>You're doing it wrong.</h2>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/ficklebits" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:benscheirman.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="/speaking">Speaking</a></li>
  <li><a href="/contact">Contact</a></li>
  <li><a href="http://appsites.heroku.com/giggletouch">Giggle Touch for
    iOS</a></li>
  <li><a href="/blog/archives">Archives</a></li>

</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">



  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/08/making-divs-stay-next-to-each-other/">Making DIVs Stay Next to Each Other</a></h1>
    
    
      <p class="meta">




<time datetime="2006-08-17 00:00:00 -0500" pubdate  updated >Aug 17<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>A colleague came to me with a very simple issue yesterday.&nbsp; He had a table surrounding the area he was working on, and he wanted to have 2 DIVs side-by-side, one of them containing a table.</p>


<p>Here&rsquo;s what he had:</p>


<p><font face="Courier" color="#0080c0" size="2">&lt;table&gt;<br />&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&lt;td&gt;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&lt;div style=&#8221;padding: 2px; margin: 2px; border: #ccc; background-color:#eee;&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;here&#8217;s the first div<br />&nbsp;&nbsp;&nbsp;&lt;/div&gt;</font></p>


<p><font face="Courier" color="#0080c0" size="2">&nbsp;&nbsp;&nbsp;&lt;div style=&#8221;padding: 2px; margin: 2px; border: #ccc; background-color:#eee;&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;..and here&#8217;s the 2nd<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;table border=1&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;with a table&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br />&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&lt;/tr&gt;<br />&lt;/table&gt;</font></p>


<p>&#8230;which looks like: </p>


<table><tbody><tr><td><div style="BORDER-RIGHT: #ccc; PADDING-RIGHT: 2px; BORDER-TOP: #ccc; PADDING-LEFT: 2px; PADDING-BOTTOM: 2px; MARGIN: 2px; BORDER-LEFT: #ccc; PADDING-TOP: 2px; BORDER-BOTTOM: #ccc; BACKGROUND-COLOR: #eee">here&#8217;s the first div </div><div style="BORDER-RIGHT: #ccc; PADDING-RIGHT: 2px; BORDER-TOP: #ccc; PADDING-LEFT: 2px; PADDING-BOTTOM: 2px; MARGIN: 2px; BORDER-LEFT: #ccc; PADDING-TOP: 2px; BORDER-BOTTOM: #ccc; BACKGROUND-COLOR: #eee">..and here&#8217;s the 2nd <table border="1"><tbody><tr><td>with a table</td></td></tr></tbody></table></div><p>&nbsp;</p></td></tr></tbody></table>


<p>He tried a number of things that didn&rsquo;t work.&nbsp; Here&rsquo;s the solution:</p>


<p>DIVs are block level elements that stretch to 100% of the width of the parent container.&nbsp; So to get them to sit next to each other you first need to give them some room to do so.&nbsp; Set the width so that they will both fit (be sure to account for border + margin as well).</p>


<p>The next thing to do is set the DIVs to float:left;&nbsp; This will make them push up next to each other until there is no more room, then they will wrap.</p>


<p>Here it is in action:</p>


<p>&nbsp;<font face="Courier" color="#0080c0" size="2">&lt;table&gt;<br />&nbsp;&lt;tr&gt;<br />&nbsp;&nbsp;&lt;td width=&#8221;300&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&lt;div style=&#8221;margin:2px; padding:2px; border: solid 1px #bbb; background-color: #eee; float: left; width: 75px;&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;here&#8217;s the 1st div<br />&nbsp;&nbsp;&nbsp;&lt;/div&gt;</font></p>


<p><font face="Courier" color="#0080c0" size="2">&nbsp;&nbsp;&nbsp;&lt;div style=&#8221;margin:2px; padding:2px; border: solid 1px #bbb; background-color: #eee; float: left; width: 75px;&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;..and here&#8217;s the 2nd<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;table border=1&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;&lt;td&gt;with a table&lt;/td&gt;&lt;/tr&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br />&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br />&nbsp;&nbsp;&lt;/td&gt;<br />&nbsp;&lt;/tr&gt;<br />&lt;/table&gt;</font></p>


<table><tbody><tr><td width="300"><div style="BORDER-RIGHT: #bbb 1px solid; PADDING-RIGHT: 2px; BORDER-TOP: #bbb 1px solid; PADDING-LEFT: 2px; FLOAT: left; PADDING-BOTTOM: 2px; MARGIN: 2px; BORDER-LEFT: #bbb 1px solid; WIDTH: 75px; PADDING-TOP: 2px; BORDER-BOTTOM: #bbb 1px solid; BACKGROUND-COLOR: #eee">here&#8217;s the 1st div </div><div style="BORDER-RIGHT: #bbb 1px solid; PADDING-RIGHT: 2px; BORDER-TOP: #bbb 1px solid; PADDING-LEFT: 2px; FLOAT: left; PADDING-BOTTOM: 2px; MARGIN: 2px; BORDER-LEFT: #bbb 1px solid; WIDTH: 75px; PADDING-TOP: 2px; BORDER-BOTTOM: #bbb 1px solid; BACKGROUND-COLOR: #eee">..and here&#8217;s the 2nd <table border="1"><tbody><tr><td>with a table</td></tr></tbody></table></div></td></tr></tbody></table>


<p>&nbsp;</p>


<p>Understanding how floating works is an important part of effective CSS web design.&nbsp; I may consider some more of these simple examples if they are of help to my readers.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/08/making-divs-stay-next-to-each-other/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/a-journey-with-domain-driven-design-and-nhibernate-part-4/">A Journey With Domain Driven Design (and NHibernate) - Part 4</a></h1>
    
    
      <p class="meta">




<time datetime="2006-07-23 00:00:00 -0500" pubdate  updated >Jul 23<span>rd</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>Welcome back!&nbsp; I’ve gone and switched the title of these articles all together to reflect the content more adequately!&nbsp; (Maybe I should have written the series ahead of time to avoid such issues, ya think?)</p>


<p>Anyway, last time we introduced some very basic unit tests.&nbsp; We&nbsp;simply verified that we can indeed create each object and pass in the invariants as constructor parameters.&nbsp; The only real decision making that this influenced was how to create objects.&nbsp; For example, it is no problem at all to allow direct creation (public constructor) on root objects such as <strong>Movie</strong>, <strong>Video</strong>, <strong>Account</strong>, and <strong>Customer</strong>, however I&nbsp;chose not to let <strong>Transaction</strong> be created&nbsp;directly, rather it is created from an existing <strong>Account</strong> object.&nbsp; The reason for this is simple.&nbsp; Picture what happens at a video store:&nbsp; You go to the counter with your card and your videos, the employee scans the card and sees your account details.&nbsp; The next thing that the employee will do is start a new transaction.&nbsp; An account object is always present at the time that we need to get a transaction object.&nbsp; Another reason for this is I decided to satisfy the invariants of the transaction (specifically the account) at creation time.</p>


<p>Jimmy Nilsson&nbsp;talks about creating <em>fluent interfaces</em> in his book <a title="amazon:Applying Domain Driven Design" href="http://www.amazon.com/gp/product/0321268202/ref=sr_11_1/002-0541598-4483203?ie=UTF8" target="_blank">Applying Domain Driven Design</a>.&nbsp;&nbsp;We want our object model to express intent and reinforce correct usage.&nbsp; To demonstrate this, consider the following code two segments:</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;">1)&nbsp; <span style="color: teal;">Transaction</span> tx = <span style="color: blue;">new</span> <span style="color: teal;">Transaction</span>(_account);</div>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;">2)&nbsp; <span style="color: teal;">Transaction</span> tx = _account.CreateTransaction();</div>


<p>I think that the 2nd option conveys more meaning and is more fluent than the first.&nbsp; This is, however, an early design choice and is always up to change with further refactorings.</p>


<p>I left off last time with a list of passing tests.&nbsp; (Sometimes people suggest to leave a failing test so you know right where to pick up the next day.)&nbsp; I have implemented a few more trivial tests, which I won’t bore you with here.&nbsp; Let’s get on with the more interesting tests.&nbsp; Another thing I’d like to note is that, the tests here pass, but only after I write the appropriate code&nbsp;in the model to satisfy the test.&nbsp; I am purposefully omitting the domain model code at this time because it is unimportant.&nbsp; You should be able to understand what the code does without looking inside the class.&nbsp; Onward….</p>


<p>As mentioned in the 1st article, a transaction will have many rentals.&nbsp; That is because you can rent more than 1 video per visit.&nbsp; The price of renting movies will vary, so in order to have history of what price was paid for an old transaction, we must allow the <strong>Rental</strong> to carry a price.&nbsp; Another thing we will have to consider is how to determine when an item is due.&nbsp; We’ll have to communicate with some service that will tell us when an item is due, given whether it is a new release, or a hardware item, etc.&nbsp; All we are&nbsp;concerned about&nbsp;at this time is that the rental knows it has a due date.&nbsp; How the due date is calculated is a&nbsp;responsibility&nbsp;outside of the <strong>Rental </strong>class.&nbsp;&nbsp;Agreed?&nbsp; On with the tests.</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanCreateTransactionForAccount()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Account</span> a = <span style="color: blue;">new</span> <span style="color: teal;">Account</span>();</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Customer</span> c = <span style="color: blue;">new</span> <span style="color: teal;">Customer</span>(<span style="color: maroon;">&#8220;john&#8221;</span>, <span style="color: maroon;">&#8220;doe&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Transaction</span> tx = a.CreateTransaction();</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Customer = c;&nbsp; </p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">//we can only be accurate up to the millisecond on the date here, but we can create a timespan of 2 hours just</span></p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: green;">//to be sure.</span></p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsTrue(tx.TransactionDate.CompareTo(<span style="color: teal;">DateTime</span>.Now.AddHours(-1)) &gt; 0 &amp;&amp;</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tx.TransactionDate.CompareTo(<span style="color: teal;">DateTime</span>.Now.AddHours(1)) &lt; 0, <span style="color: maroon;">&#8220;Date wasn&#8217;t set&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsNotNull(tx, <span style="color: maroon;">&#8220;Transaction wasn&#8217;t returned&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(a, tx.Account, <span style="color: maroon;">&#8220;Account wasn&#8217;t set&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsNotNull(tx.Rentals, <span style="color: maroon;">&#8220;Rentals collection was null&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(0, tx.Rentals.Count, <span style="color: maroon;">&#8220;Rentals collection wasn&#8217;t empty&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(0.0, tx.SubTotal);</p><p style="margin: 0px;">}</p></div>


<p>This test is a bit longer than previous ones, so I’ll go over it.&nbsp; We start by creating a customer and account to use in our test.&nbsp; Then we use the account object to create a transaction.&nbsp; The next sets the Customer that is actually renting the item.&nbsp; We need this because we may prevent the customer from renting items above his/her rental restriction.&nbsp;&nbsp;I’m now checking to see if the date was set.&nbsp; I used a simple 2 hour date range, because I cannot guarantee how fast this code will run.&nbsp; The idea is that the date and time will change from MinValue to Now after the creation of the <strong>Transaction</strong>.&nbsp; This will be caught by the assertion.&nbsp; The rest of the Asserts should be self-explanatory.</p>


<p>Now we are able to create a transaction, we should now be able to create rentals and add them to the transaction.&nbsp; Adding the rental to the transaction should change the transaction’s subtotal properly, so we need to test that as well, however this should be broken up into two tests (Remember, try to only test one unit at
a time!).</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanAddRentalToTransaction()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Transaction</span> tx = _account.CreateTransaction();</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Customer = _customer;</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Rental</span> r = <span style="color: blue;">new</span> <span style="color: teal;">Rental</span>(_video, 3.50f);</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(r);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(1, tx.Rentals.Count, <span style="color: maroon;">&#8220;Rental wasn&#8217;t added to transaction&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsTrue(tx.Rentals.Contains(r), <span style="color: maroon;">&#8220;Rental wasn&#8217;t the same!&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Rental</span> r2 = <span style="color: blue;">new</span> <span style="color: teal;">Rental</span>(_video2, 3.50f);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(r2);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(2, tx.Rentals.Count, <span style="color: maroon;">&#8220;2nd rental wasn&#8217;t added to transaction&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.IsTrue(tx.Rentals.Contains(r2), <span style="color: maroon;">&#8220;2nd rental wasn&#8217;t the same!&#8221;</span>);</p><p style="margin: 0px;">}</p></div>


<!--EndFragment-->


<p>As you can see, we create a rental, add it to the transaction, and verify that the collection count is correct and contains the new rental.&nbsp; We do it twice just to be sure.</p>


<p>One concept I haven’t shown yet is to test invalid usage of the model.&nbsp; We need to do this to make sure our domain model behaves accordingly if it is abused.&nbsp; Here’s a good example:</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanNotAddSameRentalToTransactionTwice()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Transaction</span> tx = _account.CreateTransaction();</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Customer = _customer;</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Rental</span> r = <span style="color: blue;">new</span> <span style="color: teal;">Rental</span>(_video, 3.50f);</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(r);</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(r);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(1, tx.Rentals.Count, <span style="color: maroon;">&#8220;Rental was added twice!&#8221;</span>);</p><p style="margin: 0px;">}</p></div>


<p>There is no conceptual reason that a rental should be added twice, so we check to make sure this isn’t allowed.</p>


<p>Up next, we need to verify that the Transaction’s subtotal property is calculated correctly.</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0% 50%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> TransactionSubTotalGiveSumOfRentalPrices()</p><p style="margin: 0px;">{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Transaction</span> tx = _account.CreateTransaction();</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(0.0, tx.SubTotal, <span style="color: maroon;">&#8220;No rentals should yield 0.00 subtotal&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(<span style="color: blue;">new</span> <span style="color: teal;">Rental</span>(_video, 3.50f));</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(3.50, tx.SubTotal, <span style="color: maroon;">&#8220;SubTotal should be 3.50 after adding a 3.50 rental&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; tx.Rentals.Add(<span style="color: blue;">new</span> <span style="color: teal;">Rental</span>(_video2, 3.50f));</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(7.00, tx.SubTotal, <span style="color: maroon;">&#8220;SubTotal should be 7.00 after adding 2 3.50 rentals&#8221;</span>);</p><p style="margin: 0px;">}</p></div>


<p>This test failed initially, and to get it to pass I had 2 choices of implementation:&nbsp; have a dynamic property that calculates the sum of the rental prices on the fly, or capture the collection adding/removing actions and adjust it appropriately.&nbsp; I chose the latter option, because I would like to persist this as a de-normalized column in the database.&nbsp; This way I can deal with a transaction object without actually loading up all the rentals along with it.&nbsp; You’ll see the benefit of this a bit later when we talk about NHibernate’s lazy loading.</p>


<p>Here’s&nbsp;&nbsp;the (slightly modified) feature list.&nbsp; I’ve colored the already implemented features in green.</p>


<ul><li><font color="#009f00">Add new Customer / Account</font> </li><li><font color="#009f00">Add other members to an account</font> </li><li>Restrict certain members from renting certain content </li><li>Query for a Customer by Customer # (swipe card, etc), phone number, or last name </li><li><font color="#009f00">Add new rental item (movie, video game, game console, vcr, etc)</font> </li><li>Rent an item to a customer <ul><li><font color="#009f00">Create a Transaction</font> </li><li><font color="#009f00">Add Rental To Transaction</font> </li><li>Finalize Transaction </li><li>Calculate due date for an item</li></ul></li><li>Check items back in from a customer </li><li>Get movies checked out for a customer </li><li>Calculate late fees for a customer </li><li>Query for an item, see who has it</li></ul>


<p>We’re coming to a point where we need to start persisting our domain model.&nbsp; Most of the remaining&nbsp; features to implement will employ querying a database, so we’ll probably start on persistence next time.</p>


<!--EndFragment-->


<!--EndFragment-->

</div>
  <footer>
    <a rel="full-article" href="/2006/07/a-journey-with-domain-driven-design-and-nhibernate-part-4/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/a-journey-with-nhibernate-and-ddd-part-3/">A Journey With NHibernate (and DDD) - Part 3</a></h1>
    
    
      <p class="meta">




<time datetime="2006-07-19 00:00:00 -0500" pubdate  updated >Jul 19<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I decided to somewhat rename this series to include Domain-Driven Design.&nbsp; It became apparent after <a title="Part 1" href="http://www.flux88.com/2006/07/10/A+Journey+With+NHibernate++Part+1.aspx">Part One</a> and <a title="Part 2" href="http://www.flux88.com/2006/07/10/A+Journey+With+NHibernate++Part+2.aspx">Part Two</a> that I will spend a lot of time just developing the domain model.&nbsp; I could either skip this step and start with a fully functional model, ready for persistence, or I can slow down a bit and focus on creating the domain model as well.&nbsp; Due to some recent feedback I am choosing to focus a bit on modeling the application.&nbsp; This will of course delay the NHibernate specifics, but a good understanding of the object model is crucial to effective object-relational mapping.&nbsp; On we go….</p>


<p>Before we get started with the tests (as I promised), I’d like to mention that I received some good advice from <a href="http://blogs.sarkhouston.com/hdierking" target="_blank">Howard Dierking</a>&nbsp;about how I was approaching the development.&nbsp; He suggested that I refrain from creating an entire solution structure up front, and delay such details until a need arises for them.&nbsp; I hadn’t actually&nbsp;created these projects in my pet project (I was more thinking-out-loud), but it is worth mentioning that the project structure in part 1 is something that, from experience, &nbsp;I already had in mind what I wanted.&nbsp;&nbsp; Focus on the task-at-hand, which is the Domain Model.&nbsp; Speaking of, let’s start with our test list…..</p>


<p>When testing, whether you practice test-driven development (TDD) or not, it is important that your tests and your code follow each other closely.&nbsp; <a title="walking along the developer beach..." href="http://www.agiledeveloper.com/blog/PermaLink,guid,cb96e2d3-06bb-4a25-b4af-6546a9bae2b0.aspx" target="_blank">Venkat Subramaniam</a>&nbsp;compares this to walking on a beach, one foot following the other.&nbsp; I’m not a TDD purist, but I try to write the tests first to let the consumer (the calling code) drive the design.</p>


<p>I wrote down (yes, on paper) a simple list of test that I’d like to implement.&nbsp; In no particular order, here they are:</p>


<ul><li><strong>Can create an Employee</strong></li><li><strong>Can create a Customer</strong></li><li><strong>Can create a Video</strong></li><li><strong>Can create a VideoGame</strong></li><li><strong>Can create a Console</strong></li><li><strong>Can create a Movie</strong></li><li><strong>Can create a Game</strong></li><li>Can query for an Employee by EmployeeId</li><li>Can query for a Customer by CustomerId</li><li>Can create an Account</li><li>Can associate a Customer to Account</li><li>Can create a Transaction for an Account</li><li>Can create a Rental for an Item from a Transaction</li></ul>


<p>&nbsp; <em>Tests in bold are the ones I’ll implement first.&nbsp; With a list of tests like this, it’s really up to you what gets implemented next.&nbsp; Focus on a small set and implement them, all the while keeping an entire list of tests you are working on, test that will come later, and tests that have been completed.&nbsp; This method of working is described in detail in <a title="Amazon - TDD book" href="http://www.amazon.com/gp/product/0321146530/sr=8-1/qid=1152764089/ref=pd_bbs_1/104-5607051-3417551?ie=UTF8" target="_blank">Test-Driven Development</a> by Kent Beck.</em></p>


<p>Here’s what my solution looks like:</p>


<p><img src="/images/CropperCapture%5B15%5D_small_.jpg" alt="CropperCapture[15]"  border="1" /></p>


<p>&nbsp; I’ve only implemented the bare minimum on these classes, just enough to show the diagrams from last time.&nbsp; In order to test this class library, let’s add another class library project and call it <strong>Flux88.Videocracy.DomainModel.Tests</strong>.</p>


<p><img src="/images/CropperCapture%5B17%5D_small_.jpg" alt="CropperCapture[17]"  border="1" /></p>


<p>&nbsp;</p>


<p>&nbsp;</p>


<p>&nbsp;</p>


<p>We need to add a couple of references here.&nbsp; First, we are going to be testing objects from the Domain Model project, so we need to add a project reference to that.&nbsp; We will also be utilizing NUnit for our tests so we need to add a reference to NUnit.Framework.dll.</p>


<p>Here’s a skeleton class for Employee Tests:</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 10pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;"><span style="color: blue;">using</span> System;</p><p style="margin: 0px;"><span style="color: blue;">using</span> Flux88.Videocracy.DomainModel;</p><p style="margin: 0px;"><span style="color: blue;">using</span> NUnit.Framework;</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: blue;">namespace</span> Flux88.Videocracy.DomainModel.Tests</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; [<span style="color: teal;">TestFixture</span>]</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: teal;">EmployeeTests</span></p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//called before every test</span></p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color: teal;">SetUp</span>]</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> SetUp()</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//called after every test</span></p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; [<span style="color: teal;">TearDown</span>]</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> TearDown()</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p><p style="margin: 0px;">}</p><p style="margin: 0px;">&nbsp;</p></div>


<!--EndFragment-->


<p>You’ll notice I have a <em>using</em> statement for both my domain model and NUnit, as I will use these namespaces frequently in my tests.&nbsp; </p>


<p>The attributes you see above the class &amp; methods are NUnit attributes.&nbsp; [TestFixture] denotes a class that has tests.&nbsp; When the test runner loads my test dll, it will notice this and parse the class for test methods (we’ll see in a&nbsp;second).&nbsp; The [SetUp] method is called exactly once before every single test.&nbsp; This is where you’d create any objects or set any preconditions for every test.&nbsp; The [TearDown] cleans up any objects or junk left over from the test.&nbsp; Each test should be able to run independently of any other.&nbsp; Don’t count on one test running successfully before another test can run.</p>


<p>Ok, our first test on the list was <strong>CanCreateEmployee</strong>.&nbsp; In this test I want to make sure that I can instantiate the Employee class and take in any invariants in the constructor.&nbsp; We don’t ever want to have an employee without a name, so name will be a constructor parameter to enforce that all new Employees have a name.&nbsp; Also all employees will be either a Customer Service Rep or a Manager, so we’ll take that in as well.</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="ma
rgin: 0px;">&nbsp;[<span style="color: teal;">Test</span>]</p><p style="margin: 0px;">&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">void</span> CanCreateEmployee()</p><p style="margin: 0px;">&nbsp;{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal;">Employee</span> emp = <span style="color: blue;">new</span> <span style="color: teal;">Employee</span>(<span style="color: maroon;">&#8220;Joe&#8221;</span>, <span style="color: maroon;">&#8220;Blow&#8221;</span>, <span style="color: teal;">EmployeeType</span>.CustomerServiceRep);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;Joe&#8221;</span>, emp.FirstName, <span style="color: maroon;">&#8220;FirstName wasn&#8217;t set properly.&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;Blow&#8221;</span>, emp.LastName, <span style="color: maroon;">&#8220;LastName wasn&#8217;t set properly.&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: teal;">EmployeeType</span>.CustomerServiceRep, emp.Type, <span style="color: maroon;">&#8220;Employee type was not set.&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: teal;">Assert</span>.AreEqual(0.0, emp.HourlyWage, <span style="color: maroon;">&#8220;Wage was not initially 0.0&#8221;</span>);</p><p style="margin: 0px;">&nbsp; }</p></div>


<!--EndFragment-->


<p>Decorating the method with the [Test] attribute tell NUnit to run this method as a test.&nbsp; I create an employee and pass in the name &amp; type, then I run a couple of NUnit’s Asserts to verify that the properties were set properly.&nbsp; I decided that HourlyWage was not a required input.&nbsp; Right now there is no real need to do anything with HourlyWage, so I’m not going to test this.&nbsp; You’ll notice that the <em>Assert.AreEqual</em> verifies that the&nbsp;two values are equal, and if not it fails the current test with the specified error message.&nbsp; If it makes it to the end of the method without any errors, your test passes!</p>


<p>Ok, now it’s time to compile.&nbsp; Oops!&nbsp; I get an error.&nbsp; I haven’t yet implemented the constructor that takes in the parameters.&nbsp; I’ll add that and compile again.&nbsp; Also I’m going to make the default constructor private because I don’t want any callers to be able to instantiate the employee without filling out those parameters.&nbsp; Compiling now succeeds and we’re ready to run the test.</p>


<p><img src="/images/CropperCapture%5B18%5D_small1_.jpg" alt="CropperCapture[18]"  border="1" /></p>


<p>Load up the NUnit GUI and open your new test dll.&nbsp; You’ll see that NUnit organizes your tests hierarchically.&nbsp; We only have 1 test, called CanCreateEmployee.&nbsp; Lets run it now.</p>


<p>&nbsp;</p>


<p><img src="/images/CropperCapture%5B19%5D_small_.jpg" alt="CropperCapture[19]"  border="1" /></p>


<p>The tests pass!&nbsp; Now it’s time to refactor.&nbsp; Right now I’m directly setting the first name and last name in the employee class, but employee doesn’t actually <em>own</em> these properties, Person does.&nbsp; A simple refactoring is in order.&nbsp; I’ll add the invariants to the Person class and keep the only Employee specific invariant to the employee class.&nbsp; This is what it looks like now:</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">&nbsp;<span style="color: blue;">public</span> Person(<span style="color: blue;">string</span> firstName, <span style="color: blue;">string</span> lastName)</p><p style="margin: 0px;">&nbsp;{</p><p style="margin: 0px;">&nbsp; &nbsp;&nbsp; _firstName = firstName;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp; _lastName = lastName;</p><p style="margin: 0px;">&nbsp;}</p></div>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;"><p style="margin: 0px;">&nbsp;<span style="color: blue;">public</span> Employee(<span style="color: blue;">string</span> firstName, <span style="color: blue;">string</span> lastName, <span style="color: teal;">EmployeeType</span> type)</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : <span style="color: blue;">base</span>(firstName, lastName)</p><p style="margin: 0px;">&nbsp;{</p><p style="margin: 0px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Type = type;</p><p style="margin: 0px;">&nbsp;}</p></div>


<p>You can see that the employee class is now passing arguments to the parent class’s constructor.&nbsp; We run the test again to make sure that the property setting still works, and it does.&nbsp; This kind of simple refactoring is something you regularly do as you develop.&nbsp; The tests are there to back you up and assure you that you haven’t broken anything.&nbsp; </p>


<p>I started off kind of slow to illustrate how the process goes.&nbsp; I’ll speed up as I implement the remaining tests.</p>


<p><strong>Can Create Customer</strong> was the next test, but it’s painfully similar to the above example, so I will just implement it and move on.&nbsp; (…. a bit of typing ….) ok, now that test is passing.&nbsp; Let’s move on to <strong>Can Create Video.</strong></p>


<p>Let’s give some thought on what a video is.&nbsp; A video is a representation of the actual item you hold in your hands at the video store.&nbsp; It contains a movie, but there is a distinction here.&nbsp; I chose to separate the movie details from the video following the <a title="Type Object Pattern explained" href="http://www.ksc.com/article3.htm" target="_blank">Type-Object pattern</a>&nbsp;(as it turns out, their example is about movies too!&nbsp; what luck!).&nbsp; Since a video cannot exist without a movie, we should probably test the movie creation first.&nbsp; Here’s <strong>CanCreateMovie</strong>:</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;">[<span style="color: teal;">TestFixture</span>] <p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: teal;">MovieTests</span></p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; [<span style="color: teal;">Test</span>]</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">void</span> CanCreateMovie()</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; {</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Movie</span> superTroopers = <span style="color: blue;">new</span> <span style="color: teal;">Movie</span>(<span style="color: maroon;">&#8220;Super Troopers&#8221;</span>, <span style="color: teal;">MovieCategory</span>.Comedy, 2001);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: maroon;">&#8220;Super Troopers&#8221;</span>, superTroopers.Name, <span style="color: maroon;">&#8220;Name wasn&#8217;t set&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: teal;">MovieCategory</span>.Comedy, superTroopers.Category, <span style="color: maroon;">&#8220;Category wasn&#8217;t set&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: teal;">Assert</s
pan>.AreEqual(2001, superTroopers.Year, <span style="color: maroon;">&#8220;Year wasn&#8217;t set&#8221;</span>);</p><p style="margin: 0px;">&nbsp;&nbsp;&nbsp; }</p><p style="margin: 0px;">}</p></div>


<!--EndFragment-->


<p>I make sure and pass in&nbsp;a&nbsp;title, category, and year.&nbsp; If the categories are to be user definable later on, we’ll probably opt for a class instead of an enum, but again we defer this decision until it is actually&nbsp;needed.</p>


<p>I run the tests again, and:&nbsp; </p>


<p><img src="/images/CropperCapture%5B21%5D_small_.jpg" alt="CropperCapture[21]"  border="1" /></p>


<p>…all passing.&nbsp; </p>


<p>I’m ready to write our Video test, but here’s where things get tricky.&nbsp; We identified previously that a video cannot exist without a movie, but one of the testaments to good unit testing&nbsp;is writing tests that do not depend on other tests.&nbsp; The purist solution to this is to extract an interface for Movie (called IMovie) that can be&nbsp;faked out in the test (A fake is a class implements the interface with known/precalculated values that you can test upon).&nbsp; I think this approach is a bit overkill for a simple class like Movie, but if the class connected to another resource, such as a database, web service, or file, then I’d definitely stub out the interface for testing.</p>


<div style="border: 1px solid rgb(51, 51, 51); background: white none repeat scroll 0%; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Consolas;">[<span style="color: teal;">Test</span>] <p style="margin: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> CanCreateVideo()</p><p style="margin: 0px;">{</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Movie</span> caddyShack = <span style="color: blue;">new</span> <span style="color: teal;">Movie</span>(<span style="color: maroon;">&#8220;Caddy Shack&#8221;</span>, <span style="color: teal;">MovieCategory</span>.Comedy, 1980);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Video</span> v = <span style="color: blue;">new</span> <span style="color: teal;">Video</span>(caddyShack, <span style="color: teal;">VideoFormat</span>.DVD);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(v.Movie, caddyShack, <span style="color: maroon;">&#8220;Movie wasn&#8217;t set.&#8221;</span>);</p><p style="margin: 0px;">&nbsp; &nbsp; <span style="color: teal;">Assert</span>.AreEqual(<span style="color: teal;">VideoFormat</span>.DVD, v.Format, <span style="color: maroon;">&#8220;Format wasn&#8217;t set.&#8221;</span>);&nbsp; &nbsp; &nbsp; </p><p style="margin: 0px;">}</p></div>


<!--EndFragment-->


<!--EndFragment-->


<p>This test actually depends on two things.&nbsp; One, mentioned above, is <strong>CanCreateMovie</strong>.&nbsp; The other is a valid implementation of Movie.ToEquals(), since we are equating the two movie objects.&nbsp; This can make your tests somewhat ambiguous, as the tests will fail for different reasons.&nbsp; I have yet to find a really good balance between <em>Interfacing</em> everything and having tests that depend on other tests.&nbsp; For something this trivial I won’t worry about it, but for more sophisticated tests I will be sure and isolate the test.</p>


<p>Right now this is what NUnit looks like:</p>


<p><img src="/images/CropperCapture%5B22%5D_small_.jpg" alt="CropperCapture[22]"  border="1" /></p>


<p>All of the tests are passing and we’re at a good stopping point.&nbsp; </p>


<p><li><strike>Can create an Employee</strike></li><li><strike>Can create a Customer</strike></li><li><strike>Can create a Video</strike></li><li><strong>Can create a VideoGame</strong></li><li><strong>Can create a Console</strong></li><li><strike>Can create a Movie</strike></li><li><strong>Can create a Game</strong></li><p>Next time we’ll see some more complicated tests.&nbsp; Until then….</p></p>
</div>
  <footer>
    <a rel="full-article" href="/2006/07/a-journey-with-nhibernate-and-ddd-part-3/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/a-journey-with-nhibernate-part-2/">A Journey With NHibernate - Part 2</a></h1>
    
    
      <p class="meta">




<time datetime="2006-07-10 00:00:00 -0500" pubdate  updated >Jul 10<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p><a title="Part 1" href="http://www.flux88.com/2006/07/05/A+Journey+With+NHibernate++Part+1.aspx">Last time</a> I talked pretty high-level about starting a project with NHibernate.</p>


<p>This time I am going to start off creating a pet project to demonstrate how to implement these ideas.&nbsp; First we’ll implement a simple domain model to support our features.&nbsp; We will combine these with unit tests to verify behavior.</p>


<p>Let’s create a dummy video rental system.&nbsp; We’ll call it <strong>Videocracy</strong> (hey, that’s pretty good!).&nbsp; In this sytem we’ll have to support the following features:</p>


<ul><li>Add new Customer / Account</li><li>Add other members to an account</li><li>Restrict certain members from renting certain content</li><li>Query for a Customer by Customer # (swipe card, etc), phone number, or last name</li><li>Add new rental item (movie, video game, game console, vcr, etc)</li><li>Rent an item to a customer</li><li>Check items back in from a customer</li><li>Get movies checked out for a customer</li><li>Calculate late fees for a customer</li><li>Query for an item, see who has it</li></ul>


<p>I think I will create this as an ASP.NET application to demonstrate some of the concerns with NHibernate in combination with the stateless nature of web applications.&nbsp; WinForms topics will be relatively straightforward in comparison.</p>


<p>Following domain-driven design principles, I want to develop the core functionality of the domain.&nbsp; I want to unit test it.&nbsp; And I don’t want it to be influenced by infrastructure concerns.&nbsp; Many people would start this project off by creating the database structure.&nbsp; I will put this off until much later so that I can not let a relational design influence my object-oriented design.&nbsp; The database <em>supports</em> my object model, not the other way around.</p>


<p><strong>Designing the model<br></strong>Ok, just about any system has users, and in this case there are a couple types of users.&nbsp; We’ll start by modeling what a “Person” means to our system.&nbsp; A person can represent a customer or employee, so we’ll join the commonalities in the Person class:</p>


<p><a href="http://www.flux88.com/uploads/CropperCapture%5B9%5D.Jpg"><img src="/images/CropperCapture%5B9%5D_thumb_.jpg" alt="Person class"  border="1" /></a></p>


<p>Employees will have additional data relevant only to them (I kept it simple):</p>


<p><img src="/images/CropperCapture%5B11%5D_small_.jpg" alt="Employee class"  border="1" /></p>


<p>And finally, the Customer class:</p>


<p><img src="/images/CropperCapture%5B12%5D_small_.jpg" alt="Customer class"  border="1" /></p>


<p>I decided to leave these pretty simple.&nbsp; There is no need to implement features unless there is an existing requirement for them.</p>


<p>Next up is the Account class.&nbsp; An account will have at least 1 customer.&nbsp; The account will also have an outstanding balance, so that an employee can ask for late fee payments when they rent new items.</p>


<p>Accounts will have current checked out items as well, so I modeled a simple Video Item.&nbsp; A video represents the physical item that is checked out, but&nbsp; each video is actually a movie, so there is a reference to a movie class as well.&nbsp; Games will be vastly similar, so I’ll omit it here.&nbsp; Here’s what the whole thing looks like now:</p>


<p><a href="http://www.flux88.com/uploads/CropperCapture%5B13%5D.Jpg"><img src="/images/CropperCapture%5B13%5D_thumb_.jpg" alt="Account, Video classes"  border="1" /></a></p>


<p>As you can see, the account holds a reference to its members.&nbsp; This is a generic list, and though NHibernate does not support it (yet) we can implement them using the excellent NHibernate.Generics assembly written by the very intelligent&nbsp;<a href="http://www.ayende.com/projects/nhibernate-query-analyzer/generics.aspx">Ayende Rahien</a>.</p>


<p>I’m not entirely happy with the domain model right now.&nbsp; I think that having the Account directly hold a reference to its currently checked out items is a code-smell, but I can refactor that a bit later.&nbsp; I think this kind of information will be better delivered by querying a service rather than contained within the object itself.&nbsp; (Making a note to refactor…….).</p>


<p>Next up, we need to model the actual rental structure.&nbsp; This is where the design will take the most pressure.</p>


<p><a href="http://www.flux88.com/uploads/CropperCapture%5B14%5D.Jpg"><img src="/images/CropperCapture%5B14%5D_thumb_.jpg" alt="CropperCapture[14]"  border="1" /></a></p>


<p>A customer grabs some movies and goes to the counter.&nbsp; The employee opens his account and starts a new <em>Transaction<strong>.&nbsp; </strong>Items</em>&nbsp;are scanned and added to the <em>Transaction</em>.&nbsp; The rental encompasses that dateRented, dateDue, dateReturned and late calculating logic.&nbsp; I will defer late fee calculation until later as a strategy class, as that is not the responsibility of a rental.</p>


<p>I decided to remove the reference to the <em>ItemsCheckedOut</em> of the <em>Account</em> class.&nbsp; This data is provided through the rental structure, and a simple query will return items that have not yet been returned.&nbsp; If I had already made this change in the database as well as the object model, it would be more difficult to change.&nbsp; If a change is difficult to make, developers are less likely to make the change.</p>


<p>I realize that we haven’t yet touched NHibernate yet, but I’m getting there.&nbsp; I want to demonstrate how NHibernate fits with Domain-Driven Design.</p>


<p>I think we’re at a point to start unit testing the behavior of the system.&nbsp; Next time I’ll introduce a testing project and go through some behavior tests.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/07/a-journey-with-nhibernate-part-2/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/a-journey-with-nhibernate-part-1/">A Journey With NHibernate - Part 1</a></h1>
    
    
      <p class="meta">




<time datetime="2006-07-05 00:00:00 -0500" pubdate  updated >Jul 5<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>In this series of articles, I am going to dive into some topics with NHibernate.&nbsp; There is a lot of beginner information on the internet, but not a whole lot of real-life examples.&nbsp;&nbsp; I’ve seen countless exaples where the author builds a session factory, creates a session, and does some persistence all inside a single method or block of code.&nbsp; This is of course ludicrous for real projects.&nbsp; This is something I’d like to address.&nbsp; I’ll try to focus on things like proper object-oriented design and testability with your projects.</p>


<p>In the first few articles, we will see how to start projects using NHibernate, go over some basic topics, and then get progressively more complex as we explore the many features of the ORM tool.</p>


<p>If you don’t know what NHibernate is, I’d suggest <a title="google search for nhibernate" href="http://www.google.com/search?q=nhibernate" target="_blank">a google search</a>&nbsp;or going to the <a href="http://hibernate.org/" target="_blank">NHibernate home page</a>.</p>


<p>…..go ahead, I’ll wait…..</p>


<p>Ok, so you know what NHibernate does, and you’re convinced you want to use it.&nbsp; What next?&nbsp; First we have to understand how to “properly” structure your project.</p>


<p><em>(Side note:&nbsp; I say ‘properly’ in quotes because some will disagree with me.&nbsp; There are 2 very distinct camps when it comes to designing domain objects for persistence.&nbsp; One camp follows an active record (class-in-charge)&nbsp;approach to persistence (such as <a href="http://www.castleproject.org/index.php/ActiveRecord" target="_blank">Castle’s ActiveRecord</a> and <a href="http://www.lhotka.net/ArticleIndex.aspx?area=CSLA%20.NET%2020" target="_blank">CSLA.NET</a>).&nbsp; These folks prefer to encapsulate all of the persistence inside of the object itself.&nbsp; I started off with this mentality, but quickly got annoyed with all of the persistence code within my domain model.&nbsp; I have since sided with the POCO/PI (Plain-Old-CLR-Objects / Persistence-Ignorant) objects where your objects are completely separated from their persistence.&nbsp; I think this leads to code that is easier to test, less-cluttered, and decoupled from infrastructure concerns.&nbsp; This leaves only business logic, which is the most important concern to any project.&nbsp; In this article I am going to focus on PI objects, however most of the content will be relative to an active record approach).</em></p>


<p>I will start out by creating the project structure:</p>


<ul><li><strong>Project.DomainModel </strong>(business objects / logic)</li><li><strong>Project.Persistence&nbsp; </strong>(data access strategy)</li><li><strong>Project.Utilities&nbsp; </strong>(project-wide utilities)</li><li><strong>Project.Web.UI&nbsp; </strong>(web front-end, if any)</li><li><strong>Project.Win.UI&nbsp;&nbsp; </strong>(windows front-end, if any)</li><li><strong>Project.DomainModel.Tests </strong>(tests for the domain model)</li><li><strong>Project.Persistence.Tests </strong>(tests for the persistence layer.)</li></ul>


<p>To ensure that the domain model knows nothing of persistence, I will make sure not to add the reference to the Persistence project or any NHibernate dlls.&nbsp; Now, we can add the reference to the NHibernate dll to the Persistence project.</p>


<p>The test projects, as you can see, are separated based on what they test.&nbsp; Why is this?&nbsp; Because your main tests are going to be testing the logic and behavior of the domain model.&nbsp; It is imperative that these tests run quickly.&nbsp; If you keep the slower tests separate, it keeps developers more productive (and more likely to run the tests!).&nbsp; The persistence tests will actually hit the database, and so they will be *much* slower.&nbsp; We’ll see this later on.</p>


<p>On any object-oriented domain model, you should try to develop&nbsp;your objects&nbsp;without concern for the database.&nbsp; That is, develop and test the behavior of your objects before you even go to save them to the database.&nbsp; There are many benefits to programming this way:</p>


<ul><li><strong>Your code is more testable<br></strong>Code that doesn’t depend on many things is easier to test.&nbsp; The data access portion is a large example of this.&nbsp; You should be able to test object interaction entirely without hitting a database.</li><li><strong>Your knowledge of the domain increases as you go<br></strong>You aren’t ever going to understand every minute detail of an application before you write it.&nbsp; No matter how much up-front design you do, you’ll always end up getting stumped and&nbsp;running into a road-block, or your understanding of the problem domain will evolve.&nbsp; This is expected and embraced when you are practicing Test Driven Development.&nbsp; Your code changes are backed up by unit tests which tell you if the code is working.&nbsp; If you leave out the database in this loop, you return to a a functioning domain a lot quicker.&nbsp; Implement the database once your design has settled down some more.</li><li><strong>Your persistence layer can be substituted with minimal impact to program behavior<br></strong>If you decide at some point that you’d rather go with a different ORM, or hand-craft the data access portion you can do that.&nbsp; You don’t have to worry about your changes affecting program behavior, as long as you fulfill the responsibilities of the data access layer.</li></ul>


<p>I think that we have a good overview of NHibernate and how it fits nicely with Domain Driven Design.&nbsp; In the next article we’ll get more concrete and actually start a fictitous project using NHibernate and .NET 2.0.</p>


<p>Until next time….<br></p>

</div>
  <footer>
    <a rel="full-article" href="/2006/07/a-journey-with-nhibernate-part-1/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/ankhsvn-supports-visual-studio-2005/">AnkhSVN Supports Visual Studio 2005</a></h1>
    
    
      <p class="meta">




<time datetime="2006-06-30 00:00:00 -0500" pubdate  updated >Jun 30<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I just learned that <a href="http://ankhsvn.tigris.org/" target="_blank">AnkhSVN</a>&nbsp;now supports Visual Studio 2005.&nbsp; Sweetness.</p>


<p>Ankh is by no means a replacement for TortoiseSVN, but rather a plugin for VS that makes your life a bit easer.&nbsp; Tortoise and Ankh&nbsp;go hand in hand with each other.&nbsp; </p>


<p>Usually I commit my changes, add my files, and call Update directly from Ankh.&nbsp; Sometimes, for example with files outside of VS, I&rsquo;ll use tortoise.</p>


<p>In the event that something is screwed up, Tortoise is the way to go to get things on the right track again.&nbsp; You just have so much more capability with that tool.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/06/ankhsvn-supports-visual-studio-2005/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/visual-2005-reportviewer-doesnt-work-with-mssql-2000/">Visual 2005 ReportViewer Doesn&#8217;t Work With MSSQL 2000</a></h1>
    
    
      <p class="meta">




<time datetime="2006-06-28 00:00:00 -0500" pubdate  updated >Jun 28<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I was trying to connect a 2005 WinForms ReportViewer&nbsp;control to a SSRS 2000 report server and I kept getting an HTTP 404, even though the url was correct.</p>


<p>Apparently it&rsquo;s not supported.</p>


<p>The error message did say &ldquo;Make sure this report server is compatible with the ReportViewer&rdquo; but I think that&rsquo;s something that they should just come out and tell me.&nbsp; I mean, come on&hellip; ReportViewer 2005 can easily recognize that I&rsquo;m connecting to a 2000 report server.</p>


<p>I had to spend 20 minutes searching the internet to get a definitive answer.&nbsp; Hopefully this will save someone some grief.</p>


<p>&nbsp;</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/06/visual-2005-reportviewer-doesnt-work-with-mssql-2000/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/transactionscope-msdtc-windows-2000/">TransactionScope + MSDTC + Windows 2000</a></h1>
    
    
      <p class="meta">




<time datetime="2006-06-28 00:00:00 -0500" pubdate  updated >Jun 28<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>For my data access unit tests, I am a huge fan of the new System.Transactions namespace in .NET 2.0.&nbsp; Basically I can define my unit tests like this:</p>


<div style="BORDER-RIGHT: #333 1px solid; BORDER-TOP: #333 1px solid; FONT-SIZE: 10pt; BACKGROUND: white; BORDER-LEFT: #333 1px solid; COLOR: black; BORDER-BOTTOM: #333 1px solid; FONT-FAMILY: Consolas"><p style="MARGIN: 0px"><span style="COLOR: blue">using</span> System;</p><p style="MARGIN: 0px"><span style="COLOR: blue">using</span> NUnit.Framework;</p><p style="MARGIN: 0px"><span style="COLOR: blue">using</span> System.Transactions;</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">[TestFixture]</p><p style="MARGIN: 0px"><span style="COLOR: blue">public</span> <span style="COLOR: blue">class</span> TestClass1</p><p style="MARGIN: 0px">{</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">private</span> TransactionScope _tx;</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; [Setup]</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> SetUp()</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; {</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _tx = <span style="COLOR: blue">new</span> TransactionScope();</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; }</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; [TearDown]</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> TearDown()</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; {</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _tx.Dispose();</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; }</p><p style="MARGIN: 0px">&nbsp;</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; [Test]</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; <span style="COLOR: blue">public</span> <span style="COLOR: blue">void</span> TestSaveSomeData()</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; {</p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="COLOR: green">//some code that inserts data into the database</span></p><p style="MARGIN: 0px">&nbsp;&nbsp;&nbsp; }</p><p style="MARGIN: 0px">}</p></div>


<p>Without the TransactionScope above, we would end up with a bunch of junk data in the database.</p>


<p>What&rsquo;s great about this method, is that &ndash; from the bottom layer &ndash; I can start a transaction, do all kinds of inserts/updates/deletes and even select from that data, and then roll the entire thing back when I&rsquo;m done.&nbsp; (Even in the event of failure).</p>


<p>What&rsquo;s not so nice is that TransactionScope uses MSDTC (Microsoft Distributed Transaction Coordinator) behind the scenes.&nbsp; This is fine locally as long as you have the service running on your machine.&nbsp; But what if you try to do this on a database on another server?</p>


<p>In my case I was connecting to a Windows 2000 Server on the local network.&nbsp; The MSDTC handshake was failing.&nbsp; This was due to security settings built into Windows XP SP2.</p>


<p>I received enourmous help from Florin Lazar&rsquo;s blog post:&nbsp;<a href="http://blogs.msdn.com/florinlazar/archive/2004/06/18/159127.aspx">http://blogs.msdn.com/florinlazar/archive/2004/06/18/159127.aspx</a></p>


<p>I opened up <em>Administrative Tools -&gt; Component Services</em> , right-clicked on <em>My Computer </em>and selected <em>Properties.</em>&nbsp; Under the <em>MSDTC</em> tab, I clicked <em>Security</em>.&nbsp; Then I enabled <em>Inbound and Outbound connections, and set the authentication to &ldquo;No Authentication Required&rdquo;.&nbsp; </em>That last part is kind of confusing, but basically it&rsquo;s required for pre-XP/2003 machines, such as NT or Windows 2000.</p>


<p>Now my transactions are running again.</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/06/transactionscope-msdtc-windows-2000/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/is-songbird-the-media-solution-im-looking-for/">Is Songbird the Media Solution Im Looking For?</a></h1>
    
    
      <p class="meta">




<time datetime="2006-06-27 00:00:00 -0500" pubdate  updated >Jun 27<span>th</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>I just discovered this today:</p>


<p><a href="http://www.songbirdnest.com/">http://www.songbirdnest.com/</a></p>


<p><img alt="" src="http://www.songbirdnest.com/themes/gespaa_customized/main_screenshot_small.png" border="0" /></p>


<p>It&rsquo;s called Songbird and I think they&rsquo;re on to something.&nbsp; Just admit it:&nbsp; Our current media situation sucks.&nbsp; I posted about this previously and ranted about how much I hate most media players.&nbsp; Anyway, I settled for iTunes, but not because I love it, only because it&rsquo;s the lesser of other evils (IMHO).</p>


<p>Songbird is taking a different approach to media players, integrating it more closely with the web, and it&rsquo;s built on top of Firefox, so it&rsquo;s cross-platform and have rich plugin support.&nbsp; I&rsquo;m really looking forward to some of the extensions that will become of this.</p>


<p>It&rsquo;s based on XUL, which should impress some super-techies out there <img src="/images/smile1_______________.gif"   />.&nbsp;&nbsp; I wonder how nicely this will work with a distributed scenario like iTunes + FolderShare?</p>

</div>
  <footer>
    <a rel="full-article" href="/2006/06/is-songbird-the-media-solution-im-looking-for/">Read on &rarr;</a>
  </footer>


  </article>


  <article>
    
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/adding-connection-strings-at-runtime/">Adding Connection Strings at Runtime</a></h1>
    
    
      <p class="meta">




<time datetime="2006-06-21 00:00:00 -0500" pubdate  updated >Jun 21<span>st</span>, 2006</time>


</p>
    
  </header>


  <div class="entry-content"><p>Today I noticed how non-intuitive it is to write to the configuration file programatically for an application.&nbsp; What I needed to do was dynamically create a connection string, then write it to the app.config file.</p>


<p>Here’s how you do it:</p>


<p>first, you need to add a project reference to the <strong>System.Configuration </strong>assembly.&nbsp; Add a corresponding using clause to the top of your class.</p>


<div style="border: 1px solid rgb(102, 102, 102); background: white none repeat scroll 0% 50%; overflow: auto; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Courier New;"><span style="color: rgb(43, 145, 175);">&nbsp; &nbsp;</span><span style="color: blue;">using</span> System.Configuration;</div>


<p>Next you need to find and open the configuration file.&nbsp; In win forms, you do this by specifying the full path to your application’s executable.&nbsp; If you project is at <strong>c:\code\project1</strong> then you would pass in something like this: “<strong>c:\code\project1\bin\debug\project1.exe</strong>”.</p>


<div style="border: 1px solid rgb(102, 102, 102); background: white none repeat scroll 0% 50%; overflow: auto; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Courier New;"><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span><span style="color: teal;">Configuration</span> config = <span style="color: teal;">ConfigurationManager</span>.OpenExeConfiguration(FULL_EXE_PATH);</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span></p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);"></span><span style="color: teal;">&nbsp;ConnectionStringSettings</span> connStringSettings = <span style="color: blue;">new</span> <span style="color: teal;">ConnectionStringSettings</span>(<span style="color: maroon;">&#8220;database&#8221;</span>, </p><p style="margin: 0px;"><span style="color: maroon;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp; </font>&#8220;connection_string_here&#8221;</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span>config.ConnectionStrings.ConnectionStrings.Add(connStringSettings);</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span></p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);"></span>&nbsp;config.Save();</p></div>


<p>For ASP.NET, you can follow the same principle, but use the <strong>System.Web.Configuration</strong> namespace in conjunction with WebConfigurationManager.OpenWebConfiguration(<em>path</em>) where <em>path </em>is the url of your root, for example <em>http://localhost/webapp1</em>&nbsp;(notice there is no trailing slash).</p>


<p><!--EndFragment--><!--EndFragment--></p>

</div>
  <footer>
    <a rel="full-article" href="/2006/06/adding-connection-strings-at-runtime/">Read on &rarr;</a>
  </footer>


  </article>

<nav role="pagination">
  <div>
    
      <a class="prev" href="/blog/page/32/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/30/">Newer &rarr;</a>
    
  </div>
</nav>

<script type="text/javascript">
    var disqus_shortname = 'subdigital';
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</div>
<aside role=sidebar>
  
    <section>
  <h1>Who am I?</h1>
  <p>I&#8217;m Ben Scheirman. I make Rails &amp; iPhone apps for <a href="http://chaione.com" target="_blank">ChaiONE</a> in Houston, TX.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/09/creating-a-glow-effect-for-uilabel-and-uibutton/">Creating a Glow Effect for UILabel and UIButton</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/introducing-appsites/">Introducing App Sites</a>
      </li>
    
      <li class="post">
        <a href="/2011/09/firebug-style-debugging-for-ios/">Firebug-Style Visual Debugging for iOS</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/vim---could-not-invoke-jslint/">Vim - Could Not Invoke JSLint</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/is-rails-exempt-from-software-principles/">Is Rails Exempt?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("subdigital", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/subdigital" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @subdigital</a>
  
</section>


<section>
  <h1>On Delicious</h1>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/js/subdigital?title=&count=3&sort=date&extended"></script>
  <p><a href="http://delicious.com/subdigital">My Delicious Bookmarks &raquo;</a></p>
</section>



  
</aside>

    </div>
  </div>
  <footer>
<a style="display:block; float: right" title="Real Time Analytics" href="http://getclicky.com/66470389"><img alt="Real Time Analytics" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(66470389); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66470389ns.gif" /></p></noscript>

<p>
  Copyright &copy; 2011 - Ben Scheirman -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
