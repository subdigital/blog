--- 
layout: post
title: The Curly Brace Tax
date: 2008-10-5
comments: true
link: false
---
<p><em>(I shamelessly stole this title from a chat with <a href="http://mhinze.com/" target="_blank">Matt Hinze</a>)</em></p><p>99% of the examples you see out there for ASP.NET MVC are using WebFormsViewEngine.&#160; That's fine, it's familiar, it benefits from intellisense, compilation, and refactoring support.&#160; But all of that comes at a price, and that price is (at times) <strong>incredibly wordy</strong>.</p><p>Picture this example, taken from the Site.master (master page) in the Preview 5 new project template.</p><p>At the top of the page, they want to render some text if the user is logged in, and different text if the user isn't logged in.&#160; Here are the screens:</p><p><strong>When you're not logged in:<br /></strong><a href="http://flux88.com/uploads/TheCurlyBraceTax_FB9D/mvcmasterpagelogin.jpg"><img src="/images/mvcmasterpagelogin_thumb.jpg" alt="mvc-masterpage-login"  border="0"  /></a> </p><p><strong>And when you're logged in...<br /><a href="http://flux88.com/uploads/TheCurlyBraceTax_FB9D/mvcmasterpagelogout.jpg"><img src="/images/mvcmasterpagelogout_thumb.jpg" alt="mvc-masterpage-logout"  border="0"  /></a> </strong></p><p>This is implemented using ASPX code that looks like this:</p>{% codeblock %}<div id="logindisplay">&lt;%if (Request.IsAuthenticated) {%&gt;Welcome <b>&lt;%= Html.Encode(Page.User.Identity.Name) %&gt;</b>![ &lt;%=Html.ActionLink(&quot;Logout&quot;, &quot;Logout&quot;, &quot;Account&quot;) %&gt; ]&lt;%}else {%&gt; [ &lt;%=Html.ActionLink(&quot;Login&quot;, &quot;Login&quot;, &quot;Account&quot;) %&gt; ]&lt;%}%&gt;</div>{% endcodeblock %}<p>Now let's take the same example and convert it to <a href="http://velocity.apache.org/engine/releases/velocity-1.5/user-guide.html" target="_blank">NVelocity</a>, another view engine with a looser syntax:</p>{% codeblock %}<div id="logindisplay">	#if ($isAuthenticated)		Welcome <b>$html.encode($user.name)</b>!		[ $html.actionlink(&quot;Logout&quot;, &quot;logout&quot;, &quot;account&quot;) ]	#else		[ $html.actionlink(&quot;Login&quot;, &quot;login&quot;, &quot;account&quot;) ]	#end</div>{% endcodeblock %}<p>We'd have to stuff the $isAuthenticated and $user values into ViewData, but that's a piece of cake.&#160; This is a great example of how concise we can get if we don't rely on all that strong typing.&#160; <em>The beauty of this is, the key that you use for ViewData becomes the object you interact with on the view</em>.</p><p>In NVelocity:</p><ul><li>case doesn't matter</li><li>no need to open up &lt;% %&gt; tags, you can embed it directly in your template</li><li>type doesn't matter.&#160; It's evaluated at runtime.</li></ul><p>There are some downsides, however:</p><ul><li>You don't get compile time checking for your views.&#160; If I wrote $htlm.actionlink(..)&#160; I'd get an error at runtime.</li><li>Performance.&#160; Compiled views are much faster than interpreted ones.&#160; It's likely that this doesn't matter for most sites out there.</li><li>No intellisense.&#160; (The arguments to ActionLink above are not obvious, so you just have to memorize it)</li><li><strong>No Refactoring support</strong>.&#160; This is a big one.&#160; If you rename your actions, you'll have to do a string comparison search to get the various links you might having lying around in your view.</li></ul><p>That last one is really the only one that I miss when doing something in NVelocity.&#160; In any case, try it out, see what you think!</p>
