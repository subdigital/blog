--- 
layout: post
title: Debugging Routes
date: 2008-3-15
comments: true
link: false
---
<p>Previously Scott Hanselman <a href="http://www.hanselman.com/blog/TheWeeklySourceCode17ASPNETMVCCommunityCodeEdition.aspx" target="_blank">pointed out</a> that in CodeCampServer we are using a tiny wrapper around MvcRouteHandler in order to catch all exceptions and provide the route information along with the error message.&nbsp; I called this (for lack of a better name) <strong>Better</strong>MvcRouteHandler.&nbsp; That&rsquo;s right, Better!</p><p>Scott took this a mile further and created a nice route debugging table that you can use while debugging.&nbsp; You can <a href="http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx" target="_blank">download this route debugger on Phil&rsquo;s blog</a> (with source).</p><p>To enable the route table debugger, you have to add this line to your global.asax:</p><p>`RouteDebug.RouteDebugger.DebugRoutes(RouteTable.Routes);`</p><p>I think it would be better to be able to add <strong>?routedebug</strong> to the end of ANY url and have this happen automatically.&nbsp; To accomplish this I created an HttpModule.&nbsp; It looks at each request for the <strong>?routedebug</strong> querystring key and, if found, calls the line above.&nbsp; I ran into a hiccup, though&hellip; once you set the route handler to the debug one, all future requests use it as well (even without the url parameter).&nbsp; </p><p>Good &lsquo;ol Phil released the source for this route debugger, so I added a method to revert the routes back to their original values if the query parameter doesn&rsquo;t exist.</p><p>Here is the RouteDebugModule:</p><p><img src="/images/routedebugmodule_.png" alt="Route_debug_module"  border="0"  /></p><p><em>(remember:&nbsp; this code would <strong>NOT</strong> be appropriate for production use, both for the awkward setting of route handlers on every request and the fact that you don&rsquo;t want your users to be able to see your route information.)</em></p><p>And the RevertRouteHandlers method (in Phil&rsquo;s RouteDebugger.cs):</p><p><img src="/images/revertroutes_.png" alt="Revert_routes"  border="0"  /></p><p>The _oldRouteHandlers is just a static dictionary that hangs on to the route before swapping with the debug one.</p><p>I added the HttpModule to my web.config, and now I can do this:</p><p><a href="http://www.flux88.com/uploads/route_2Ddebug_2Din_2Daction.png"><img src="/images/route_2Ddebug_2Din_2Daction_thumb_.jpg" alt="Route-debug-in-action"  border="0"  /></a></p><p>&hellip;and also flip back to the regular request without recompiling.</p><p>I&rsquo;m thinking they should call this <strong>BettererRouteHandler</strong> instead of RouteDebugHandler, who&rsquo;s with me?</p><div class="bjtags">Tags:<a rel="tag" href="http://technorati.com/tag/asp.net+mvc">asp.net+mvc</a>, <a rel="tag" href="http://technorati.com/tag/routing">routing</a></div>
