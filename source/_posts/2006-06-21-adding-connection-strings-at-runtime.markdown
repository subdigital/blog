--- 
layout: post
title: Adding connection strings at runtime
date: 2006-6-21
comments: true
link: false
---
<p>Today I noticed how non-intuitive it is to write to the configuration file programatically for an application.&nbsp; What I needed to do was dynamically create a connection string, then write it to the app.config file.</p><p>Here’s how you do it:</p><p>first, you need to add a project reference to the <strong>System.Configuration </strong>assembly.&nbsp; Add a corresponding using clause to the top of your class.</p><div style="border: 1px solid rgb(102, 102, 102); background: white none repeat scroll 0% 50%; overflow: auto; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Courier New;"><span style="color: rgb(43, 145, 175);">&nbsp; &nbsp;</span><span style="color: blue;">using</span> System.Configuration;</div><p>Next you need to find and open the configuration file.&nbsp; In win forms, you do this by specifying the full path to your application’s executable.&nbsp; If you project is at <strong>c:\code\project1</strong> then you would pass in something like this: “<strong>c:\code\project1\bin\debug\project1.exe</strong>”.</p><div style="border: 1px solid rgb(102, 102, 102); background: white none repeat scroll 0% 50%; overflow: auto; font-size: 9pt; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: black; font-family: Courier New;"><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span><span style="color: teal;">Configuration</span> config = <span style="color: teal;">ConfigurationManager</span>.OpenExeConfiguration(FULL_EXE_PATH);</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span></p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);"></span><span style="color: teal;">&nbsp;ConnectionStringSettings</span> connStringSettings = <span style="color: blue;">new</span> <span style="color: teal;">ConnectionStringSettings</span>(<span style="color: maroon;">"database"</span>, </p><p style="margin: 0px;"><span style="color: maroon;"><font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp; </font>"connection_string_here"</span>);</p><p style="margin: 0px;">&nbsp;</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span>config.ConnectionStrings.ConnectionStrings.Add(connStringSettings);</p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);">&nbsp;</span></p><p style="margin: 0px;"><span style="color: rgb(43, 145, 175);"></span>&nbsp;config.Save();</p></div><p>For ASP.NET, you can follow the same principle, but use the <strong>System.Web.Configuration</strong> namespace in conjunction with WebConfigurationManager.OpenWebConfiguration(<em>path</em>) where <em>path </em>is the url of your root, for example <em>http://localhost/webapp1</em>&nbsp;(notice there is no trailing slash).</p><p><!--EndFragment--><!--EndFragment--></p>
