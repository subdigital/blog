--- 
layout: post
title: Upgrading Code Camp Server to Preview 4 - Part 2
date: 2008-7-18
comments: true
link: false
---
<p><a href="http://flux88.com/UpgradingCodeCampServerToPreview4.aspx">Last time</a> I went through some steps to upgrade Code Camp Server to the latest version of the <a href="http://codeplex.com/aspnet">ASP.NET MVC Framework</a>.&nbsp; I had to stop because <a href="http://mvccontrib.org">MVCContrib</a> hadn't been upgraded yet.&nbsp; Now that their <a href="http://www.codeplex.com/MVCContrib/Release/ProjectReleases.aspx?ReleaseId=15416">4.0 release is out</a>, I can continue.</p> <h2>Final Changes</h2> <p>I updated the mvccontrib binaries in our /bin folder and then ran all of the tests.&nbsp; All of the tests passed.&nbsp; Running the site I came to find a few errors in our views that referenced ComponentController (which should have been caught with tests... <em>Note to self:&nbsp; precompile the site in the NAnt build...</em>).</p> <p>&nbsp;</p> <p>....And the site is alive again!</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/sitelive.png"><img src="/images/sitelive_thumb.png" alt="site-live"  border="0" /></a> </p> <p>We're now done with the upgrade, all tests are passing, and we need to commit our final changes to the branch we created in part 1.</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/svncommit.png"><img src="/images/svncommit_thumb.png" alt="svn-commit"  border="0" /></a> </p> <p>Now we're ready to merge our changes back into the trunk.&nbsp; </p> <h2>Merging the branch back to the trunk</h2> <p>To do this we will switch back over to the trunk with TortoiseSVN.</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/switchbacktotrunk.png"><img src="/images/switchbacktotrunk_thumb.png" alt="switch-back-to-trunk"  border="0" /></a> </p> <p>Next, we open the Merge dialog from within the trunk.&nbsp; With TortoiseSVN you're always merging from another branch to your current working copy.</p> <p>TortoiseSVN asks you how you want to merge your changes.&nbsp; What we've done is directly described in the second option, so we'll choose that.</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/mergeoptions1.png"><img src="/images/mergeoptions1_thumb.png" alt="merge-options1"  border="0" /></a> </p> <p>Next we select the branch from where we'd like to pull the changes...</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/mergeoptions2.png"><img src="/images/mergeoptions2_thumb.png" alt="merge-options2"  border="0" /></a>&nbsp;</p> <p>The last dialog has some other options for you, but the defaults will be fine for us.</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/image.png"><img src="/images/image_thumb.png" alt="image"  border="0" /></a>&nbsp;</p> <p>Now click on merge &amp; cross your fingers!</p> <p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/mergeerror.png"><img src="/images/mergeerror_thumb.png" alt="merge-error"  border="0" /></a> </p> <h3>Doh! </h3> <p> We get an error because googlecode doesn't yet support subversion 1.5.&nbsp; Well that sucks, <em>who planned this blog post anyway</em>?</p> <p>Time to drop down to command line to do the merge.&nbsp; That's right, don't be afraid of the command line.&nbsp; The first thing to do is to find out the revision that the code was branched.&nbsp; You can do that with a command on the branch working copy itself, by typing:</p>{% codeblock %}svn log --stop-on-copy{% endcodeblock %}<p>or I can cheat and look at the screen shot of the merge in part 1.&nbsp; I can see that the revision is 265.&nbsp; Now, back on the trunk I can type:</p>{% codeblock %}svn merge -r 265:HEAD href="http://codecampserver.googlecode.com/svn/branches/mvcpreview4upgrade{% endcodeblock %}<p>The result:</p><p><a href="http://flux88.com/uploads/UpgradingCodeCampServertoPreview4Part2_133EE/cmdlinemerge.png"><img src="/images/cmdlinemerge_thumb.png" alt="cmd-line-merge"  border="0" /></a> </p><p>Running the tests again just to make sure everything worked, and it does!</p><p>Now to commit our changes into the trunk...</p>{% codeblock %}svn commit -m "integrating preview4 branch"{% endcodeblock %}<h2>...And we're done!</h2><p>I hope that my play-by-play upgrade has been helpful.&nbsp; Dealing with frequent updates to the projects we use is a price that we pay for the rapidly changing environment that we live in.&nbsp; Now, off to play with Preview 4 new features and hopefully get to delete some of our newly obsoleted code!</p>
